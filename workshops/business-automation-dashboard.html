<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Opportunity Navigator - Business Process Automation Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Workshop Database Integration -->
    <script src="../api/supabase-config.js"></script>
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="../dist/output.css">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        /* Header Styles */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #e2e8f0;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 4px 0;
            letter-spacing: -0.025em;
        }
        
        .header-title p {
            color: #64748b;
            margin: 0;
            font-size: 0.875rem;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .project-selector {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .project-selector span {
            color: #64748b;
            margin-right: 8px;
        }
        
        .project-selector select {
            background: transparent;
            border: none;
            color: #1e293b;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .project-selector select:hover {
            color: #3b82f6;
        }
        
        .settings-trigger {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            color: #64748b;
            transition: all 0.2s;
        }
        
        .settings-trigger:hover {
            background: #f1f5f9;
            color: #1e293b;
        }
        
        .settings-trigger svg {
            width: 20px;
            height: 20px;
        }
        
        /* Tailwind utility classes for proper icon sizing */
        .w-3 { width: 0.75rem; }
        .h-3 { height: 0.75rem; }
        .w-4 { width: 1rem; }
        .h-4 { height: 1rem; }

        /* ===== MISSING CSS FROM BACKUP - START ===== */
        
        /* CSS Variables */
        :root {
            --duration-workspace: 400ms;
            --ease-workspace: cubic-bezier(0.4, 0, 0.2, 1);
            --duration-standard: 300ms;
            --duration-quick: 150ms;
            --ease-brand: cubic-bezier(0.4, 0, 0.2, 1);
            --glass-overlay: rgba(255, 255, 255, 0.95);
            --glass-dark: rgba(0, 0, 0, 0.75);
            --blur-overlay: blur(16px);
            --blur-dark: blur(12px);
            --blur-secondary: blur(8px);
        }

        /* Contextual Workspace System */
        .contextual-workspace {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active {
            opacity: 1;
            visibility: visible;
        }
        
        .workspace-content {
            position: absolute;
            inset: 24px;
            background: var(--glass-overlay);
            backdrop-filter: var(--blur-overlay);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95) translateY(40px);
            transition: transform var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active .workspace-content {
            transform: scale(1) translateY(0);
        }
        
        /* Workspace Header */
        .workspace-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .workspace-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-back-btn {
            width: 40px;
            height: 40px;
            background: rgba(107, 114, 128, 0.1);
            backdrop-filter: var(--blur-secondary);
            border: 1px solid rgba(107, 114, 128, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            cursor: pointer;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .workspace-back-btn:hover {
            transform: translateX(-2px);
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
        }
        
        .workspace-title {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        .workspace-badge {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .workspace-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Workspace Body */
        .workspace-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }
        
        /* Button System */
        .btn-system {
            background: rgba(107, 114, 128, 0.15);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(107, 114, 128, 0.3);
            color: #374151;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn-system:hover {
            transform: translateY(-1px);
            background: rgba(107, 114, 128, 0.15);
            border-color: rgba(107, 114, 128, 0.3);
            box-shadow: 0 4px 16px rgba(107, 114, 128, 0.1);
        }

        /* Dashboard Blur Effect */
        .dashboard-blur {
            filter: blur(4px);
            transform: scale(0.98);
            transition: all var(--duration-standard) ease;
        }

        /* Mode Indicator */
        .mode-indicator {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: var(--glass-dark);
            backdrop-filter: var(--blur-dark);
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 110;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .mode-indicator.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        /* ===== MISSING CSS FROM BACKUP - END =====

        /* ===== DATABASE FUNCTIONALITY CSS - START ===== */
        
        /* Connection Status */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
            animation: pulse 2s infinite;
        }
        
        .status-indicator.offline {
            background: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
        }
        
        .status-indicator.loading {
            background: #f59e0b;
            box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
        }
        
        .status-text {
            color: #6b7280;
            font-weight: 500;
        }
        
        /* Settings Button Variants */
        
        .settings-reset-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }
        
        .settings-reset-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* Database Reset Modal */
        .reset-confirmation-modal {
            position: fixed;
            inset: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .reset-confirmation-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .reset-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .reset-modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 480px;
            margin: 20px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .reset-confirmation-modal.active .reset-modal-content {
            transform: scale(1) translateY(0);
        }
        
        .reset-modal-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .reset-modal-icon {
            width: 64px;
            height: 64px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px auto;
        }
        
        .reset-modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
            margin: 0 0 8px 0;
        }
        
        .reset-modal-description {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
            line-height: 1.5;
        }
        
        .reset-modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .reset-cancel-btn {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            background: #f3f4f6;
            color: #374151;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-cancel-btn:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        .reset-confirm-btn {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-confirm-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* Grid utility for settings buttons */
        .grid {
            display: grid;
        }
        
        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        
        .gap-2 {
            gap: 0.5rem;
        }
        
        /* Pulse animation */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }
        
        /* Prevent pointer events on status indicators to avoid blocking interactions */
        #connectionStatus {
            pointer-events: none !important;
            user-select: none;
        }
        
        /* ===== DATABASE FUNCTIONALITY CSS - END =====
        
        /* Main Content */
        .main-content {
            padding: 32px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page-header {
            margin-bottom: 32px;
            text-align: center;
        }
        
        .page-header h2 {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 8px 0;
        }
        
        .page-header p {
            color: #64748b;
            font-size: 1rem;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-top: 32px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: #fefefe;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }
        
        .chart-container:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
            max-height: 100%;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 16px;
            font-weight: 600;
            color: #374151;
            font-size: 1rem;
        }
        
        /* Debug Panel System */
        .debug-panel {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 80;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .debug-toggle {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(226, 232, 240, 0.3);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            user-select: none;
        }
        
        .debug-toggle:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(79, 70, 229, 0.2);
            color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        
        .debug-toggle.expanded {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-color: rgba(79, 70, 229, 0.3);
        }
        
        .debug-toggle.expanded:hover {
            background: linear-gradient(135deg, #3730a3 0%, #5b21b6 100%);
            color: white;
        }
        
        .debug-indicator {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            right: 8px;
            animation: pulse 2s infinite;
        }
        
        .debug-content {
            position: absolute;
            bottom: 64px;
            left: 0;
            width: 400px;
            max-height: 300px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.3);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .debug-content.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .debug-header {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .debug-header h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .debug-header .debug-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .debug-body {
            padding: 16px 20px;
            max-height: 220px;
            overflow-y: auto;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.6;
            color: #334155;
            background: rgba(248, 250, 252, 0.3);
        }
        
        .debug-body::-webkit-scrollbar {
            width: 4px;
        }
        
        .debug-body::-webkit-scrollbar-track {
            background: rgba(226, 232, 240, 0.3);
            border-radius: 2px;
        }
        
        .debug-body::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
            border-radius: 2px;
        }
        
        .debug-body::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }
        
        .debug-message {
            margin-bottom: 8px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(226, 232, 240, 0.2);
        }
        
        .debug-message:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .debug-timestamp {
            color: #64748b;
            font-size: 10px;
            margin-bottom: 4px;
        }
        
        .debug-text {
            color: #475569;
        }
        
        /* Animation keyframes */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .debug-panel {
                bottom: 16px;
                left: 16px;
            }
            
            .debug-content {
                width: calc(100vw - 80px);
                max-width: 340px;
            }
        }
        
        /* Hide original debug info */
        .debug-info {
            display: none;
        }
        
        /* FAB Styles */
        .fab-cluster {
            position: fixed;
            bottom: 48px;
            right: 48px;
            z-index: 90;
        }
        
        .fab-primary {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(79, 70, 229, 0.3);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
        }
        
        .fab-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(79, 70, 229, 0.4);
        }
        
        .fab-secondary-group {
            position: absolute;
            bottom: 80px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .fab-cluster.expanded .fab-secondary-group {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .fab-secondary {
            width: 48px;
            height: 48px;
            background: rgba(79, 70, 229, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4F46E5;
            cursor: pointer;
            transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
            position: relative;
        }
        
        .fab-secondary:hover {
            transform: translateX(-4px);
            background: rgba(79, 70, 229, 0.15);
            border-color: rgba(79, 70, 229, 0.3);
        }
        
        .fab-tooltip {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 200ms;
            pointer-events: none;
        }
        
        .fab-secondary:hover .fab-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(-4px);
        }
        
        .recreate-button {
            margin-top: 32px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .recreate-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        /* Header Settings Panel Styles */
        .header-settings-panel {
            position: fixed;
            top: 80px;
            right: 24px;
            width: 320px;
            max-height: 500px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            overflow-y: auto;
        }
        
        .header-settings-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .settings-header {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: #fafbfc;
            border-radius: 12px 12px 0 0;
            flex-shrink: 0;
        }
        
        .settings-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }
        
        .settings-subtitle {
            font-size: 12px;
            color: #64748b;
            margin: 2px 0 0 0;
        }
        
        .settings-body {
            padding: 0;
            flex: 1;
            overflow-y: auto;
        }
        
        .settings-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .settings-section:last-child {
            border-bottom: none;
        }
        
        .settings-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 0 0 12px 0;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }
        
        .settings-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
        }
        
        .settings-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .settings-btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .settings-btn-warning:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3);
        }
        
        .settings-btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .settings-btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        
        .settings-logout-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .settings-logout-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        .settings-reset-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .settings-reset-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        /* Project Management System Styles */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-healthy {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
        }

        .status-text {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
        }

        .participant-counter {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 8px;
        }

        .participant-icon {
            font-size: 14px;
        }

        .participant-count {
            font-size: 12px;
            font-weight: 700;
            color: #374151;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 6px;
        }

        .quick-action-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .quick-action-btn:hover {
            background: #f1f5f9;
        }

        /* Consolidated Settings Panel */
        .settings-panel {
            position: relative;
            display: inline-block;
        }

        .settings-trigger {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 500;
            color: #475569;
        }

        .settings-trigger:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            color: #334155;
        }

        .settings-trigger.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .settings-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
            min-width: 320px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .settings-header {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: #fafbfc;
            border-radius: 12px 12px 0 0;
            flex-shrink: 0;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .settings-subtitle {
            font-size: 12px;
            color: #64748b;
            margin: 2px 0 0 0;
        }

        .settings-body {
            padding: 0;
            flex: 1;
            overflow-y: auto;
        }

        .settings-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }

        .settings-item-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-item-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-toggle {
            position: relative;
            display: inline-block;
            width: 42px;
            height: 22px;
        }

        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 11px;
        }

        .settings-toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .settings-toggle input:checked + .settings-toggle-slider {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .settings-toggle input:checked + .settings-toggle-slider:before {
            transform: translateX(20px);
        }

        .settings-select {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            min-width: 140px;
        }
        
        .settings-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .settings-btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .settings-btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .settings-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .settings-status-online {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .settings-status-offline {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .settings-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-close-btn:hover {
            background: #f1f5f9;
            color: #475569;
        }

        /* Animation for settings gear icon */
        .settings-icon {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-trigger.active .settings-icon {
            transform: rotate(120deg);
        }

        /* Contextual Workspace System */
        :root {
            --glass-primary: rgba(255, 255, 255, 0.85);
            --glass-secondary: rgba(255, 255, 255, 0.75);
            --glass-overlay: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(15, 23, 42, 0.85);
            --blur-primary: blur(12px);
            --blur-secondary: blur(10px);
            --blur-overlay: blur(16px);
            --blur-dark: blur(12px);
            --ease-brand: cubic-bezier(0.4, 0.0, 0.2, 1);
            --ease-workspace: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --duration-quick: 200ms;
            --duration-standard: 300ms;
            --duration-workspace: 400ms;
        }

        /* Contextual Workspace Overlay */
        .contextual-workspace {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active {
            opacity: 1;
            visibility: visible;
        }
        
        .workspace-content {
            position: absolute;
            inset: 24px;
            background: var(--glass-overlay);
            backdrop-filter: var(--blur-overlay);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95) translateY(40px);
            transition: transform var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active .workspace-content {
            transform: scale(1) translateY(0);
        }

        /* Workspace Header */
        .workspace-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .workspace-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-back-btn {
            width: 40px;
            height: 40px;
            background: rgba(107, 114, 128, 0.1);
            backdrop-filter: var(--blur-secondary);
            border: 1px solid rgba(107, 114, 128, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            cursor: pointer;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .workspace-back-btn:hover {
            transform: translateX(-2px);
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
        }
        
        .workspace-title {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        .workspace-badge {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .workspace-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Workspace Body */
        .workspace-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        /* Admin Control Card */
        .admin-control-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
            transition: all 0.2s ease;
        }

        .admin-control-card:hover {
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }

        /* Primary Button - Brand gradient with WCAG AA compliance */
        .btn-primary {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: #ffffff;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #3730a3 0%, #5b21b6 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
        }

        .btn-system {
            background: #f8fafc;
            color: #475569;
            border: 1px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-system:hover {
            background: #e2e8f0;
            border-color: #94a3b8;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .fab-cluster {
                bottom: 32px;
                right: 32px;
            }
            
            .fab-primary {
                width: 56px;
                height: 56px;
                font-size: 20px;
            }
            
            .main-content {
                padding: 20px;
            }
        }

        /* Step Indicator Styles */
        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .step-indicator .w-8 {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 15px;
        }
        
        .step-indicator.active .w-8 {
            background-color: #2563eb !important;
            color: white !important;
        }
        
        .step-indicator.active span {
            color: #2563eb !important;
            font-weight: bold !important;
        }
        
        /* Form Option Styles */
        .frequency-option input:checked + div,
        .info-source input:checked + div,
        .consistency-option input:checked + div,
        .volume-option input:checked + div,
        .impact-option input:checked + div,
        .feasibility-option input:checked + div,
        .cost-option input:checked + div {
            border-color: #2563eb !important;
            background-color: #eff6ff !important;
            box-shadow: inset 4px 0 0 #2563eb, 0 2px 4px rgba(37, 99, 235, 0.1);
            transform: none !important;
        }
        
        /* Validation Error Styles */
        .validation-error {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .validation-error svg {
            width: 1rem;
            height: 1rem;
            margin-right: 0.25rem;
        }
        
        /* Field Error Styles */
        .field-error {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 1px #dc2626 !important;
        }
        
        .field-required::after {
            content: " *";
            color: #dc2626;
        }
        
        /* Currency Toggle Styling */
        .currency-toggle .currency-option {
            transition: all 0.2s ease;
        }
        
        .currency-toggle input:checked + .currency-option {
            background-color: #dbeafe !important;
            color: #1d4ed8 !important;
            font-weight: 600;
        }
        
        .currency-toggle input:not(:checked) + .currency-option {
            background-color: transparent;
            color: #6b7280;
        }
        
        /* Template Button Styles */
        .template-btn:hover {
            border-color: #2563eb !important;
            background-color: #f8fafc !important;
        }
        
        /* Time Slider Styles */
        .time-slider {
            background: linear-gradient(to right, #2563eb 0%, #2563eb var(--slider-progress, 50%), #e5e7eb var(--slider-progress, 50%), #e5e7eb 100%);
            border-radius: 8px;
            height: 8px;
        }
        
        .time-slider::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .time-slider::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        /* Step Content Animation */
        .step-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive Adjustments for Step Indicators */
        @media (max-width: 768px) {
            .step-indicator {
                margin: 0 5px;
            }
            
            .step-indicator .w-8 {
                margin-right: 0;
                margin-bottom: 5px;
            }
            
            .step-indicator span {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>AI Opportunity Navigator</h1>
                    <p>Business Process Automation Intelligence</p>
                </div>
                <div class="header-controls">
                    <div class="project-selector">
                        <span>Active Project:</span>
                        <select id="headerProjectSelector" onchange="switchProject(this.value)">
                            <option value="">Select Project...</option>
                        </select>
                    </div>
                    <button class="settings-trigger" onclick="toggleHeaderSettings()" id="headerSettingsTrigger">
                        <svg class="w-5 h-5 settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                    
                    <!-- Header Settings Panel -->
                    <div class="header-settings-panel" id="headerSettingsPanel">
                        <div class="settings-header">
                            <h3 class="settings-title">System Settings</h3>
                            <p class="settings-subtitle">Configure your workspace preferences</p>
                            <button class="settings-close-btn" onclick="closeHeaderSettings()" style="position: absolute; top: 12px; right: 12px;">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="settings-body">
                            <!-- System Status -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    System Status
                                </h4>
                                <div class="settings-item">
                                    <span class="settings-label">Database Connection</span>
                                    <span class="connection-status" id="connectionStatus">
                                        <div class="status-indicator"></div>
                                        <span class="status-text">Loading...</span>
                                    </span>
                                </div>
                            </div>

                            <!-- Data Actions -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                    </svg>
                                    Data Actions
                                </h4>
                                <div class="settings-item">
                                    <div class="grid grid-cols-1 gap-2">
                                        <button onclick="showDuplicateDetection()" class="settings-btn settings-btn-primary">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                            </svg>
                                            Find Duplicates
                                        </button>
                                        <button onclick="showBulkActions()" class="settings-btn settings-btn-warning">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                            </svg>
                                            Bulk Actions
                                        </button>
                                        <button onclick="showDepartmentLinks()" class="settings-btn settings-btn-success">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                            </svg>
                                            Generate Links
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Account -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    Account
                                </h4>
                                <button onclick="logout()" class="settings-logout-btn">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                    Sign Out
                                </button>
                            </div>

                            <!-- Database Management -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/>
                                    </svg>
                                    Database Management
                                </h4>
                                <div class="settings-item">
                                    <button onclick="showResetConfirmation()" class="settings-reset-btn">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                        Reset Database
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
                <h2>Business Process Analytics Dashboard</h2>
                <p>Real-time insights into your automation opportunities and process optimization potential.</p>
            </div>
            
            <!-- Modern Debug Panel -->
            <div class="debug-panel" id="debugPanel">
                <div class="debug-toggle" id="debugToggle">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313-12.454z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0-2 2a2 2 0 0 0-2-2a2 2 0 0 0 2-2"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11a1 1 0 1 0 2 0a1 1 0 0 0-2 0"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 11a1 1 0 1 0 2 0a1 1 0 0 0-2 0"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14a2 2 0 0 0 4 0"/>
                    </svg>
                    <div class="debug-indicator" id="debugIndicator"></div>
                </div>
                
                <div class="debug-content" id="debugContent">
                    <div class="debug-header">
                        <h4>
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Debug Console
                            <span class="debug-badge">Live</span>
                        </h4>
                    </div>
                    <div class="debug-body" id="debugMessages">
                        <div class="debug-message">
                            <div class="debug-timestamp">Loading...</div>
                            <div class="debug-text">Initializing dashboard...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Hidden original debug info for compatibility -->
            <div id="debug-info" class="debug-info">
                <strong>Debug Information:</strong><br>
                <span id="debug-content">Initializing dashboard...</span>
            </div>
            
            <div class="chart-grid">
                <div class="chart-container">
                    <div class="chart-title">Process Priority Matrix</div>
                    <canvas id="bubbleChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Department Distribution</div>
                    <canvas id="donutChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Automation Readiness Scores</div>
                    <canvas id="radarChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Weekly Time Investment</div>
                    <canvas id="barChart"></canvas>
                </div>
            </div>
            
            <button class="recreate-button" onclick="recreateCharts()">
                 Refresh Charts
            </button>
        </div>

    </div>

    <script>
        // Global variables for dashboard state
        let currentProjectId = null;
        let currentProject = 'SunSep7';
        let projects = [];
        let processes = [];
        let charts = {};
        let currentStep = 1;
        let editingProcessId = null;
        let workshopMode = false;
        let currentDepartment = '';
        let currentProjectContext = null;
        let autoLoadProject = false;
        let currentDepartmentFilter = null;
        let workshopReviewMode = false;
        let isAdmin = true;
        let sampleProcesses = [];
        let debugPanelExpanded = false;
        let debugMessages = [];
        const MAX_DEBUG_MESSAGES = 50;

        // Enhanced project data structure matching backup
        const projectData = {
            'SunSep7': [
                {
                    id: 'proc_001',
                    name: "Invoice Processing Automation",
                    department: "Finance", 
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 15,
                    scores: { repetitive: 9, dataDriven: 8, ruleBased: 9, highVolume: 8 },
                    notes: "Manual invoice processing takes significant time and prone to errors",
                    created_at: new Date('2024-09-01').toISOString(),
                    automation_avg: 8.5,
                    priority_score: 7.8
                },
                {
                    id: 'proc_002',
                    name: "Customer Onboarding Workflow",
                    department: "Sales",
                    impact: 9,
                    feasibility: 6,
                    timeSpent: 12,
                    scores: { repetitive: 7, dataDriven: 6, ruleBased: 8, highVolume: 7 },
                    notes: "Multiple touchpoints and manual data entry required",
                    created_at: new Date('2024-09-02').toISOString(),
                    automation_avg: 7.0,
                    priority_score: 7.4
                },
                {
                    id: 'proc_003',
                    name: "Report Generation System",
                    department: "Operations",
                    impact: 6,
                    feasibility: 9,
                    timeSpent: 8,
                    scores: { repetitive: 10, dataDriven: 9, ruleBased: 7, highVolume: 6 },
                    notes: "Weekly reports compiled manually from multiple sources",
                    created_at: new Date('2024-09-03').toISOString(),
                    automation_avg: 8.0,
                    priority_score: 7.2
                }
            ],
            'Project Alpha': [
                {
                    id: 'proc_004',
                    name: "Employee Performance Reviews",
                    department: "HR",
                    impact: 7,
                    feasibility: 8,
                    timeSpent: 10,
                    scores: { repetitive: 6, dataDriven: 7, ruleBased: 6, highVolume: 5 },
                    notes: "Quarterly review process requires standardization",
                    created_at: new Date('2024-09-04').toISOString(),
                    automation_avg: 6.0,
                    priority_score: 6.8
                },
                {
                    id: 'proc_005',
                    name: "Inventory Management",
                    department: "Operations",
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 20,
                    scores: { repetitive: 8, dataDriven: 9, ruleBased: 8, highVolume: 9 },
                    notes: "Stock level monitoring and reorder process",
                    created_at: new Date('2024-09-05').toISOString(),
                    automation_avg: 8.5,
                    priority_score: 8.0
                },
                {
                    id: 'proc_006',
                    name: "Expense Report Processing",
                    department: "Finance",
                    impact: 6,
                    feasibility: 8,
                    timeSpent: 8,
                    scores: { repetitive: 9, dataDriven: 8, ruleBased: 8, highVolume: 7 },
                    notes: "Manual approval workflow causes delays",
                    created_at: new Date('2024-09-06').toISOString(),
                    automation_avg: 8.0,
                    priority_score: 7.2
                }
            ],
            'Project Beta': [
                {
                    id: 'proc_007',
                    name: "Social Media Scheduling",
                    department: "Marketing",
                    impact: 5,
                    feasibility: 9,
                    timeSpent: 6,
                    scores: { repetitive: 9, dataDriven: 5, ruleBased: 7, highVolume: 6 },
                    notes: "Content scheduling across multiple platforms",
                    created_at: new Date('2024-09-07').toISOString(),
                    automation_avg: 6.75,
                    priority_score: 6.5
                },
                {
                    id: 'proc_008',
                    name: "Customer Support Tickets",
                    department: "Support",
                    impact: 9,
                    feasibility: 6,
                    timeSpent: 25,
                    scores: { repetitive: 7, dataDriven: 6, ruleBased: 8, highVolume: 9 },
                    notes: "High volume of tickets requiring triage and routing",
                    created_at: new Date('2024-09-08').toISOString(),
                    automation_avg: 7.5,
                    priority_score: 7.8
                },
                {
                    id: 'proc_009',
                    name: "Data Backup Procedures",
                    department: "IT",
                    impact: 10,
                    feasibility: 8,
                    timeSpent: 5,
                    scores: { repetitive: 10, dataDriven: 8, ruleBased: 9, highVolume: 4 },
                    notes: "Critical system backups performed manually",
                    created_at: new Date('2024-09-09').toISOString(),
                    automation_avg: 7.75,
                    priority_score: 8.5
                },
                {
                    id: 'proc_010',
                    name: "Lead Qualification Process",
                    department: "Sales",
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 15,
                    scores: { repetitive: 8, dataDriven: 9, ruleBased: 8, highVolume: 8 },
                    notes: "Manual lead scoring and assignment process",
                    created_at: new Date('2024-09-10').toISOString(),
                    automation_avg: 8.25,
                    priority_score: 7.9
                },
                {
                    id: 'proc_011',
                    name: "Document Approval Workflow",
                    department: "Legal",
                    impact: 7,
                    feasibility: 6,
                    timeSpent: 18,
                    scores: { repetitive: 6, dataDriven: 5, ruleBased: 8, highVolume: 6 },
                    notes: "Contract and document approval routing",
                    created_at: new Date('2024-09-11').toISOString(),
                    automation_avg: 6.25,
                    priority_score: 6.7
                }
            ]
        };

        // Enhanced project metadata
        const projectMetadata = {
            'SunSep7': {
                name: 'SunSep7',
                description: 'Q3 2024 Automation Assessment',
                created_at: '2024-09-07',
                facilitator: 'Workshop Admin',
                departments: ['Finance', 'Sales', 'Operations'],
                status: 'active'
            },
            'Project Alpha': {
                name: 'Project Alpha',
                description: 'HR & Operations Optimization',
                created_at: '2024-08-15',
                facilitator: 'Process Manager',
                departments: ['HR', 'Operations', 'Finance'],
                status: 'active'
            },
            'Project Beta': {
                name: 'Project Beta',
                description: 'Enterprise-wide Digital Transformation',
                created_at: '2024-08-01',
                facilitator: 'Digital Lead',
                departments: ['Marketing', 'Support', 'IT', 'Sales', 'Legal'],
                status: 'active'
            }
        };

        // Initialize projects with sample data if needed
        function initializeProjects() {
            const savedProjects = localStorage.getItem('businessProjects');
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
            } else {
                // Initialize with sample projects if none exist
                projects = [
                    {
                        id: 'proj_001',
                        name: 'SunSep7 Automation',
                        clientName: 'Q3 2024 Automation Assessment',
                        createdAt: new Date('2024-09-07').toISOString()
                    },
                    {
                        id: 'proj_002', 
                        name: 'Project Alpha',
                        clientName: 'Digital Transformation Initiative',
                        createdAt: new Date('2024-08-15').toISOString()
                    },
                    {
                        id: 'proj_003',
                        name: 'Project Beta', 
                        clientName: 'Enterprise-wide Process Optimization',
                        createdAt: new Date('2024-08-01').toISOString()
                    }
                ];
                saveProjects();
            }
            
            // Update dropdowns after initialization
            console.log(' Projects initialized:', projects.length, 'projects');
        }
        
        // Initialize current data based on selected project
        sampleProcesses = projectData[currentProject] || [];
        
        function debugLog(message) {
            console.log(message);
            
            // Legacy compatibility - update old debug-content if it exists
            const oldDebugContent = document.getElementById('debug-content');
            if (oldDebugContent) {
                oldDebugContent.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
            }
            
            // Add to new debug system
            addDebugMessage(message);
        }
        
        function addDebugMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            const debugMessage = {
                timestamp,
                text: message,
                id: Date.now()
            };
            
            // Add to messages array
            debugMessages.unshift(debugMessage);
            
            // Keep only the latest messages
            if (debugMessages.length > MAX_DEBUG_MESSAGES) {
                debugMessages = debugMessages.slice(0, MAX_DEBUG_MESSAGES);
            }
            
            // Update the debug panel if it exists
            updateDebugPanel();
            
            // Pulse the indicator
            pulseDebugIndicator();
        }
        
        function updateDebugPanel() {
            const debugMessagesContainer = document.getElementById('debugMessages');
            if (!debugMessagesContainer) return;
            
            if (debugMessages.length === 0) {
                debugMessagesContainer.innerHTML = `
                    <div class="debug-message">
                        <div class="debug-timestamp">Ready</div>
                        <div class="debug-text">No debug messages yet...</div>
                    </div>
                `;
                return;
            }
            
            const messagesHtml = debugMessages.map(msg => `
                <div class="debug-message">
                    <div class="debug-timestamp">${msg.timestamp}</div>
                    <div class="debug-text">${msg.text}</div>
                </div>
            `).join('');
            
            debugMessagesContainer.innerHTML = messagesHtml;
            
            // Auto-scroll to top (latest message)
            debugMessagesContainer.scrollTop = 0;
        }
        
        function pulseDebugIndicator() {
            const indicator = document.getElementById('debugIndicator');
            if (!indicator) return;
            
            // Add pulse animation
            indicator.style.animation = 'none';
            setTimeout(() => {
                indicator.style.animation = 'pulse 1s ease-in-out';
            }, 10);
        }
        
        function toggleDebugPanel() {
            debugPanelExpanded = !debugPanelExpanded;
            
            const debugToggle = document.getElementById('debugToggle');
            const debugContent = document.getElementById('debugContent');
            
            if (!debugToggle || !debugContent) return;
            
            if (debugPanelExpanded) {
                debugToggle.classList.add('expanded');
                debugContent.classList.add('show');
                updateDebugPanel();
                addDebugMessage(' Debug panel opened');
            } else {
                debugToggle.classList.remove('expanded');
                debugContent.classList.remove('show');
                addDebugMessage(' Debug panel closed');
            }
        }
        
        function initializeDebugPanel() {
            const debugToggle = document.getElementById('debugToggle');
            if (debugToggle) {
                debugToggle.addEventListener('click', toggleDebugPanel);
                addDebugMessage(' Debug panel initialized');
                updateDebugPanel();
            }
            
            // Close panel when clicking outside
            document.addEventListener('click', (e) => {
                const debugPanel = document.getElementById('debugPanel');
                if (debugPanel && !debugPanel.contains(e.target) && debugPanelExpanded) {
                    toggleDebugPanel();
                }
            });
        }

        function createBubbleChart() {
            const element = document.getElementById('bubbleChart');
            const container = element.parentElement;
            
            debugLog(` Bubble chart - Element: ${!!element}, Container: ${!!container}`);
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                debugLog(` Container dimensions: ${containerRect.width}x${containerRect.height}`);
                
                // Force proper canvas dimensions
                const width = Math.max(containerRect.width - 40, 400); // Account for padding
                const height = Math.max(containerRect.height - 60, 300); // Account for title
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
                
                debugLog(` Set canvas dimensions: ${width}x${height}`);
            }

            const ctx = element.getContext('2d');
            
            if (charts.bubble) {
                charts.bubble.destroy();
            }

            const data = (projectData[currentProject] || []).map(process => ({
                x: process.impact,
                y: process.feasibility,
                r: Math.max(process.timeSpent, 5),
                label: process.name,
                department: process.department
            }));

            charts.bubble = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Business Processes',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw.label} (${context.raw.department}): Impact ${context.raw.x}, Feasibility ${context.raw.y}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Business Impact',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            min: 0,
                            max: 10
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Technical Feasibility',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            min: 0,
                            max: 10
                        }
                    }
                }
            });
            
            debugLog(` Bubble chart created successfully`);
        }

        function createDonutChart() {
            const element = document.getElementById('donutChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.donut) {
                charts.donut.destroy();
            }

            // Calculate department hours
            const departmentHours = {};
            (projectData[currentProject] || []).forEach(p => {
                departmentHours[p.department] = (departmentHours[p.department] || 0) + p.timeSpent;
            });

            charts.donut = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(departmentHours),
                    datasets: [{
                        data: Object.values(departmentHours),
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)', 
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(124, 58, 237, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed} hours/week`;
                                }
                            }
                        }
                    }
                }
            });
            
            debugLog(` Donut chart created successfully`);
        }

        function createRadarChart() {
            const element = document.getElementById('radarChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.radar) {
                charts.radar.destroy();
            }

            // Calculate average scores
            const avgScores = (projectData[currentProject] || []).reduce((acc, p) => {
                acc.repetitive += p.scores.repetitive;
                acc.dataDriven += p.scores.dataDriven;
                acc.ruleBased += p.scores.ruleBased;
                acc.highVolume += p.scores.highVolume;
                return acc;
            }, { repetitive: 0, dataDriven: 0, ruleBased: 0, highVolume: 0 });

            const processCount = (projectData[currentProject] || []).length;
            Object.keys(avgScores).forEach(key => {
                avgScores[key] = avgScores[key] / processCount;
            });

            charts.radar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Repetitive Tasks', 'Data-Driven', 'Rule-Based', 'High Volume'],
                    datasets: [{
                        label: 'Automation Readiness',
                        data: [
                            avgScores.repetitive,
                            avgScores.dataDriven,
                            avgScores.ruleBased,
                            avgScores.highVolume
                        ],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
            
            debugLog(` Radar chart created successfully`);
        }

        function createBarChart() {
            const element = document.getElementById('barChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.bar) {
                charts.bar.destroy();
            }

            charts.bar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: (projectData[currentProject] || []).map(p => p.name),
                    datasets: [{
                        label: 'Hours per Week',
                        data: (projectData[currentProject] || []).map(p => p.timeSpent),
                        backgroundColor: 'rgba(245, 158, 11, 0.7)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y} hours/week`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours per Week',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            debugLog(` Bar chart created successfully`);
        }

        function recreateCharts() {
            debugLog(` Recreating all charts...`);
            document.getElementById('debug-content').innerHTML = 'Recreating charts...';
            
            setTimeout(() => {
                createBubbleChart();
                createDonutChart();
                createRadarChart();
                createBarChart();
                debugLog(` All charts recreation complete`);
            }, 100);
        }

        // Header functionality
        function switchProject(projectId) {
            debugLog(` Switching to project: ${projectId}`);
            currentProject = projectId;
            currentProjectId = projectId; // Also set currentProjectId for process management
            recreateCharts();
        }

        // Header Settings Functions (REUSED FROM BACKUP)
        let headerSettingsOpen = false;
        
        function toggleHeaderSettings() {
            if (headerSettingsOpen) {
                closeHeaderSettings();
            } else {
                openHeaderSettings();
            }
        }
        
        function openHeaderSettings() {
            const trigger = document.getElementById('headerSettingsTrigger');
            const panel = document.getElementById('headerSettingsPanel');
            
            if (!trigger || !panel) {
                console.warn('Header settings elements not found');
                return;
            }
            
            trigger.classList.add('active');
            panel.classList.add('active');
            headerSettingsOpen = true;
            
            // Sync settings with current state
            syncSettingsState();
            
            // Add click outside handler
            setTimeout(() => {
                document.addEventListener('click', handleHeaderSettingsClickOutside);
            }, 100);
        }
        
        function closeHeaderSettings() {
            const trigger = document.getElementById('headerSettingsTrigger');
            const panel = document.getElementById('headerSettingsPanel');
            
            if (trigger) trigger.classList.remove('active');
            if (panel) panel.classList.remove('active');
            headerSettingsOpen = false;
            
            // Remove click outside handler
            document.removeEventListener('click', handleHeaderSettingsClickOutside);
        }
        
        function handleHeaderSettingsClickOutside(event) {
            const panel = document.getElementById('headerSettingsPanel');
            const trigger = document.getElementById('headerSettingsTrigger');
            if (panel && !panel.contains(event.target) && !trigger.contains(event.target)) {
                closeHeaderSettings();
            }
        }
        
        function syncSettingsState() {
            // Update connection status in settings
            const connectionStatus = document.getElementById('connectionStatus');
            if (connectionStatus) {
                const statusIndicator = connectionStatus.querySelector('.status-indicator');
                const statusText = connectionStatus.querySelector('.status-text');
                
                if (statusIndicator && statusText) {
                    statusIndicator.className = 'status-indicator online';
                    statusText.textContent = 'localStorage';
                }
            }
        }

        function showFabCluster() {
            console.log(' showFabCluster called');
            const existingCluster = document.getElementById('fabCluster');
            if (existingCluster) {
                console.log(' FAB cluster already exists, skipping');
                return; // Already exists
            }
            
            const fabCluster = document.createElement('div');
            fabCluster.id = 'fabCluster';
            fabCluster.className = 'fab-cluster';
            
            // Debug: Make sure it's visible
            console.log(' Creating FAB cluster element...');
            fabCluster.style.cssText = 'position: fixed; bottom: 48px; right: 48px; z-index: 9999; pointer-events: auto;';
            
            fabCluster.innerHTML = `
                <!-- Primary FAB -->
                <button class="fab-primary" onclick="toggleFabMenu()" id="primaryFab">
                    <span id="fabIcon"></span>
                </button>
                
                <!-- Secondary FABs -->
                <div class="fab-secondary-group" id="secondaryFabs">
                    
                    <button class="fab-secondary" onclick="openProjectWorkspace()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        <div class="fab-tooltip">Manage Projects</div>
                    </button>
                    
                    <button class="fab-secondary" onclick="openProcessWorkspace()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m5 0a2 2 0 002-2V7a2 2 0 00-2-2H9m0 0v12m0-12h6m-6 0V3"/>
                        </svg>
                        <div class="fab-tooltip">Add Process</div>
                    </button>
                    
                    <button class="fab-secondary" onclick="openPresentationMode()">
                        <svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5l-1 2v1h8v-1l-1-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H3V5h18v10z"/>
                        </svg>
                        <div class="fab-tooltip">Present Mode</div>
                    </button>
                </div>
            `;
            
            document.body.appendChild(fabCluster);
            console.log(' FAB cluster added to DOM:', fabCluster);
        }

        let fabExpanded = false;
        
        function toggleFabMenu() {
            const cluster = document.getElementById('fabCluster');
            const icon = document.getElementById('fabIcon');
            
            fabExpanded = !fabExpanded;
            
            if (fabExpanded) {
                cluster.classList.add('expanded');
                icon.textContent = '';
            } else {
                cluster.classList.remove('expanded');
                icon.textContent = '';
            }
        }

        // Utility Functions
        function generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        }
        
        function saveProjects() {
            localStorage.setItem('businessProjects', JSON.stringify(projects));
        }
        
        function loadProcesses(projectId) {
            const savedProcesses = localStorage.getItem(`processes_${projectId}`);
            if (savedProcesses) {
                processes = JSON.parse(savedProcesses);
                renderProcessList();
                updateCharts();
                updateMetrics();
            } else {
                processes = [];
                renderProcessList();
                updateCharts();
                updateMetrics();
            }
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize dashboard
        // Project Management Functions
        function openProjectModal() {
            const modal = document.getElementById('projectModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeProjectModal() {
            const modal = document.getElementById('projectModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
            document.getElementById('projectForm').reset();
            
            // Reset edit mode
            delete document.getElementById('projectForm').dataset.editId;
            document.querySelector('#projectModal h2').textContent = 'Create New Project';
            document.querySelector('#projectModal button[type="submit"]').textContent = 'Create Project ';
        }

        // Process Management Functions
        function addProcess() {
            if (!currentProjectId) {
                alert('Please select a project first');
                return;
            }
            document.getElementById('processModal').classList.remove('hidden');
            
            // Initialize error cost options with default currency
            updateErrorCostOptions('USD');
            
            // Initialize sliders to ensure event listeners work
            initializeSliders();
            
            // Re-apply department selection if in workshop mode
            if (workshopMode && currentDepartment) {
                setTimeout(() => preselectDepartment(currentDepartment), 100);
            }
        }

        function closeProcessModal() {
            document.getElementById('processModal').classList.add('hidden');
            document.getElementById('processForm').reset();
            document.body.style.overflow = 'auto';
            // Reset step to 1
            currentStep = 1;
            updateStepDisplay();
            // Clear selected template
            window.selectedTemplate = null;
            editingProcessId = null;
            // Reset modal title
            document.querySelector('#processModal h2').textContent = 'Add Business Process';
            document.getElementById('submitBtn').innerHTML = 'Add Process ';
        }

        function updateErrorCostOptions(currency) {
            const costOptions = {
                USD: [
                    { value: 'low', emoji: '', amount: 'Under $100', description: 'Minor cost' },
                    { value: 'medium', emoji: '', amount: '$100-$1,000', description: 'Noticeable impact' },
                    { value: 'high', emoji: '', amount: '$1,000-$10,000', description: 'Significant cost' },
                    { value: 'critical', emoji: '', amount: '$10,000+', description: 'Major financial impact' }
                ],
                INR: [
                    { value: 'low', emoji: '', amount: 'Under 8,000', description: 'Minor cost' },
                    { value: 'medium', emoji: '', amount: '8,000-80,000', description: 'Noticeable impact' },
                    { value: 'high', emoji: '', amount: '80,000-8,00,000', description: 'Significant cost' },
                    { value: 'critical', emoji: '', amount: '8,00,000+', description: 'Major financial impact' }
                ]
            };
            const container = document.getElementById('errorCostOptions');
            const options = costOptions[currency] || costOptions.USD;
            
            container.innerHTML = options.map(option => `
                <label class="cost-option cursor-pointer">
                    <input type="radio" name="errorCost" value="${option.value}" class="sr-only">
                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                        <div class="text-2xl mb-2">${option.emoji}</div>
                        <div class="font-medium">${option.amount}</div>
                        <div class="text-xs text-gray-500">${option.description}</div>
                    </div>
                </label>
            `).join('');
        }

        function initializeSliders() {
            const sliders = ['timeSpent', 'repetitive', 'dataDriven', 'ruleBased', 'highVolume', 'impact', 'feasibility'];
            
            sliders.forEach(sliderId => {
                const slider = document.getElementById(sliderId);
                const valueDisplay = document.getElementById(sliderId + 'Value');
                
                if (slider && valueDisplay) {
                    slider.addEventListener('input', function() {
                        if (sliderId === 'timeSpent') {
                            updateTimeDisplay();
                        } else {
                            valueDisplay.textContent = this.value;
                        }
                    });
                    
                    // Initialize time slider on first load
                    if (sliderId === 'timeSpent') {
                        updateTimeDisplay();
                        updateSliderFill();
                    }
                }
            });
        }

        function preselectDepartment(dept) {
            const deptName = departmentNames[dept.toLowerCase()];
            const select = document.getElementById('processDepartment');
            
            // Find the matching option value
            let optionValue = '';
            for (let i = 0; i < select.options.length; i++) {
                const option = select.options[i];
                if (option.textContent.includes(deptName)) {
                    optionValue = option.value;
                    break;
                }
            }
            
            if (optionValue) {
                select.value = optionValue;
                // Disable the select to lock the department
                select.disabled = true;
                select.style.backgroundColor = '#f3f4f6';
                select.style.cursor = 'not-allowed';
            }
        }

        function fillTemplate(templateType) {
            const templates = {
                invoicing: {
                    name: "Processing Invoices",
                    department: "Finance",
                    frequency: "weekly",
                    infoSources: ["spreadsheets", "documents"],
                    consistency: "similar",
                    volume: "medium",
                    impact: "significant",
                    feasibility: "moderate"
                },
                scheduling: {
                    name: "Staff Scheduling", 
                    department: "Operations",
                    frequency: "weekly",
                    infoSources: ["spreadsheets"],
                    consistency: "similar", 
                    volume: "medium",
                    impact: "significant",
                    feasibility: "easy"
                },
                orders: {
                    name: "Processing Customer Orders",
                    department: "Sales",
                    frequency: "daily",
                    infoSources: ["spreadsheets", "documents"],
                    consistency: "exact",
                    volume: "high",
                    impact: "critical",
                    feasibility: "moderate"
                },
                payroll: {
                    name: "Monthly Payroll Processing",
                    department: "HR",
                    frequency: "monthly",
                    infoSources: ["spreadsheets"],
                    consistency: "exact",
                    volume: "medium",
                    impact: "critical", 
                    feasibility: "complex"
                },
                inventory: {
                    name: "Inventory Management",
                    department: "Operations", 
                    frequency: "daily",
                    infoSources: ["spreadsheets"],
                    consistency: "similar",
                    volume: "high",
                    impact: "significant",
                    feasibility: "moderate"
                },
                customer: {
                    name: "Customer Support Tickets",
                    department: "Customer Service",
                    frequency: "daily", 
                    infoSources: ["documents", "communication"],
                    consistency: "different",
                    volume: "high",
                    impact: "significant",
                    feasibility: "complex"
                }
            };
            const template = templates[templateType];
            if (template) {
                // Fill basic info
                document.getElementById('processName').value = template.name;
                document.getElementById('processDepartment').value = template.department;
                
                // Pre-select options for step 2 (will be used when user reaches that step)
                window.selectedTemplate = template;
                
                // Visual feedback
                document.querySelector('.template-btn').style.backgroundColor = '#eff6ff';
                setTimeout(() => {
                    document.querySelectorAll('.template-btn').forEach(btn => {
                        btn.style.backgroundColor = 'white';
                    });
                }, 1000);
            }
        }

        function nextStep() {
            if (currentStep < 3) {
                // Validate current step
                if (validateCurrentStep()) {
                    // Store current scroll position relative to modal
                    const modal = document.getElementById('processModal');
                    const modalContent = modal.querySelector('.bg-white');
                    const currentScrollTop = modalContent.scrollTop;
                    
                    currentStep++;
                    updateStepDisplay();
                    
                    // Auto-fill template selections when entering step 2
                    if (currentStep === 2 && window.selectedTemplate) {
                        autoFillTemplateStep2(window.selectedTemplate);
                    }
                    
                    // Auto-fill template selections when entering step 3
                    if (currentStep === 3 && window.selectedTemplate) {
                        autoFillTemplateStep3(window.selectedTemplate);
                    }
                    
                    // Scroll to step header within modal
                    setTimeout(() => {
                        const stepContent = document.getElementById(`step${currentStep}`);
                        if (stepContent) {
                            stepContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 100);
                }
            }
        }

        function autoFillTemplateStep2(template) {
            // Select frequency
            const frequencyInput = document.querySelector(`input[name="frequency"][value="${template.frequency}"]`);
            if (frequencyInput) frequencyInput.checked = true;
            
            // Select info sources
            template.infoSources.forEach(source => {
                const infoInput = document.querySelector(`input[name="infoSource"][value="${source}"]`);
                if (infoInput) infoInput.checked = true;
            });
            
            // Select consistency
            const consistencyInput = document.querySelector(`input[name="consistency"][value="${template.consistency}"]`);
            if (consistencyInput) consistencyInput.checked = true;
            
            // Select volume
            const volumeInput = document.querySelector(`input[name="volume"][value="${template.volume}"]`);
            if (volumeInput) volumeInput.checked = true;
        }

        function autoFillTemplateStep3(template) {
            // Select impact
            const impactInput = document.querySelector(`input[name="impact"][value="${template.impact}"]`);
            if (impactInput) impactInput.checked = true;
            
            // Select feasibility
            const feasibilityInput = document.querySelector(`input[name="feasibility"][value="${template.feasibility}"]`);
            if (feasibilityInput) feasibilityInput.checked = true;
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(step => step.classList.add('hidden'));
            
            // Show current step
            document.getElementById(`step${currentStep}`).classList.remove('hidden');
            
            // Update step indicators
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                if (index + 1 <= currentStep) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.classList.toggle('hidden', currentStep === 1);
            nextBtn.classList.toggle('hidden', currentStep === 3);
            submitBtn.classList.toggle('hidden', currentStep !== 3);
        }

        function validateCurrentStep() {
            clearAllErrors();
            let isValid = true;
            
            switch(currentStep) {
                case 1:
                    if (document.getElementById('processName').value.trim() === '') {
                        showError('processName', 'Please enter a name for this process');
                        isValid = false;
                    }
                    const dept = document.getElementById('processDepartment').value;
                    if (dept === '') {
                        showError('processDepartment', 'Please select a department or team');
                        isValid = false;
                    } else if (dept === 'Custom' && document.getElementById('customDepartment').value.trim() === '') {
                        showError('processDepartment', 'Please specify the department name');
                        isValid = false;
                    }
                    break;
                case 2:
                    if (!document.querySelector('input[name="frequency"]:checked')) {
                        showError('frequency', 'Please select how often you do this process');
                        isValid = false;
                    }
                    if (!document.querySelector('input[name="consistency"]:checked')) {
                        showError('consistency', 'Please select how consistent this process is');
                        isValid = false;
                    }
                    if (!document.querySelector('input[name="volume"]:checked')) {
                        showError('volume', 'Please select the work volume');
                        isValid = false;
                    }
                    if (document.querySelectorAll('input[name="infoSource"]:checked').length === 0) {
                        showError('infoSource', 'Please select at least one information source');
                        isValid = false;
                    }
                    break;
                case 3:
                    if (!document.querySelector('input[name="impact"]:checked')) {
                        showError('impact', 'Please select the business impact');
                        isValid = false;
                    }
                    if (!document.querySelector('input[name="feasibility"]:checked')) {
                        showError('feasibility', 'Please select implementation difficulty');
                        isValid = false;
                    }
                    break;
                default:
                    return true;
            }
            return isValid;
        }

        function showError(fieldId, message) {
            const errorDiv = document.getElementById(fieldId + '-error');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
            }
            const field = document.getElementById(fieldId);
            if (field) {
                field.classList.add('field-error');
            }
        }

        function clearAllErrors() {
            document.querySelectorAll('.validation-error').forEach(error => {
                error.classList.add('hidden');
            });
            document.querySelectorAll('.field-error').forEach(field => {
                field.classList.remove('field-error');
            });
        }

        function toggleCustomDepartment() {
            const select = document.getElementById('processDepartment');
            const customInput = document.getElementById('customDepartment');
            if (select.value === 'Custom') {
                customInput.classList.remove('hidden');
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.value = '';
            }
        }

        function toggleOtherInfo() {
            const checkbox = document.querySelector('input[name="infoSource"][value="other"]');
            const input = document.getElementById('otherInfoSource');
            const placeholder = document.getElementById('otherInfoPlaceholder');
            
            if (checkbox.checked) {
                input.classList.remove('hidden');
                placeholder.classList.add('hidden');
                input.focus();
            } else {
                input.classList.add('hidden');
                placeholder.classList.remove('hidden');
                input.value = '';
            }
        }

        function updateTimeUnit() {
            const isDaily = document.querySelector('input[name="timeUnit"][value="daily"]').checked;
            const timeSlider = document.getElementById('timeSpent');
            const timeMin = document.getElementById('timeMin');
            const timeMax = document.getElementById('timeMax');
            
            if (isDaily) {
                // Switch to daily mode
                timeSlider.min = 1;
                timeSlider.max = 8;
                if (parseInt(timeSlider.value) > 8) {
                    timeSlider.value = 8;
                }
                timeMin.textContent = '1 hour';
                timeMax.textContent = '8+ hours';
            } else {
                // Switch to weekly mode
                timeSlider.min = 1;
                timeSlider.max = 40;
                if (parseInt(timeSlider.value) > 40) {
                    timeSlider.value = 40;
                }
                timeMin.textContent = '1 hour';
                timeMax.textContent = '40+ hours';
            }
            
            // Update display and slider fill
            updateTimeDisplay();
            updateSliderFill();
        }

        function updateSliderFill() {
            const slider = document.getElementById('timeSpent');
            const min = parseInt(slider.min);
            const max = parseInt(slider.max);
            const value = parseInt(slider.value);
            
            // Calculate percentage
            const percentage = ((value - min) / (max - min)) * 100;
            
            // Update CSS custom property for gradient
            slider.style.setProperty('--slider-progress', `${percentage}%`);
        }

        function updateErrorCostCurrency(currency) {
            updateErrorCostOptions(currency);
        }

        function calculateScores() {
            // Calculate repetitive score based on frequency
            const frequency = document.querySelector('input[name="frequency"]:checked')?.value;
            let repetitiveScore = 5;
            switch(frequency) {
                case 'daily': repetitiveScore = 9; break;
                case 'weekly': repetitiveScore = 7; break;
                case 'monthly': repetitiveScore = 5; break;
                case 'rarely': repetitiveScore = 2; break;
            }
            
            // Calculate data-driven score based on info sources
            const infoSources = Array.from(document.querySelectorAll('input[name="infoSource"]:checked')).map(cb => cb.value);
            let dataDrivenScore = 1;
            if (infoSources.includes('spreadsheets')) dataDrivenScore = 9;
            else if (infoSources.includes('documents')) dataDrivenScore = 6;
            else if (infoSources.includes('communication')) dataDrivenScore = 3;
            else if (infoSources.includes('experience')) dataDrivenScore = 1;
            
            // Calculate rule-based score based on consistency
            const consistency = document.querySelector('input[name="consistency"]:checked')?.value;
            let ruleBasedScore = 5;
            switch(consistency) {
                case 'exact': ruleBasedScore = 10; break;
                case 'similar': ruleBasedScore = 7; break;
                case 'different': ruleBasedScore = 4; break;
                case 'creative': ruleBasedScore = 1; break;
            }
            
            // Calculate volume score
            const volume = document.querySelector('input[name="volume"]:checked')?.value;
            let volumeScore = 5;
            switch(volume) {
                case 'low': volumeScore = 2; break;
                case 'medium': volumeScore = 5; break;
                case 'high': volumeScore = 8; break;
                case 'massive': volumeScore = 10; break;
            }
            
            // Calculate impact score
            const impact = document.querySelector('input[name="impact"]:checked')?.value;
            let impactScore = 5;
            switch(impact) {
                case 'critical': impactScore = 10; break;
                case 'significant': impactScore = 8; break;
                case 'moderate': impactScore = 5; break;
                case 'low': impactScore = 2; break;
            }
            
            // Calculate feasibility score
            const feasibility = document.querySelector('input[name="feasibility"]:checked')?.value;
            let feasibilityScore = 5;
            switch(feasibility) {
                case 'easy': feasibilityScore = 9; break;
                case 'moderate': feasibilityScore = 7; break;
                case 'complex': feasibilityScore = 4; break;
                case 'difficult': feasibilityScore = 2; break;
            }
            
            return {
                repetitive: repetitiveScore,
                dataDriven: dataDrivenScore,
                ruleBased: ruleBasedScore,
                highVolume: volumeScore,
                impact: impactScore,
                feasibility: feasibilityScore
            };
        }

        function updateTimeDisplay() {
            const isDaily = document.querySelector('input[name="timeUnit"][value="daily"]')?.checked ?? true;
            const timeSpent = parseInt(document.getElementById('timeSpent').value);
            const timeValue = document.getElementById('timeSpentValue');
            const conversion = document.getElementById('timeConversion');
            const convertedTime = document.getElementById('convertedTime');
            
            if (isDaily) {
                timeValue.textContent = `${timeSpent} hour${timeSpent > 1 ? 's' : ''} per day`;
                if (convertedTime) {
                    convertedTime.textContent = (timeSpent * 5).toFixed(1) + ' hours per week';
                }
            } else {
                timeValue.textContent = `${timeSpent} hour${timeSpent > 1 ? 's' : ''} per week`;
                if (convertedTime) {
                    convertedTime.textContent = (timeSpent / 5).toFixed(1) + ' hours per day';
                }
            }
            
            // Always show conversion
            if (conversion) {
                conversion.classList.remove('hidden');
            }
            
            // Update slider fill
            updateSliderFill();
        }

        function updateScore(slider) {
            // Optional: Add visual feedback for score updates
            console.log(`Updated ${slider.id} to ${slider.value}`);
        }

        // Wait for DOM to be ready before adding event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add process form handler
            const processForm = document.getElementById('processForm');
            if (processForm) {
                processForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const scores = calculateScores();
                    const department = document.getElementById('processDepartment').value;
                    const finalDepartment = department === 'Custom' ? document.getElementById('customDepartment').value : department;
                    
                    const processData = {
                        name: document.getElementById('processName').value,
                        department: finalDepartment,
                        customDepartment: department === 'Custom' ? document.getElementById('customDepartment').value : null,
                        timeSpent: parseInt(document.getElementById('timeSpent').value),
                        scores: {
                            repetitive: scores.repetitive,
                            dataDriven: scores.dataDriven,
                            ruleBased: scores.ruleBased,
                            highVolume: scores.highVolume
                        },
                        impact: scores.impact,
                        feasibility: scores.feasibility,
                        notes: document.getElementById('processNotes')?.value || '',
                        updatedAt: new Date().toISOString()
                    };

                    if (editingProcessId) {
                        // Update existing process
                        const processIndex = processes.findIndex(p => p.id === editingProcessId);
                        if (processIndex !== -1) {
                            processes[processIndex] = {
                                ...processes[processIndex],
                                ...processData,
                                id: editingProcessId
                            };
                            showNotification('Process updated successfully!', 'success');
                        }
                        editingProcessId = null;
                    } else {
                        // Create new process
                        const newProcess = {
                            id: generateId(),
                            ...processData,
                            projectId: currentProjectId,
                            createdAt: new Date().toISOString()
                        };
                        
                        processes.push(newProcess);
                        showNotification('Process added successfully!', 'success');
                    }
                    
                    // Save and refresh
                    saveProcesses();
                    closeProcessModal();
                    recreateCharts();
                });
            }
            
            // Project form handler
            const projectForm = document.getElementById('projectForm');
            if (projectForm) {
                projectForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const projectName = document.getElementById('projectName').value;
                    const clientName = document.getElementById('clientName').value;
                    const editId = form.dataset.editId;
                    
                    if (editId) {
                        // Update existing project
                        const projectIndex = projects.findIndex(p => p.id === editId);
                        if (projectIndex !== -1) {
                            projects[projectIndex].name = projectName;
                            projects[projectIndex].clientName = clientName;
                            projects[projectIndex].updatedAt = new Date().toISOString();
                            showNotification('Project updated successfully', 'success');
                        }
                        saveProjects();
                        renderProjectList();
                        closeProjectModal();
                    } else {
                        // Create new project using backend
                        const projectData = {
                            name: projectName,
                            description: clientName, // Using clientName as description
                            workshopDate: new Date().toISOString(),
                            facilitatorEmail: 'admin@example.com', // Default email
                            metadata: { clientName: clientName }
                        };
                        
                        createProjectWithBackend(projectData).then(newProject => {
                            if (newProject) {
                                // Add to local projects array for immediate UI update
                                const localProject = {
                                    id: newProject.id,
                                    name: newProject.name,
                                    clientName: clientName,
                                    createdAt: newProject.created_at || new Date().toISOString()
                                };
                                projects.push(localProject);
                                saveProjects();
                                renderProjectList();
                                showNotification('Project created successfully', 'success');
                            }
                            closeProjectModal();
                        }).catch(error => {
                            console.error('Project creation failed:', error);
                            showNotification('Project creation failed', 'error');
                            closeProjectModal();
                        });
                    }
                });
            }
        });
        
        function renderProjectList() {
            // Update header project selector
            updateProjectDropdowns();
            
            // Update project workspace if it's currently shown
            updateProjectWorkspaceIfVisible();
            
            console.log(' Project list updated - projects:', projects.length);
        }
        
        function updateProjectDropdowns() {
            // Update header selector
            const headerSelector = document.getElementById('headerProjectSelector');
            if (headerSelector) {
                const currentValue = headerSelector.value;
                headerSelector.innerHTML = '<option value="">Select Project...</option>';
                projects.forEach((project, index) => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = project.name;
                    // Select current project or default to first project
                    if (project.id === currentValue || (project.id === currentProjectId && !currentValue) || (!currentProjectId && index === 0)) {
                        option.selected = true;
                        currentProjectId = project.id; // Ensure currentProjectId is set
                    }
                    headerSelector.appendChild(option);
                });
                
                // If no project was selected but projects exist, select the first one
                if (!currentProjectId && projects.length > 0) {
                    currentProjectId = projects[0].id;
                    headerSelector.value = currentProjectId;
                    console.log(' Auto-selected first project:', currentProjectId);
                }
            }
            
            // Update any project selectors in settings
            const projectSelector = document.getElementById('projectSelector');
            if (projectSelector) {
                const currentValue = projectSelector.value;
                projectSelector.innerHTML = '<option value="">Select Project...</option>';
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = project.name;
                    if (project.id === currentValue) option.selected = true;
                    projectSelector.appendChild(option);
                });
            }
        }
        
        function updateProjectWorkspaceIfVisible() {
            // Check if project workspace is currently visible
            const workspaceContainer = document.getElementById('workspace-container');
            if (workspaceContainer && !workspaceContainer.classList.contains('hidden')) {
                // Re-render the workspace with updated project data
                const content = workspaceContainer.querySelector('.workspace-content');
                if (content && content.innerHTML.includes('New Project')) {
                    openProjectWorkspace(); // Refresh the workspace
                }
            }
        }
        
        function selectProject(projectId) {
            currentProjectId = projectId;
            const project = projects.find(p => p.id === projectId);
            if (project) {
                // Update header project selector
                const headerSelector = document.getElementById('headerProjectSelector');
                if (headerSelector) {
                    headerSelector.value = projectId;
                }
                
                loadProcesses(projectId);
                renderProjectList(); // Re-render to show selection
                updateDashboard();
                
                // Close workspace after selection
                closeWorkspace();
                showNotification(`Switched to project: ${project.name}`, 'success');
            }
        }
        
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            // Fill form with existing data
            document.getElementById('projectName').value = project.name;
            document.getElementById('clientName').value = project.clientName;
            
            // Update form to edit mode
            const form = document.getElementById('projectForm');
            form.dataset.editId = projectId;
            
            // Update modal title and button
            document.querySelector('#projectModal h2').textContent = 'Edit Project';
            document.querySelector('#projectModal button[type="submit"]').textContent = 'Save Changes';
            
            // Show modal
            document.getElementById('projectModal').classList.remove('hidden');
        }
        
        function deleteProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            if (confirm(`Are you sure you want to delete "${project.name}"? This will also delete all associated processes.`)) {
                // Remove project
                projects = projects.filter(p => p.id !== projectId);
                saveProjects();
                
                // Remove associated processes
                localStorage.removeItem(`processes_${projectId}`);
                
                // Clear current selection if deleted
                if (currentProjectId === projectId) {
                    currentProjectId = null;
                    processes = [];
                    document.getElementById('currentProject').textContent = 'Select Project ';
                    updateDashboard();
                }
                
                renderProjectList();
                showNotification('Project deleted successfully', 'success');
            }
        }
        
        async function createProjectWithBackend(projectData) {
            try {
                if (window.workshopDB && window.workshopDB.isConnected()) {
                    const newProject = await window.workshopDB.createProject(projectData);
                    
                    // Mark as Supabase project
                    newProject.storageType = 'supabase';
                    
                    // Generate department tokens
                    const departments = ['Finance', 'Operations', 'HR', 'IT', 'Marketing', 'Sales'];
                    await window.workshopDB.generateDepartmentTokens(newProject.id, departments);
                    
                    console.log(' Project created with backend:', newProject.id);
                    return newProject;
                } else {
                    // Fallback to localStorage
                    const localProject = {
                        id: generateId(),
                        name: projectData.name,
                        clientName: projectData.description,
                        storageType: 'localStorage',
                        createdAt: new Date().toISOString()
                    };
                    return localProject;
                }
            } catch (error) {
                console.error(' Backend project creation error:', error);
                // Fallback to localStorage
                const localProject = {
                    id: generateId(),
                    name: projectData.name,
                    clientName: projectData.description,
                    createdAt: new Date().toISOString()
                };
                return localProject;
            }
        }
        

        // Process Management Functions
        function renderProcessList() {
            const processList = document.getElementById('processList');
            if (!processList) {
                console.log('processList element not found, skipping render');
                return;
            }
            
            // Filter processes by department if in workshop mode or if filter is applied
            let filteredProcesses = processes;
            if (currentDepartmentFilter && currentDepartmentFilter !== 'all') {
                filteredProcesses = processes.filter(process => 
                    process.department === currentDepartmentFilter
                );
            }
            
            if (filteredProcesses.length === 0) {
                const message = currentDepartmentFilter && currentDepartmentFilter !== 'all' 
                    ? `No processes found for ${currentDepartmentFilter}` 
                    : 'No processes added yet';
                processList.innerHTML = `<div class="text-white/60 text-center py-4">${message}</div>`;
                return;
            }
            
            processList.innerHTML = filteredProcesses.map(process => {
                const avgScore = (process.scores.repetitive + process.scores.dataDriven + process.scores.ruleBased + process.scores.highVolume) / 4;
                const scoreColor = avgScore >= 7 ? 'bg-success' : avgScore >= 5 ? 'bg-warning' : 'bg-danger';
                
                // Department color coding for workshop mode
                const departmentColors = {
                    'Finance': 'bg-green-100 text-green-800 border-green-300',
                    'HR': 'bg-orange-100 text-orange-800 border-orange-300',
                    'Operations': 'bg-blue-100 text-blue-800 border-blue-300',
                    'IT': 'bg-purple-100 text-purple-800 border-purple-300',
                    'Marketing': 'bg-pink-100 text-pink-800 border-pink-300',
                    'Sales': 'bg-indigo-100 text-indigo-800 border-indigo-300',
                    'Customer Service': 'bg-teal-100 text-teal-800 border-teal-300',
                    'Legal': 'bg-gray-100 text-gray-800 border-gray-300',
                    'Administration': 'bg-slate-100 text-slate-800 border-slate-300',
                    'R&D': 'bg-cyan-100 text-cyan-800 border-cyan-300',
                    'Quality Assurance': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                    'Procurement': 'bg-emerald-100 text-emerald-800 border-emerald-300',
                    'Facilities': 'bg-stone-100 text-stone-800 border-stone-300',
                    'Other': 'bg-neutral-100 text-neutral-800 border-neutral-300'
                };
                
                const departmentStyle = workshopReviewMode && departmentColors[process.department] 
                    ? departmentColors[process.department] 
                    : '';
                
                const borderClass = workshopReviewMode && departmentColors[process.department] 
                    ? `border-2 ${departmentColors[process.department].split(' ')[2]}` 
                    : 'border border-gray-200';
                
                return `
                    <div class="process-card group relative rounded-lg p-4 fade-in bg-white/95 ${borderClass} hover:shadow-md transition-all duration-200">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 pr-4">${process.name}</h4>
                                <div class="flex items-center space-x-2 mt-1">
                                    ${workshopReviewMode && departmentStyle ? 
                                        `<span class="text-xs px-2 py-1 rounded-full ${departmentStyle}">${process.department}</span>` : 
                                        `<p class="text-sm text-gray-600">${process.department}</p>`
                                    }
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="${scoreColor} text-white text-xs px-3 py-1 rounded-full font-semibold">${avgScore.toFixed(1)}/10</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-700 space-y-1 mb-3">
                            <div class="flex justify-between">
                                <span>Impact:</span>
                                <span class="font-medium">${process.impact}/10</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Feasibility:</span>
                                <span class="font-medium">${process.feasibility}/10</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Weekly Time:</span>
                                <span class="font-medium">${process.timeSpent} hrs</span>
                            </div>
                        </div>
                        ${!workshopMode || isAdmin ? `
                        <div class="flex justify-end space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <button onclick="editProcess('${process.id}')" class="text-blue-600 hover:text-blue-800 p-2 rounded hover:bg-blue-50 transition-colors" title="Edit process">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button onclick="deleteProcess('${process.id}')" class="text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50 transition-colors" title="Delete process">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function editProcess(processId) {
            const process = processes.find(p => p.id === processId);
            if (!process) return;
            
            editingProcessId = processId;
            
            // Fill form with existing data - Step 1
            document.getElementById('processName').value = process.name;
            document.getElementById('processDepartment').value = process.department === 'Custom' ? 'Custom' : process.department;
            if (process.department === 'Custom') {
                document.getElementById('customDepartment').value = process.customDepartment || '';
                toggleCustomDepartment();
            }
            document.getElementById('timeSpent').value = process.timeSpent;
            
            // Fill slider values - Step 2
            if (process.scores) {
                document.getElementById('repetitive').value = process.scores.repetitive || 5;
                document.getElementById('dataDriven').value = process.scores.dataDriven || 5;
                document.getElementById('ruleBased').value = process.scores.ruleBased || 5;
                document.getElementById('highVolume').value = process.scores.highVolume || 5;
                
                // Update slider displays
                updateSliderValue('repetitive', process.scores.repetitive || 5);
                updateSliderValue('dataDriven', process.scores.dataDriven || 5);
                updateSliderValue('ruleBased', process.scores.ruleBased || 5);
                updateSliderValue('highVolume', process.scores.highVolume || 5);
            }
            
            // Fill impact and feasibility values - Step 3
            document.getElementById('impact').value = process.impact || 5;
            document.getElementById('feasibility').value = process.feasibility || 5;
            updateSliderValue('impact', process.impact || 5);
            updateSliderValue('feasibility', process.feasibility || 5);
            
            // Fill notes - Step 4
            document.getElementById('notes').value = process.notes || '';
            
            // Show the modal in edit mode
            document.getElementById('addProcessModal').classList.remove('hidden');
            currentStep = 1;
            showStep(1);
            updateStepIndicator();
        }

        function deleteProcess(processId) {
            const process = processes.find(p => p.id === processId);
            if (!process) return;
            
            if (confirm(`Are you sure you want to delete "${process.name}"?`)) {
                processes = processes.filter(p => p.id !== processId);
                saveProcesses();
                renderProcessList();
                updateCharts();
                updateMetrics();
                showNotification('Process deleted successfully', 'success');
            }
        }

        function saveProcesses() {
            if (currentProjectId) {
                localStorage.setItem(`processes_${currentProjectId}`, JSON.stringify(processes));
            }
        }

        function initializeDashboard() {
            debugLog(` Initializing dashboard...`);
            
            // Initialize projects data
            initializeProjects();
            
            // Set default currentProjectId if projects exist but none selected
            if (projects.length > 0 && !currentProjectId) {
                currentProjectId = projects[0].id; // Use first project as default
                console.log(' Set default currentProjectId:', currentProjectId);
            }
            
            // Populate project selector with real projects
            updateProjectDropdowns();
            
            // Initialize charts
            setTimeout(() => {
                recreateCharts();
                showFabCluster();
            }, 200);
            
            // Enhance with database functionality
            enhanceInitializeDashboard();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog(` Page loaded, initializing dashboard...`);
            initializeDebugPanel();
            initializeDashboard();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            debugLog(` Window resized, recreating charts...`);
            setTimeout(recreateCharts, 100);
        });

        // ===== MISSING FUNCTIONS FROM BACKUP - START =====
        
        // Settings Panel Functions
        function logout() {
            // For this dashboard, logout just shows a confirmation message
            // since there's no login screen in this standalone version
            if (confirm('Are you sure you want to reset the session?')) {
                // Clear any temporary data
                localStorage.removeItem('currentProject');
                
                // Show notification
                showNotification('Session cleared successfully', 'success');
                
                // Reset to default project
                currentProject = 'SunSep7';
                document.getElementById('headerProjectSelector').value = currentProject;
                
                // Recreate charts with default data
                recreateCharts();
                
                // Close settings panel
                closeHeaderSettings();
            }
        }

        function showBulkActions() {
            // Create bulk actions modal
            const modalHtml = `
                <div id="bulkModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl p-8 w-full max-w-2xl shadow-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900"> Bulk Actions</h2>
                            <button onclick="closeBulkModal()" class="text-gray-400 hover:text-gray-600 text-2xl"></button>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold mb-2">Department Actions</h3>
                                <div class="space-y-2">
                                    <button onclick="bulkDeleteByDepartment()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-red-50 hover:border-red-300">
                                         Delete all processes from a specific department
                                    </button>
                                    <button onclick="bulkMoveToProject()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300">
                                         Move processes to different project
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-semibold mb-2">Score Actions</h3>
                                <div class="space-y-2">
                                    <button onclick="bulkAdjustScores()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-yellow-50 hover:border-yellow-300">
                                         Adjust scores for low-quality submissions
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function closeBulkModal() {
            const modal = document.getElementById('bulkModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function bulkDeleteByDepartment() {
            const dept = prompt('Enter department name to delete all processes (this cannot be undone):');
            if (!dept) return;
            
            // Since we're using projectData instead of processes array
            const currentData = projectData[currentProject] || [];
            const matchingProcesses = currentData.filter(p => p.department && p.department.toLowerCase() === dept.toLowerCase());
            
            if (matchingProcesses.length === 0) {
                showNotification('No processes found for that department', 'error');
                return;
            }
            
            if (confirm(`Delete ${matchingProcesses.length} processes from ${dept}?`)) {
                projectData[currentProject] = currentData.filter(p => !p.department || p.department.toLowerCase() !== dept.toLowerCase());
                recreateCharts();
                showNotification(`Deleted ${matchingProcesses.length} processes from ${dept}`, 'success');
                closeBulkModal();
            }
        }
        
        function bulkMoveToProject() {
            showNotification('Bulk move feature coming soon', 'info');
            closeBulkModal();
        }
        
        function bulkAdjustScores() {
            showNotification('Bulk score adjustment feature coming soon', 'info');
            closeBulkModal();
        }

        function showDepartmentLinks() {
            const baseUrl = window.location.origin + window.location.pathname;
            const departmentTokens = {
                'Finance': 'fin_2024',
                'HR': 'hr_2024', 
                'Operations': 'ops_2024',
                'Sales': 'sales_2024',
                'Marketing': 'mkt_2024',
                'IT': 'it_2024',
                'Customer Service': 'cs_2024',
                'Legal': 'legal_2024',
                'Administration': 'admin_2024',
                'R&D': 'rd_2024',
                'Quality Assurance': 'qa_2024',
                'Procurement': 'proc_2024',
                'Facilities': 'fac_2024',
                'Other': 'other_2024'
            };
            
            const modalHtml = `
                <div id="linksModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900"> Department Workshop Links</h2>
                            <button onclick="closeLinksModal()" class="text-gray-400 hover:text-gray-600 text-2xl"></button>
                        </div>
                        <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <h3 class="font-semibold text-blue-800 mb-2"> Instructions:</h3>
                            <ol class="text-sm text-blue-700 space-y-1">
                                <li>1. Copy the link for each department</li>
                                <li>2. Send to department leads via email/chat</li>
                                <li>3. Department leads click their unique link to submit processes</li>
                                <li>4. Return here to review all submissions in Workshop Mode</li>
                            </ol>
                        </div>
                        <div class="space-y-3">
                            ${Object.keys(departmentTokens).map(dept => {
                                const deptKey = dept.toLowerCase().replace(/\s+/g, '');
                                const url = `${baseUrl}?dept=${deptKey}&token=${departmentTokens[dept]}`;
                                return `
                                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                                        <div class="flex-1">
                                            <div class="font-semibold text-gray-900">${dept}</div>
                                            <div class="text-sm text-gray-500 font-mono break-all">${url}</div>
                                        </div>
                                        <button onclick="copyToClipboard('${url}', '${dept}')" class="ml-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium">
                                             Copy
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="mt-6 text-center">
                            <button onclick="copyAllLinks()" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium">
                                 Copy All Links
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function copyToClipboard(text, department) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`${department} link copied to clipboard!`, 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`${department} link copied to clipboard!`, 'success');
            });
        }
        
        function copyAllLinks() {
            const baseUrl = window.location.origin + window.location.pathname;
            const departmentTokens = {
                'Finance': 'fin_2024',
                'HR': 'hr_2024', 
                'Operations': 'ops_2024',
                'Sales': 'sales_2024',
                'Marketing': 'mkt_2024',
                'IT': 'it_2024',
                'Customer Service': 'cs_2024',
                'Legal': 'legal_2024',
                'Administration': 'admin_2024',
                'R&D': 'rd_2024',
                'Quality Assurance': 'qa_2024',
                'Procurement': 'proc_2024',
                'Facilities': 'fac_2024',
                'Other': 'other_2024'
            };
            
            const allLinks = Object.keys(departmentTokens).map(dept => {
                const deptKey = dept.toLowerCase().replace(/\s+/g, '');
                const url = `${baseUrl}?dept=${deptKey}&token=${departmentTokens[dept]}`;
                return `${dept}: ${url}`;
            }).join('\n\n');
            
            const fullMessage = ` Department Workshop Links - Business Automation Tool\n\n` +
                `Instructions:\n` +
                `- Click your department's link below\n` +
                `- Fill out the business process form\n` +
                `- Submit processes your team wants to automate\n` +
                `- Workshop review will happen after all submissions\n\n` +
                `${allLinks}`;
            
            navigator.clipboard.writeText(fullMessage).then(() => {
                showNotification('All department links copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = fullMessage;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('All department links copied to clipboard!', 'success');
            });
        }
        
        function closeLinksModal() {
            const modal = document.getElementById('linksModal');
            if (modal) {
                modal.remove();
            }
        }

        function showDuplicateDetection() {
            // For demo purposes, show a simple notification
            showNotification(' Duplicate detection feature - coming soon!', 'info');
        }

        // Workspace Functions
        let currentWorkspace = null;
        
        function openProjectWorkspace() {
            closeFabMenu();
            showWorkspace('project', 'Project Overview', createProjectWorkspace());
        }
        
        function openProcessWorkspace() {
            closeFabMenu();
            showWorkspace('process', 'Process Entry', createProcessWorkspace());
        }

        function openPresentationMode() {
            closeFabMenu();
            showWorkspace('presentation', 'Workshop Presentation', createPresentationWorkspace());
        }
        
        function showWorkspace(type, title, content) {
            currentWorkspace = type;
            
            // Create workspace overlay if it doesn't exist
            let workspace = document.getElementById('contextualWorkspace');
            if (!workspace) {
                workspace = document.createElement('div');
                workspace.id = 'contextualWorkspace';
                workspace.className = 'contextual-workspace';
                workspace.onclick = (e) => {
                    if (e.target === workspace) closeWorkspace();
                };
                document.body.appendChild(workspace);
            }
            
            workspace.innerHTML = `
                <div class="workspace-content">
                    <header class="workspace-header">
                        <div class="workspace-header-left">
                            <button class="workspace-back-btn" onclick="closeWorkspace()">
                                <svg fill="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
                                </svg>
                            </button>
                            <h1 class="workspace-title">${title}</h1>
                            <span class="workspace-badge">Full View</span>
                        </div>
                        <div class="workspace-actions">
                            <button class="btn-system" onclick="closeWorkspace()">Close</button>
                        </div>
                    </header>
                    <div class="workspace-body">
                        ${content}
                    </div>
                </div>
            `;
            
            // Blur dashboard background
            const dashboard = document.querySelector('.container');
            if (dashboard) {
                dashboard.classList.add('dashboard-blur');
            }
            
            // Activate workspace with animation
            setTimeout(() => {
                workspace.classList.add('active');
            }, 10);
        }
        
        function closeWorkspace() {
            const workspace = document.getElementById('contextualWorkspace');
            const dashboard = document.querySelector('.container');
            
            if (workspace) {
                workspace.classList.remove('active');
                setTimeout(() => {
                    workspace.remove();
                }, 400);
            }
            
            // Remove dashboard blur
            if (dashboard) {
                dashboard.classList.remove('dashboard-blur');
            }
            
            currentWorkspace = null;
        }

        function closeFabMenu() {
            const cluster = document.getElementById('fabCluster');
            const icon = document.getElementById('fabIcon');
            
            if (cluster && cluster.classList.contains('expanded')) {
                cluster.classList.remove('expanded');
                icon.textContent = '';
                fabExpanded = false;
            }
        }

        // Workspace Content Creators
        function createProjectWorkspace() {
            return `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-semibold text-gray-900">Project Overview</h2>
                            <button class="btn-primary flex items-center whitespace-nowrap" onclick="openProjectModal()">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                New Project
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Active Projects</h3>
                                <p class="text-3xl font-bold text-blue-600">${projects.length}</p>
                            </div>
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Total Processes</h3>
                                <p class="text-3xl font-bold text-green-600">${processes.length}</p>
                            </div>
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Departments</h3>
                                <p class="text-3xl font-bold text-purple-600">${new Set(processes.map(p => p.department)).size}</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-900">All Projects</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="workspaceProjectList">
                            ${projects.map(project => `
                                <div class="admin-control-card hover:shadow-lg transition-all duration-200 cursor-pointer" onclick="selectProject('${project.id}'); closeWorkspace();">
                                    <div class="flex justify-between items-start mb-3">
                                        <h4 class="font-semibold text-gray-900">${project.name}</h4>
                                        <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">Active</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">${project.clientName || 'No description'}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-500">
                                            ${processes.filter(p => p.projectId === project.id).length} processes
                                        </span>
                                        <div class="flex space-x-2">
                                            <button onclick="editProject('${project.id}'); event.stopPropagation();" class="text-blue-600 hover:text-blue-800 text-sm">
                                                Edit
                                            </button>
                                            <button onclick="deleteProject('${project.id}'); event.stopPropagation();" class="text-red-600 hover:text-red-800 text-sm">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function createProcessWorkspace() {
            return `
                <div style="max-width: 1000px; margin: 0 auto;">
                    <div class="mb-8">
                        <h2 class="text-2xl font-semibold text-gray-900 mb-4">Enhanced Process Entry</h2>
                        <p class="text-gray-600 mb-6">Add new business processes with detailed automation assessment</p>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <h3 class="font-semibold text-blue-800 mb-2">Quick Tips</h3>
                            <ul class="text-sm text-blue-700 space-y-1">
                                <li> Be specific about process names and departments</li>
                                <li> Higher scores indicate better automation potential</li>
                                <li> Time estimates help prioritize implementation</li>
                            </ul>
                        </div>
                        
                        <button class="btn-primary mb-6" onclick="addProcess(); closeWorkspace();">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            Add New Process
                        </button>
                        
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Recent Processes</h3>
                        <div class="space-y-4">
                            ${processes.slice(-5).reverse().map(process => {
                                const avgScore = (process.scores.repetitive + process.scores.dataDriven + process.scores.ruleBased + process.scores.highVolume) / 4;
                                const scoreColor = avgScore >= 7 ? 'bg-green-100 text-green-800' : avgScore >= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                                return `
                                    <div class="admin-control-card">
                                        <div class="flex justify-between items-start">
                                            <div class="flex-1">
                                                <h4 class="font-semibold text-gray-900">${process.name}</h4>
                                                <p class="text-sm text-gray-600">${process.department}</p>
                                                <p class="text-xs text-gray-500 mt-1">${process.timeSpent} hours/week</p>
                                            </div>
                                            <div class="flex items-center space-x-3">
                                                <span class="text-xs px-2 py-1 rounded-full ${scoreColor}">${avgScore.toFixed(1)}/10</span>
                                                <button onclick="editProcess('${process.id}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                                    Edit
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function createPresentationWorkspace() {
            return `
                <div style="max-width: 1400px; margin: 0 auto; padding: 20px;">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4">Workshop Presentation Mode</h2>
                        <p class="text-gray-600">Full-screen view optimized for workshop presentations and stakeholder reviews.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <canvas id="presentationBubbleChart" class="w-full h-96"></canvas>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <canvas id="presentationDonutChart" class="w-full h-96"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-8 rounded-xl border border-gray-200">
                        <h3 class="text-xl font-semibold mb-4">Key Insights</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center p-6 bg-blue-50 rounded-xl">
                                <div class="text-3xl font-bold text-blue-600">${(projectData[currentProject] || []).length}</div>
                                <div class="text-sm text-blue-800">Total Processes</div>
                            </div>
                            <div class="text-center p-6 bg-green-50 rounded-xl">
                                <div class="text-3xl font-bold text-green-600">${(projectData[currentProject] || []).filter(p => p.impact >= 8).length}</div>
                                <div class="text-sm text-green-800">High Impact</div>
                            </div>
                            <div class="text-center p-6 bg-purple-50 rounded-xl">
                                <div class="text-3xl font-bold text-purple-600">${Math.round((projectData[currentProject] || []).reduce((sum, p) => sum + p.timeSpent, 0))}</div>
                                <div class="text-sm text-purple-800">Total Hours/Week</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }


        // ===== MISSING FUNCTIONS FROM BACKUP - END =====

        // ===== DATABASE FUNCTIONALITY FUNCTIONS - START =====
        
        // Database Reset Functions
        function showResetConfirmation() {
            const modal = document.getElementById('resetConfirmationModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Close any open settings panels
                closeHeaderSettings();
            }
        }
        
        function hideResetConfirmation() {
            const modal = document.getElementById('resetConfirmationModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        function confirmResetDatabase() {
            // Hide the modal first
            hideResetConfirmation();
            
            // Add a small delay then proceed with reset
            setTimeout(() => {
                performDatabaseReset();
            }, 300);
        }
        
        async function performDatabaseReset() {
            try {
                showNotification(' Resetting database...', 'info');
                
                // Call the reset function if workshopDB is available
                if (window.workshopDB) {
                    const result = await window.workshopDB.resetDatabase();
                    
                    if (result.success) {
                        showNotification(
                            ` ${result.message}`, 
                            'success'
                        );
                        
                        // Clear current project state
                        currentProject = 'SunSep7';
                        
                        // Close settings panel
                        closeHeaderSettings();
                        
                        // Reset to default data
                        recreateCharts();
                        
                    } else {
                        throw new Error(result.message || 'Reset failed');
                    }
                } else {
                    // Fallback to local reset
                    localStorage.clear();
                    currentProject = 'SunSep7';
                    document.getElementById('headerProjectSelector').value = currentProject;
                    recreateCharts();
                    showNotification(' Local data reset successfully', 'success');
                    closeHeaderSettings();
                }
            } catch (error) {
                console.error(' Database reset failed:', error);
                showNotification(
                    ` Database reset failed: ${error.message}`, 
                    'error'
                );
            }
        }

        // Connection Status Functions
        function updateSettingsConnectionStatus() {
            const statusBadge = document.getElementById('connectionStatus');
            if (!statusBadge) {
                console.warn(' Connection status element not found');
                return;
            }
            
            const indicator = statusBadge.querySelector('.status-indicator');
            const text = statusBadge.querySelector('.status-text');
            
            if (!indicator || !text) {
                console.warn(' Status indicator elements not found');
                return;
            }
            
            // Check if database is available and connected
            let isOnline = false;
            let statusText = 'Offline';
            
            try {
                if (window.workshopDB && typeof window.workshopDB.isConnected === 'function') {
                    isOnline = window.workshopDB.isConnected();
                    const status = window.workshopDB.getConnectionStatus();
                    statusText = isOnline ? `${status.database} Connected` : 'localStorage Only';
                } else {
                    statusText = 'localStorage Only';
                }
            } catch (error) {
                console.log('Database not available, running in offline mode');
                statusText = 'localStorage Only';
            }
            
            // Update UI
            indicator.className = 'status-indicator';
            if (isOnline) {
                indicator.classList.add('online');
            } else {
                indicator.classList.add('offline');
            }
            
            text.textContent = statusText;
            
            console.log(` Connection Status: ${statusText}`);
        }

        // Enhanced Project Data Management
        async function loadProjects() {
            // Load projects using workshopDB (Supabase + localStorage fallback)
            if (window.workshopDB) {
                const loadedProjects = await window.workshopDB.getProjects();
                projects = loadedProjects;
                console.log(' Projects loaded:', projects.length);
                
                // If no projects exist, create sample projects
                if (projects.length === 0) {
                    await createDefaultProjects();
                }
                
                renderProjectList();
            } else {
                // Fallback to localStorage
                const savedProjects = localStorage.getItem('businessProjects');
                if (savedProjects) {
                    projects = JSON.parse(savedProjects);
                } else {
                    // Create default projects if none exist
                    createDefaultProjectsLocal();
                }
                renderProjectList();
            }
        }

        async function createDefaultProjects() {
            const defaultProjects = [
                {
                    name: 'Q4 Business Process Automation',
                    description: 'Quarterly automation initiative for business process optimization',
                    workshopDate: new Date().toISOString().split('T')[0],
                    facilitatorEmail: 'admin@company.com',
                    metadata: { department: 'Operations', priority: 'High' }
                },
                {
                    name: 'HR Process Digitization',
                    description: 'Digital transformation project for HR department processes',
                    workshopDate: new Date().toISOString().split('T')[0],
                    facilitatorEmail: 'admin@company.com',
                    metadata: { department: 'HR', priority: 'Medium' }
                }
            ];

            for (const projectData of defaultProjects) {
                const project = await window.workshopDB.createProject(projectData);
                projects.push(project);
            }
            console.log(' Default projects created:', projects.length);
        }

        function createDefaultProjectsLocal() {
            projects = [
                {
                    id: generateId(),
                    name: 'Q4 Business Process Automation',
                    description: 'Quarterly automation initiative for business process optimization',
                    createdAt: new Date().toISOString(),
                    department: 'Operations'
                },
                {
                    id: generateId(),
                    name: 'HR Process Digitization',
                    description: 'Digital transformation project for HR department processes',
                    createdAt: new Date().toISOString(),
                    department: 'HR'
                }
            ];
            localStorage.setItem('businessProjects', JSON.stringify(projects));
            console.log(' Default projects created locally:', projects.length);
        }

        function saveProjects() {
            localStorage.setItem('businessProjects', JSON.stringify(projects));
        }

        // Initialize Database Connection
        function initializeDatabaseConnection() {
            console.log(' Initializing database connection...');
            
            try {
                // Check if workshopDB is available
                if (window.workshopDB) {
                    const status = window.workshopDB.getConnectionStatus();
                    console.log(' Database Status:', status);
                }
            } catch (error) {
                console.log('Database not available, running in offline mode');
            }
            
            // Update connection status in settings
            updateSettingsConnectionStatus();
            
            // Load projects list
            loadProjects();
        }

        // Enhanced Settings Panel Initialization
        function initializeSettingsPanel() {
            console.log(' Initializing settings panel with database functionality...');
            
            // Initialize connection status
            updateSettingsConnectionStatus();
            
            // Update connection status periodically
            setInterval(updateSettingsConnectionStatus, 30000); // Every 30 seconds
            
            console.log(' Settings panel initialized with database features');
        }

        // Enhanced initialization with database features
        function enhanceInitializeDashboard() {
            debugLog(` Enhancing dashboard with database functionality...`);
            
            // Initialize database connection
            initializeDatabaseConnection();
            
            // Initialize settings panel
            initializeSettingsPanel();
        }

        // ===== DATABASE FUNCTIONALITY FUNCTIONS - END =====
    </script>

    <!-- Database Reset Confirmation Modal -->
    <div id="resetConfirmationModal" class="reset-confirmation-modal">
        <div class="reset-modal-backdrop" onclick="hideResetConfirmation()"></div>
        <div class="reset-modal-content">
            <div class="reset-modal-header">
                <div class="reset-modal-icon">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-2.694-.833-3.464 0L3.349 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                </div>
                <h3 class="reset-modal-title">Reset Database?</h3>
                <p class="reset-modal-description">
                    This will permanently delete all projects, processes, and workshop data. This action cannot be undone.
                </p>
            </div>
            <div class="reset-modal-actions">
                <button onclick="hideResetConfirmation()" class="reset-cancel-btn">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    Cancel
                </button>
                <button onclick="confirmResetDatabase()" class="reset-confirm-btn">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Yes, Delete Everything
                </button>
            </div>
        </div>
    </div>

    <div id="projectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden" style="z-index: 100000;">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Create New Project</h2>
                <button onclick="closeProjectModal()" class="text-gray-500 hover:text-gray-700 text-xl"></button>
            </div>
            <form id="projectForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                    <input type="text" id="projectName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-energy-blue focus:border-energy-blue" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                    <input type="text" id="clientName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-energy-blue focus:border-energy-blue" required>
                </div>
                <div class="flex justify-between space-x-4">
                    <button type="button" onclick="closeProjectModal()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium">
                        Create Project 
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Process Modal -->
    <div id="processModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden" style="z-index: 150;">
        <div class="bg-white rounded-2xl p-8 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900">Add Business Process</h2>
                    <p class="text-gray-600 mt-1">Define a new process for automation analysis</p>
                </div>
                <button onclick="closeProcessModal()" class="text-gray-400 hover:text-gray-600 text-2xl transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <!-- Step Navigation -->
            <div class="flex justify-center mb-8">
                <div class="flex items-center space-x-4">
                    <div class="step-indicator active" data-step="1">
                        <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-bold">1</div>
                        <span class="text-sm font-medium text-gray-700 mt-2">Basic Info</span>
                    </div>
                    <div class="w-12 h-1 bg-gray-200 rounded"></div>
                    <div class="step-indicator" data-step="2">
                        <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center text-sm font-bold">2</div>
                        <span class="text-sm font-medium text-gray-500 mt-2">How You Work</span>
                    </div>
                    <div class="w-12 h-1 bg-gray-200 rounded"></div>
                    <div class="step-indicator" data-step="3">
                        <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center text-sm font-bold">3</div>
                        <span class="text-sm font-medium text-gray-500 mt-2">Business Impact</span>
                    </div>
                </div>
            </div>

            <form id="processForm" class="space-y-6">
                <!-- Step 1: Basic Information -->
                <div id="step1" class="step-content">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Let's start with the basics</h3>
                        <p class="text-gray-600">Tell us about the process you'd like to analyze</p>
                    </div>
                    
                    <!-- Quick Templates -->
                    <div class="bg-blue-50 p-6 rounded-xl mb-6">
                        <h4 class="font-semibold text-gray-800 mb-4"> Quick Start: Choose a common process</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('invoicing')">
                                <div class="font-medium text-sm"> Processing Invoices</div>
                                <div class="text-xs text-gray-500">Finance/Accounting</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('scheduling')">
                                <div class="font-medium text-sm"> Staff Scheduling</div>
                                <div class="text-xs text-gray-500">Operations</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('orders')">
                                <div class="font-medium text-sm"> Processing Orders</div>
                                <div class="text-xs text-gray-500">Sales/Operations</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('payroll')">
                                <div class="font-medium text-sm"> Payroll Processing</div>
                                <div class="text-xs text-gray-500">HR/Finance</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('inventory')">
                                <div class="font-medium text-sm"> Inventory Management</div>
                                <div class="text-xs text-gray-500">Operations</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('customer')">
                                <div class="font-medium text-sm"> Customer Support</div>
                                <div class="text-xs text-gray-500">Service</div>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-3"> Click any template to auto-fill, then customize as needed</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3 field-required">What do you call this process?</label>
                            <input type="text" id="processName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="e.g., Paying suppliers, Scheduling staff, Processing orders" required>
                            <div class="validation-error hidden" id="processName-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please enter a name for this process
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Give it a simple name that you and your team would recognize</p>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3 field-required">Which department owns this process?</label>
                            <select id="processDepartment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" required onchange="toggleCustomDepartment()">
                                <option value="">Select department...</option>
                                <option value="Finance"> Finance & Accounting</option>
                                <option value="HR"> Human Resources</option>
                                <option value="Operations"> Operations</option>
                                <option value="Sales"> Sales</option>
                                <option value="Marketing"> Marketing</option>
                                <option value="IT"> Information Technology</option>
                                <option value="Customer Service"> Customer Service</option>
                                <option value="Legal"> Legal & Compliance</option>
                                <option value="Administration"> Administration</option>
                                <option value="R&D"> Research & Development</option>
                                <option value="Quality Assurance"> Quality Assurance</option>
                                <option value="Procurement"> Procurement</option>
                                <option value="Facilities"> Facilities</option>
                                <option value="Custom"> Other (specify below)</option>
                            </select>
                            <div class="validation-error hidden" id="processDepartment-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please select a department or team
                            </div>
                            <input type="text" id="customDepartment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors mt-3 hidden" placeholder="Enter department/team name" maxlength="50">
                            <p class="text-xs text-gray-500 mt-1">This helps organize processes by department for workshop analysis</p>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-6 rounded-xl">
                        <label class="block text-sm font-semibold text-gray-700 mb-4">How much time does this process take?</label>
                        <div class="flex items-center space-x-4 mb-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="timeUnit" value="daily" class="mr-2" checked onchange="updateTimeUnit()">
                                <span class="text-sm font-medium">Per day</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="timeUnit" value="weekly" class="mr-2" onchange="updateTimeUnit()">
                                <span class="text-sm font-medium">Per week</span>
                            </label>
                        </div>
                        <!-- Time display above slider -->
                        <div class="text-center mb-3">
                            <span id="timeSpentValue" class="text-2xl font-bold text-primary">2 hours per day</span>
                        </div>
                        <input type="range" id="timeSpent" min="1" max="8" value="2" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer time-slider" oninput="updateTimeDisplay()">
                        <div class="flex justify-between text-sm text-gray-500 mt-2">
                            <span id="timeMin">1 hour</span>
                            <span id="timeMax">8+ hours</span>
                        </div>
                        <div id="timeConversion" class="text-xs text-blue-600 mt-2">
                             <span id="convertedTime">10.0</span> hours per week
                        </div>
                        <p class="text-xs text-gray-600 mt-2"> Include time from everyone who works on this process</p>
                    </div>
                </div>

                <!-- Step 2: How You Work -->
                <div id="step2" class="step-content hidden">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">How do you currently handle this?</h3>
                        <p class="text-gray-600">Help us understand your current process</p>
                    </div>

                    <div class="space-y-6">
                        <!-- Frequency Question -->
                        <div class="bg-green-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">How often do you do this process?</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="frequency-option cursor-pointer">
                                    <input type="radio" name="frequency" value="daily" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Multiple times daily</div>
                                        <div class="text-xs text-gray-500">Several times per day</div>
                                    </div>
                                </label>
                                <label class="frequency-option cursor-pointer">
                                    <input type="radio" name="frequency" value="weekly" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Daily or weekly</div>
                                        <div class="text-xs text-gray-500">Regular routine</div>
                                    </div>
                                </label>
                                <label class="frequency-option cursor-pointer">
                                    <input type="radio" name="frequency" value="monthly" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Monthly</div>
                                        <div class="text-xs text-gray-500">End of month tasks</div>
                                    </div>
                                </label>
                                <label class="frequency-option cursor-pointer">
                                    <input type="radio" name="frequency" value="rarely" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">As needed</div>
                                        <div class="text-xs text-gray-500">Irregular timing</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Information Sources -->
                        <div class="bg-purple-50 p-6 rounded-xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-800 field-required">What information do you need to complete this process?</h4>
                                <span class="text-sm text-purple-600 font-medium">Select all that apply</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-4"> You can select multiple options - choose everything you typically use</p>
                            <div class="validation-error hidden" id="infoSource-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please select at least one information source
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="info-source cursor-pointer">
                                    <input type="checkbox" name="infoSource" value="spreadsheets" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Spreadsheets or databases</div>
                                                <div class="text-xs text-gray-500">Excel, Google Sheets, databases</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer">
                                    <input type="checkbox" name="infoSource" value="documents" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Documents or emails</div>
                                                <div class="text-xs text-gray-500">PDFs, Word docs, email attachments</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer">
                                    <input type="checkbox" name="infoSource" value="communication" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Phone calls or meetings</div>
                                                <div class="text-xs text-gray-500">Talking with people to get info</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer">
                                    <input type="checkbox" name="infoSource" value="experience" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Experience and judgment</div>
                                                <div class="text-xs text-gray-500">You just know how to do it</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer">
                                    <input type="checkbox" name="infoSource" value="other" class="sr-only" onchange="toggleOtherInfo()">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div class="flex-1">
                                                <div class="font-medium">Other sources</div>
                                                <input type="text" id="otherInfoSource" class="text-xs text-gray-500 border-0 bg-transparent p-0 mt-1 w-full hidden" placeholder="Specify other information sources" maxlength="100">
                                                <div class="text-xs text-gray-500 mt-1" id="otherInfoPlaceholder">Specify other information sources</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Process Consistency -->
                        <div class="bg-orange-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4 field-required">How consistent is this process?</h4>
                            <div class="validation-error hidden" id="consistency-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please select how consistent this process is
                            </div>
                            <div class="space-y-3">
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="exact" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">I follow the exact same steps every time</div>
                                                <div class="text-xs text-gray-500">There's a clear procedure that never changes</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="similar" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">I follow steps but make small adjustments</div>
                                                <div class="text-xs text-gray-500">Basic process is the same, but details vary</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="different" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">I use different approaches each time</div>
                                                <div class="text-xs text-gray-500">Each situation needs a custom solution</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="creative" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">It requires creativity and intuition</div>
                                                <div class="text-xs text-gray-500">Success depends on experience and insight</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Volume Assessment -->
                        <div class="bg-red-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">How much work does this process involve?</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="low" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Just a few items</div>
                                        <div class="text-xs text-gray-500">1-10 things to process</div>
                                    </div>
                                </label>
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="medium" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Moderate amount</div>
                                        <div class="text-xs text-gray-500">10-50 things</div>
                                    </div>
                                </label>
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="high" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Lots of items</div>
                                        <div class="text-xs text-gray-500">50-200 things</div>
                                    </div>
                                </label>
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="massive" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Huge volume</div>
                                        <div class="text-xs text-gray-500">200+ things</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Business Impact -->
                <div id="step3" class="step-content hidden">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">What's the business impact?</h3>
                        <p class="text-gray-600">Help us understand why this process matters</p>
                    </div>

                    <div class="space-y-6">
                        <!-- Pain Points -->
                        <div class="bg-red-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">What happens when this process gets delayed or goes wrong?</h4>
                            <div class="space-y-3">
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="critical" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Business stops or customers get upset</div>
                                                <div class="text-xs text-gray-500">Major disruption, lost sales, angry customers</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="significant" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Creates problems but business continues</div>
                                                <div class="text-xs text-gray-500">Delays, extra work, some customer impact</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="moderate" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Inconvenient but manageable</div>
                                                <div class="text-xs text-gray-500">Some delays, internal frustration</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="low" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Not a big deal if it's delayed</div>
                                                <div class="text-xs text-gray-500">Nice to have but not urgent</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Implementation Difficulty -->
                        <div class="bg-green-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">How difficult would it be to change or improve this process?</h4>
                            <div class="space-y-3">
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="easy" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Pretty straightforward</div>
                                                <div class="text-xs text-gray-500">No special systems or approvals needed</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="moderate" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Would need some planning</div>
                                                <div class="text-xs text-gray-500">Might need new tools or training</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="complex" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Pretty complicated</div>
                                                <div class="text-xs text-gray-500">Involves multiple systems or people</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="difficult" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Very difficult to change</div>
                                                <div class="text-xs text-gray-500">Regulatory, legal, or major system constraints</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Cost of Problems -->
                        <div class="bg-yellow-50 p-6 rounded-xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-800">What does it cost when errors happen in this process?</h4>
                                <div class="currency-toggle">
                                    <label class="inline-flex items-center bg-white rounded-lg p-1 shadow-sm border border-gray-200">
                                        <input type="radio" name="errorCostCurrency" value="USD" class="sr-only" checked onchange="updateErrorCostCurrency('USD')">
                                        <span class="currency-option px-3 py-1 rounded text-sm font-medium cursor-pointer transition-colors bg-blue-100 text-blue-800">USD</span>
                                        <input type="radio" name="errorCostCurrency" value="INR" class="sr-only" onchange="updateErrorCostCurrency('INR')">
                                        <span class="currency-option px-3 py-1 rounded text-sm font-medium cursor-pointer transition-colors text-gray-600 hover:bg-gray-100">INR</span>
                                    </label>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="errorCostOptions">
                                <!-- Cost options will be populated dynamically based on currency -->
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">Any additional details about this process?</h4>
                            <textarea id="processNotes" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="e.g., Involves multiple people, seasonal variations, compliance requirements..."></textarea>
                            <p class="text-xs text-gray-500 mt-2"> This helps us understand any special considerations</p>
                        </div>
                    </div>
                </div>

                <!-- Hidden fields for calculated scores -->
                <input type="hidden" id="repetitive" value="5">
                <input type="hidden" id="dataDriven" value="5">
                <input type="hidden" id="ruleBased" value="5">
                <input type="hidden" id="highVolume" value="5">
                <input type="hidden" id="impact" value="5">
                <input type="hidden" id="feasibility" value="5">

                <!-- Navigation Buttons -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <button type="button" id="prevBtn" onclick="previousStep()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors hidden">
                         Previous
                    </button>
                    <button type="button" onclick="closeProcessModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <div class="flex space-x-3">
                        <button type="button" id="nextBtn" onclick="nextStep()" class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                            Continue 
                        </button>
                        <button type="submit" id="submitBtn" class="px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors hidden">
                            Add Process 
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
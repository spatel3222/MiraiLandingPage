<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AI Opportunity Navigator - Business Process Automation Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Workshop Database Integration -->
    <script src="../api/supabase-config.js"></script>
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="../dist/output.css">
    <style>
        :root {
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --green-500: #10b981;
            --green-600: #059669;
            --green-50: #ecfdf5;
            --green-100: #d1fae5;
            --green-700: #047857;
            --amber-500: #f59e0b;
            --amber-600: #d97706;
            --amber-100: #fef3c7;
            --amber-700: #b45309;
            --red-500: #ef4444;
            --red-600: #dc2626;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --border-radius-sm: 0.375rem;
            --border-radius-md: 0.5rem;
            --border-radius-lg: 0.75rem;
            --border-radius-xl: 1rem;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            color: var(--gray-800);
            line-height: 1.6;
            font-weight: 400;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1920px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: var(--shadow-xl);
        }

        /* Typography System */
        .text-display {
            font-size: 2.25rem;
            line-height: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        .text-h1 {
            font-size: 1.875rem;
            line-height: 2.25rem;
            font-weight: 700;
        }

        .text-h2 {
            font-size: 1.5rem;
            line-height: 2rem;
            font-weight: 600;
        }

        .text-h3 {
            font-size: 1.25rem;
            line-height: 1.75rem;
            font-weight: 600;
        }

        .text-body {
            font-size: 1rem;
            line-height: 1.5rem;
            font-weight: 400;
        }

        .text-small {
            font-size: 0.875rem;
            line-height: 1.25rem;
            font-weight: 400;
        }

        .text-tiny {
            font-size: 0.75rem;
            line-height: 1rem;
            font-weight: 500;
        }

        /* Animation Classes */
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .animate-delay-150 {
            animation-delay: 0.15s;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        .animate-delay-300 {
            animation-delay: 0.3s;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Header Styles */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #e2e8f0;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 4px 0;
            letter-spacing: -0.025em;
        }
        
        .header-title p {
            color: #64748b;
            margin: 0;
            font-size: 0.875rem;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .project-selector {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .project-selector span {
            color: #64748b;
            margin-right: 8px;
        }
        
        .project-selector select {
            background: transparent;
            border: none;
            color: #1e293b;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .project-selector select:hover {
            color: #3b82f6;
        }
        
        /* Modern Settings Button Styles */
        .settings-trigger {
            position: relative;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            color: #64748b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
            min-height: 44px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .settings-trigger::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transition: left 0.5s;
        }
        
        .settings-trigger:hover::before {
            left: 100%;
        }
        
        .settings-trigger:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            color: #334155;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: #cbd5e1;
        }
        
        .settings-trigger:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        
        .settings-trigger.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .settings-trigger.active::before {
            display: none;
        }
        
        .settings-trigger.loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .settings-icon {
            width: 20px;
            height: 20px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .settings-trigger:hover .settings-icon {
            transform: rotate(90deg) scale(1.1);
        }
        
        .settings-trigger.active .settings-icon {
            transform: rotate(180deg);
            color: white;
        }
        
        .settings-trigger.loading .settings-icon {
            animation: settingsSpinner 1s linear infinite;
        }
        
        @keyframes settingsSpinner {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Tooltip for better UX */
        .settings-tooltip {
            position: absolute;
            bottom: -35px;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-5px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }
        
        .settings-tooltip::before {
            content: '';
            position: absolute;
            top: -4px;
            right: 12px;
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 4px solid rgba(0, 0, 0, 0.8);
        }
        
        .settings-trigger:hover .settings-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .settings-trigger.active .settings-tooltip {
            display: none;
        }
        
        /* Focus and accessibility improvements */
        .settings-trigger:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .settings-trigger {
                border-width: 2px;
                border-color: #000;
            }
            
            .settings-trigger:hover {
                background: #000;
                color: #fff;
            }
            
            .settings-dropdown {
                border-width: 2px;
                border-color: #000;
            }
            
            .settings-backdrop {
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: none;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .settings-trigger,
            .settings-trigger::before,
            .settings-icon,
            .settings-tooltip,
            .settings-dropdown,
            .settings-backdrop {
                transition: none;
                animation: none;
            }
            
            .settings-trigger:hover .settings-icon {
                transform: none;
            }
            
            .settings-dropdown {
                transform: none;
            }
            
            .settings-dropdown.active {
                transform: none;
            }
        }
        
        /* Mobile Responsiveness and Touch Targets */
        @media (max-width: 768px) {
            .settings-trigger {
                min-width: 44px;  /* Minimum touch target size */
                min-height: 44px;
                padding: 12px;
                border-radius: 10px;
            }
            
            .settings-icon {
                width: 20px;
                height: 20px;
            }
            
            .settings-tooltip {
                bottom: -40px;
                font-size: 11px;
                padding: 4px 8px;
            }
            
            /* Mobile settings dropdown adjustments */
            .settings-dropdown {
                position: fixed;
                top: 70px;
                left: 16px;
                right: 16px;
                min-width: unset;
                max-width: unset;
                width: calc(100vw - 32px);
                max-height: calc(100vh - 100px);
                border-radius: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .header-controls {
                gap: 16px;
            }
            
            .settings-trigger {
                min-width: 40px;
                min-height: 40px;
                padding: 10px;
            }
            
            .settings-icon {
                width: 18px;
                height: 18px;
            }
            
            .settings-dropdown {
                top: 60px;
                left: 12px;
                right: 12px;
                width: calc(100vw - 24px);
            }
        }
        
        /* Tailwind utility classes for proper icon sizing */
        .w-3 { width: 0.75rem; }
        .h-3 { height: 0.75rem; }
        .w-4 { width: 1rem; }
        .h-4 { height: 1rem; }
        
        /* Screen reader utility classes */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .sr-only-focusable:focus {
            position: static;
            width: auto;
            height: auto;
            padding: 0;
            margin: 0;
            overflow: visible;
            clip: auto;
            white-space: normal;
        }
        
        /* Force Chart.js elements to have lower z-index */
        canvas {
            position: relative;
            z-index: 1 !important;
        }
        
        /* Ensure all chart containers have lower z-index */
        .chart-container {
            position: relative;
            z-index: 1;
        }
        
        /* Override any Chart.js tooltips that might have high z-index */
        .chartjs-tooltip {
            z-index: 100 !important;
        }
        
        /* Critical override for settings modal system */
        .settings-backdrop,
        .settings-dropdown {
            z-index: 99999 !important;
            will-change: transform, opacity;
            contain: layout style paint;
        }
        
        /* Force Chart.js elements to stay below modal */
        canvas {
            z-index: 1 !important;
        }
        
        .chart-container {
            z-index: 1 !important;
        }
        
        /* Chart.js tooltip override */
        .chartjs-tooltip {
            z-index: 100 !important;
        }

        /* ===== CHAT INTERFACE STYLES ===== */
        
        /* Chat FAB Integration */
        .fab-cluster {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
        }
        
        .fab-main {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            position: relative;
        }
        
        .fab-main:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
        }
        
        .fab-options {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fab-cluster.active .fab-options {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .fab-option {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .fab-option-button {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(226, 232, 240, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #374151;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            font-size: 18px;
            position: relative;
        }
        
        .fab-option-button:hover {
            transform: scale(1.1);
            background: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            color: #3b82f6;
        }
        
        .fab-option-label {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
            border: 1px solid rgba(226, 232, 240, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateX(10px);
            transition: all 0.2s ease;
        }
        
        .fab-option:hover .fab-option-label {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }
        
        /* Chat Notification Badge */
        .chat-notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        /* Chat Modal */
        .chat-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .chat-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .chat-container {
            width: 100%;
            max-width: 480px;
            max-height: 700px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(226, 232, 240, 0.3);
            border-radius: 24px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.9) translateY(40px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .chat-modal.active .chat-container {
            transform: scale(1) translateY(0);
        }
        
        /* Chat Header */
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px 16px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .chat-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .chat-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: 600;
        }
        
        .chat-title {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        .chat-subtitle {
            font-size: 12px;
            color: #6b7280;
            margin: 0;
        }
        
        .chat-close-btn {
            width: 32px;
            height: 32px;
            background: rgba(107, 114, 128, 0.1);
            border: 1px solid rgba(107, 114, 128, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }
        
        .chat-close-btn:hover {
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
        }
        
        /* Chat Body */
        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-height: 300px;
        }
        
        /* Message Styles */
        .message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            max-width: 85%;
            animation: messageSlideIn 0.3s ease-out;
        }
        
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .message.user .message-avatar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .message-content {
            background: white;
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: 16px;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            font-size: 14px;
            line-height: 1.5;
            color: #374151;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border-color: transparent;
        }
        
        .message-time {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 4px;
        }
        
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: white;
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .typing-indicator.active {
            opacity: 1;
            visibility: visible;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typingPulse 1.4s infinite both;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingPulse {
            0%, 60%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            30% {
                transform: scale(1.2);
                opacity: 1;
            }
        }
        
        /* Chat Footer */
        .chat-footer {
            padding: 16px 24px 20px;
            border-top: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .chat-input-container {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .chat-input {
            flex: 1;
            background: white;
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 14px;
            line-height: 1.4;
            color: #374151;
            resize: none;
            min-height: 20px;
            max-height: 100px;
            transition: all 0.2s ease;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .chat-send-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }
        
        .chat-send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Update Dashboard Button */
        .update-dashboard-btn {
            width: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .update-dashboard-btn.ready {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .update-dashboard-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .fab-cluster {
                bottom: 16px;
                right: 16px;
            }
            
            .chat-modal {
                padding: 12px;
            }
            
            .chat-container {
                max-width: none;
                width: 100%;
                max-height: calc(100vh - 24px);
                border-radius: 16px;
            }
            
            .chat-messages {
                padding: 16px 20px;
            }
            
            .chat-footer {
                padding: 12px 20px 16px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .fab-option-label {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .chat-header {
                padding: 16px 20px 12px;
            }
            
            .chat-title {
                font-size: 16px;
            }
            
            .message-content {
                padding: 10px 14px;
                font-size: 13px;
            }
        }

        /* ===== MISSING CSS FROM BACKUP - START ===== */
        
        /* CSS Variables */
        :root {
            --duration-workspace: 400ms;
            --ease-workspace: cubic-bezier(0.4, 0, 0.2, 1);
            --duration-standard: 300ms;
            --duration-quick: 150ms;
            --ease-brand: cubic-bezier(0.4, 0, 0.2, 1);
            --glass-overlay: rgba(255, 255, 255, 0.95);
            --glass-dark: rgba(0, 0, 0, 0.75);
            --blur-overlay: blur(16px);
            --blur-dark: blur(12px);
            --blur-secondary: blur(8px);
        }

        /* Contextual Workspace System */
        .contextual-workspace {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active {
            opacity: 1;
            visibility: visible;
        }
        
        .workspace-content {
            position: absolute;
            inset: 24px;
            background: var(--glass-overlay);
            backdrop-filter: var(--blur-overlay);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95) translateY(40px);
            transition: transform var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active .workspace-content {
            transform: scale(1) translateY(0);
        }
        
        /* Workspace Header */
        .workspace-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(8px);
        }
        
        .workspace-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-back-btn {
            width: 40px;
            height: 40px;
            background: rgba(107, 114, 128, 0.1);
            backdrop-filter: var(--blur-secondary);
            border: 1px solid rgba(107, 114, 128, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            cursor: pointer;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .workspace-back-btn:hover {
            transform: translateX(-2px);
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
        }
        
        .workspace-title {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        /* Removed unprofessional badge - using clean title approach */
        .workspace-title-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-subtitle {
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 500;
        }
        
        .workspace-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Professional New Project Button */
        .new-project-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .new-project-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-800) 100%);
        }
        
        .new-project-btn:active {
            transform: translateY(0);
        }
        
        .new-project-icon {
            width: 16px;
            height: 16px;
        }
        
        /* Workspace Body */
        .workspace-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }
        
        /* Button System */
        .btn-system {
            background: rgba(107, 114, 128, 0.15);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(107, 114, 128, 0.3);
            color: #374151;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn-system:hover {
            transform: translateY(-1px);
            background: rgba(107, 114, 128, 0.15);
            border-color: rgba(107, 114, 128, 0.3);
            box-shadow: 0 4px 16px rgba(107, 114, 128, 0.1);
        }

        /* Dashboard Blur Effect */
        .dashboard-blur {
            filter: blur(4px);
            transform: scale(0.98);
            transition: all var(--duration-standard) ease;
        }

        /* Mode Indicator */
        .mode-indicator {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: var(--glass-dark);
            backdrop-filter: var(--blur-dark);
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 110;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .mode-indicator.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        /* ===== MISSING CSS FROM BACKUP - END =====

        /* ===== DATABASE FUNCTIONALITY CSS - START ===== */
        
        /* Connection Status */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
            animation: pulse 2s infinite;
        }
        
        .status-indicator.offline {
            background: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
        }
        
        .status-indicator.loading {
            background: #f59e0b;
            box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
        }
        
        .status-text {
            color: #6b7280;
            font-weight: 500;
        }
        
        /* Settings Button Variants */
        
        .settings-reset-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }
        
        .settings-reset-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* Database Reset Modal */
        .reset-confirmation-modal {
            position: fixed;
            inset: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .reset-confirmation-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .reset-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .reset-modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 480px;
            margin: 20px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .reset-confirmation-modal.active .reset-modal-content {
            transform: scale(1) translateY(0);
        }
        
        .reset-modal-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .reset-modal-icon {
            width: 64px;
            height: 64px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px auto;
        }
        
        .reset-modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
            margin: 0 0 8px 0;
        }
        
        .reset-modal-description {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
            line-height: 1.5;
        }
        
        .reset-modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .reset-cancel-btn {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            background: #f3f4f6;
            color: #374151;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-cancel-btn:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        .reset-confirm-btn {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-confirm-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* Grid utility for settings buttons */
        .grid {
            display: grid;
        }
        
        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        
        .gap-2 {
            gap: 0.5rem;
        }
        
        /* Pulse animation */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }
        
        /* Prevent pointer events on status indicators to avoid blocking interactions */
        #connectionStatus {
            pointer-events: none !important;
            user-select: none;
        }
        
        /* ===== DATABASE FUNCTIONALITY CSS - END =====
        
        /* Main Content */
        .main-content {
            padding: var(--spacing-xl);
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Row 1: Key Metrics */
        .key-metrics-row {
            background: white;
            padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-lg);
        }

        .metrics-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            max-width: 1600px;
            margin: 0 auto;
        }

        .metric-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--gray-50);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--gray-200);
            transition: all 0.2s ease;
        }

        .metric-card:hover {
            background: white;
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .metric-icon.project {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
        }

        .metric-icon.processes {
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-600) 100%);
            color: white;
        }

        .metric-icon.departments {
            background: linear-gradient(135deg, var(--amber-500) 0%, var(--amber-600) 100%);
            color: white;
        }

        .metric-icon.updated {
            background: linear-gradient(135deg, var(--gray-500) 0%, var(--gray-600) 100%);
            color: white;
        }

        .metric-content {
            flex: 1;
        }

        .metric-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1.2;
            margin-bottom: var(--spacing-xs);
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        /* Row 2: Business KPIs */
        .business-kpis-row {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: var(--spacing-xl);
            border-top: 1px solid var(--gray-200);
        }

        .kpis-container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: var(--spacing-xl);
        }

        .kpi-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-600);
        }

        .kpi-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
        }

        .kpi-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .kpi-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .kpi-icon.readiness {
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-600) 100%);
            color: white;
        }

        .kpi-icon.savings {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
        }

        .kpi-icon.quick-wins {
            background: linear-gradient(135deg, var(--amber-500) 0%, var(--amber-600) 100%);
            color: white;
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--gray-900);
            line-height: 1;
            margin-bottom: var(--spacing-sm);
        }

        .kpi-description {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: var(--spacing-lg);
        }

        .kpi-progress {
            background: var(--gray-200);
            border-radius: var(--border-radius-lg);
            height: 8px;
            overflow: hidden;
            margin-bottom: var(--spacing-sm);
        }

        .kpi-progress-bar {
            height: 100%;
            border-radius: var(--border-radius-lg);
            transition: width 0.6s ease;
        }

        .kpi-progress-bar.readiness {
            background: linear-gradient(90deg, var(--green-500) 0%, var(--green-600) 100%);
        }

        .kpi-progress-bar.savings {
            background: linear-gradient(90deg, var(--primary-600) 0%, var(--primary-700) 100%);
        }

        .kpi-progress-bar.quick-wins {
            background: linear-gradient(90deg, var(--amber-500) 0%, var(--amber-600) 100%);
        }

        .progress-ring {
            width: 80px;
            height: 80px;
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
        }

        .progress-ring .bg {
            stroke: var(--gray-200);
        }

        .progress-ring .progress {
            stroke: var(--primary-500);
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            stroke-dasharray: 188.4; /* 2 * PI * 30 */
            stroke-dashoffset: 188.4;
            transition: stroke-dashoffset 2s ease;
        }

        .kpi-subtitle {
            font-size: 0.75rem;
            color: var(--gray-500);
            font-weight: 500;
        }
        
        .page-header {
            margin-bottom: 32px;
            text-align: center;
        }
        
        .page-header h2 {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 8px 0;
        }
        
        .page-header p {
            color: #64748b;
            font-size: 1rem;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-top: 32px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-600);
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
            max-height: 100%;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            font-weight: 600;
            color: var(--gray-900);
            font-size: 1.125rem;
        }

        /* Department Rankings Enhancement */
        .department-rankings {
            background: white;
            padding: var(--spacing-xl);
            border-top: 1px solid var(--gray-200);
        }

        .rankings-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .rankings-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .rankings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
        }

        .department-card {
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .department-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-600);
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .department-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .department-rank {
            background: var(--primary-50);
            color: var(--primary-700);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-md);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .department-score {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .score-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-900);
            line-height: 1;
        }

        .score-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: var(--spacing-xs);
        }

        .score-bar {
            background: var(--gray-200);
            border-radius: var(--border-radius-lg);
            height: 8px;
            overflow: hidden;
            margin-bottom: var(--spacing-lg);
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-600) 0%, var(--primary-700) 100%);
            border-radius: var(--border-radius-lg);
            transition: width 0.8s ease;
        }

        .department-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-sm);
            font-size: 0.875rem;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-xs) 0;
        }

        .metric-label {
            color: var(--gray-600);
        }

        .metric-value {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        /* Debug Panel System */
        .debug-panel {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 80;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .debug-toggle {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(226, 232, 240, 0.3);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            user-select: none;
        }
        
        .debug-toggle:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(79, 70, 229, 0.2);
            color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        
        .debug-toggle.expanded {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-color: rgba(79, 70, 229, 0.3);
        }
        
        .debug-toggle.expanded:hover {
            background: linear-gradient(135deg, #3730a3 0%, #5b21b6 100%);
            color: white;
        }
        
        .debug-indicator {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            right: 8px;
            animation: pulse 2s infinite;
        }
        
        .debug-content {
            position: absolute;
            bottom: 64px;
            left: 0;
            display: none; /* Hide debug content in production */
            width: 400px;
            max-height: 300px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.3);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .debug-content.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .debug-header {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .debug-header h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .debug-header .debug-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .debug-body {
            padding: 16px 20px;
            max-height: 220px;
            overflow-y: auto;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.6;
            color: #334155;
            background: rgba(248, 250, 252, 0.3);
        }
        
        .debug-body::-webkit-scrollbar {
            width: 4px;
        }
        
        .debug-body::-webkit-scrollbar-track {
            background: rgba(226, 232, 240, 0.3);
            border-radius: 2px;
        }
        
        .debug-body::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
            border-radius: 2px;
        }
        
        .debug-body::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }
        
        .debug-message {
            margin-bottom: 8px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(226, 232, 240, 0.2);
        }
        
        .debug-message:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .debug-timestamp {
            color: #64748b;
            font-size: 10px;
            margin-bottom: 4px;
        }
        
        .debug-text {
            color: #475569;
        }
        
        /* Animation keyframes */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .debug-panel {
                bottom: 16px;
                left: 16px;
            }
            
            .debug-content {
                width: calc(100vw - 80px);
                max-width: 340px;
            }
        }
        
        /* Hide original debug info */
        .debug-info {
            display: none;
        }
        
        /* FAB Styles */
        .fab-cluster {
            position: fixed;
            bottom: 48px;
            right: 48px;
            z-index: 90;
        }
        
        .fab-primary {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(79, 70, 229, 0.3);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
        }
        
        .fab-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(79, 70, 229, 0.4);
        }
        
        .fab-secondary-group {
            position: absolute;
            bottom: 80px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .fab-cluster.expanded .fab-secondary-group {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .fab-secondary {
            width: 48px;
            height: 48px;
            background: rgba(79, 70, 229, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4F46E5;
            cursor: pointer;
            transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
            position: relative;
        }
        
        .fab-secondary:hover {
            transform: translateX(-4px);
            background: rgba(79, 70, 229, 0.15);
            border-color: rgba(79, 70, 229, 0.3);
        }
        
        .fab-tooltip {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 200ms;
            pointer-events: none;
        }
        
        .fab-secondary:hover .fab-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(-4px);
        }
        
        .recreate-button {
            margin-top: 32px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .recreate-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        /* Header Settings Panel Styles */
        .header-settings-panel {
            position: fixed;
            top: 80px;
            right: 24px;
            width: 320px;
            max-height: 500px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            overflow-y: auto;
        }
        
        .header-settings-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .settings-header {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: #fafbfc;
            border-radius: 12px 12px 0 0;
            flex-shrink: 0;
        }
        
        .settings-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }
        
        .settings-subtitle {
            font-size: 12px;
            color: #64748b;
            margin: 2px 0 0 0;
        }
        
        .settings-body {
            padding: 0;
            flex: 1;
            overflow-y: auto;
        }
        
        .settings-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .settings-section:last-child {
            border-bottom: none;
        }
        
        .settings-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 0 0 12px 0;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }
        
        .settings-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
        }
        
        .settings-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .settings-btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .settings-btn-warning:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3);
        }
        
        .settings-btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .settings-btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        
        .settings-logout-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .settings-logout-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        .settings-reset-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .settings-reset-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        /* Project Management System Styles */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-healthy {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
        }

        .status-text {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
        }

        .participant-counter {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 8px;
        }

        .participant-icon {
            font-size: 14px;
        }

        .participant-count {
            font-size: 12px;
            font-weight: 700;
            color: #374151;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 6px;
        }

        .quick-action-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .quick-action-btn:hover {
            background: #f1f5f9;
        }

        /* Consolidated Settings Panel */
        .settings-panel {
            position: relative;
            display: inline-block;
        }

        .settings-trigger {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 500;
            color: #475569;
        }

        .settings-trigger:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            color: #334155;
        }

        .settings-trigger.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Settings Modal Backdrop */
        .settings-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .settings-backdrop.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        
        .settings-dropdown {
            position: fixed;
            top: 80px;
            right: 24px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);
            min-width: 360px;
            max-width: 400px;
            max-height: calc(100vh - 120px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-16px) scale(0.95);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            /* Ensure it's above Chart.js elements */
            isolation: isolate;
        }

        .settings-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .settings-header {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: #fafbfc;
            border-radius: 12px 12px 0 0;
            flex-shrink: 0;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .settings-subtitle {
            font-size: 12px;
            color: #64748b;
            margin: 2px 0 0 0;
        }

        .settings-body {
            padding: 0;
            flex: 1;
            overflow-y: auto;
            max-height: calc(100vh - 240px);
        }
        
        /* Custom scrollbar for settings body */
        .settings-body::-webkit-scrollbar {
            width: 6px;
        }
        
        .settings-body::-webkit-scrollbar-track {
            background: rgba(226, 232, 240, 0.3);
            border-radius: 3px;
        }
        
        .settings-body::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
            border-radius: 3px;
        }
        
        .settings-body::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }

        .settings-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }

        .settings-item-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-item-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Settings item content styling */
        .settings-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-toggle {
            position: relative;
            display: inline-block;
            width: 42px;
            height: 22px;
        }

        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 11px;
        }

        .settings-toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .settings-toggle input:checked + .settings-toggle-slider {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .settings-toggle input:checked + .settings-toggle-slider:before {
            transform: translateX(20px);
        }

        .settings-select {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            min-width: 140px;
        }
        
        .settings-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Settings buttons */
        .settings-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: #374151;
        }
        
        .settings-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .settings-btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(29, 78, 216, 0.4);
        }
        
        .settings-btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-warning:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }
        
        .settings-btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100());
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .settings-btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .settings-btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .settings-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .settings-status-online {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .settings-status-offline {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .settings-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-close-btn:hover {
            background: #f1f5f9;
            color: #475569;
        }

        /* Animation for settings gear icon */
        .settings-icon {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-trigger.active .settings-icon {
            transform: rotate(120deg);
        }

        /* New Settings Modal Styles */
        .system-health-bar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.1);
        }
        
        .health-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            background: #34d399;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-text {
            font-weight: 600;
            font-size: 14px;
        }
        
        .status-detail, .workspace-name, .process-count {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .workspace-info {
            text-align: right;
        }
        
        .process-tools-section {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 24px;
            padding: 4px;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .tool-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border: 1px solid transparent;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
            width: 100%;
            text-align: left;
        }
        
        .tool-btn:hover {
            transform: translateX(4px);
            background: #f8fafc;
        }
        
        .tool-btn-primary {
            color: #1e40af;
        }
        
        .tool-btn-primary:hover {
            background: #eff6ff;
            border-color: #3b82f6;
        }
        
        .tool-btn-warning {
            color: #92400e;
        }
        
        .tool-btn-warning:hover {
            background: #fef3c7;
            border-color: #f59e0b;
        }
        
        .tool-btn-success {
            color: #14532d;
        }
        
        .tool-btn-success:hover {
            background: #ecfdf5;
            border-color: #10b981;
        }
        
        .tool-btn-secondary {
            color: #374151;
        }
        
        .tool-btn-secondary:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .storage-preferences {
            margin-top: 24px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .preference-label {
            font-size: 12px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 12px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .storage-toggle {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .storage-option {
            flex: 1;
            position: relative;
        }
        
        .storage-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        .storage-option-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
        }
        
        .storage-option input[type="radio"]:checked + .storage-option-label {
            border-color: #3b82f6;
            background: #eff6ff;
            color: #1e40af;
        }
        
        .storage-option-label:hover {
            border-color: #9ca3af;
        }
        
        .storage-info {
            font-size: 11px;
            color: #6b7280;
            margin-top: 8px;
            line-height: 1.5;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
        }
        
        .advanced-actions {
            margin-top: 24px;
            border-top: 1px solid #e5e7eb;
            padding-top: 20px;
        }
        
        .advanced-summary {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: #fef3f2;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #7c2d12;
            list-style: none;
            transition: all 0.2s;
        }
        
        .advanced-summary:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }
        
        .advanced-summary::marker {
            content: '';
        }
        
        .advanced-content {
            margin-top: 12px;
            padding: 16px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
        }
        
        .warning-notice {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #92400e;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .danger-zone {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .danger-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 1px solid #ef4444;
            border-radius: 6px;
            color: #ef4444;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .danger-btn:hover {
            background: #ef4444;
            color: white;
        }
        
        .danger-warning {
            font-size: 11px;
            color: #dc2626;
            margin-top: 4px;
            line-height: 1.4;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Contextual Workspace System */
        :root {
            --glass-primary: rgba(255, 255, 255, 0.85);
            --glass-secondary: rgba(255, 255, 255, 0.75);
            --glass-overlay: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(15, 23, 42, 0.85);
            --blur-primary: blur(12px);
            --blur-secondary: blur(10px);
            --blur-overlay: blur(16px);
            --blur-dark: blur(12px);
            --ease-brand: cubic-bezier(0.4, 0.0, 0.2, 1);
            --ease-workspace: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --duration-quick: 200ms;
            --duration-standard: 300ms;
            --duration-workspace: 400ms;
        }

        /* Contextual Workspace Overlay */
        .contextual-workspace {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active {
            opacity: 1;
            visibility: visible;
        }
        
        .workspace-content {
            position: absolute;
            inset: 24px;
            background: var(--glass-overlay);
            backdrop-filter: var(--blur-overlay);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95) translateY(40px);
            transition: transform var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active .workspace-content {
            transform: scale(1) translateY(0);
        }

        /* Workspace Header */
        .workspace-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(8px);
        }
        
        .workspace-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-back-btn {
            width: 40px;
            height: 40px;
            background: rgba(107, 114, 128, 0.1);
            backdrop-filter: var(--blur-secondary);
            border: 1px solid rgba(107, 114, 128, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            cursor: pointer;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .workspace-back-btn:hover {
            transform: translateX(-2px);
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
        }
        
        .workspace-title {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        /* Removed unprofessional badge - using clean title approach */
        .workspace-title-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-subtitle {
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 500;
        }
        
        .workspace-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Professional New Project Button */
        .new-project-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .new-project-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-800) 100%);
        }
        
        .new-project-btn:active {
            transform: translateY(0);
        }
        
        .new-project-icon {
            width: 16px;
            height: 16px;
        }

        /* Professional Header Styles */
        .workspace-header-professional {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .workspace-title-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .workspace-description {
            color: #6b7280;
            font-size: 14px;
            font-weight: 400;
            margin: 0;
            line-height: 1.4;
        }

        .btn-system-close {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: rgba(107, 114, 128, 0.1);
            border: none;
            border-radius: 8px;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-system-close:hover {
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
            transform: scale(1.05);
        }

        .workspace-back-btn {
            background: rgba(107, 114, 128, 0.1);
            border: none;
            border-radius: 8px;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .workspace-back-btn:hover {
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
            transform: scale(1.05);
        }

        /* Workspace Body */
        .workspace-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        /* Admin Control Card */
        .admin-control-card {
            background: #ffffff;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .admin-control-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-200);
        }
        
        /* Project Cards */
        .project-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .project-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-200);
        }
        
        .project-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-lg);
        }
        
        .project-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--spacing-xs);
        }
        
        .project-card-meta {
            color: var(--gray-600);
            font-size: 0.875rem;
        }
        
        .project-status {
            padding: 4px 12px;
            border-radius: var(--border-radius-md);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .project-status.active {
            background: var(--green-100);
            color: var(--green-700);
        }

        /* Primary Button - Brand gradient with WCAG AA compliance */
        .btn-primary {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: #ffffff;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #3730a3 0%, #5b21b6 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
        }

        .btn-system {
            background: #f8fafc;
            color: #475569;
            border: 1px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-system:hover {
            background: #e2e8f0;
            border-color: #94a3b8;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }
            
            .metrics-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .kpis-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }
            
            .matrix-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .rankings-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .fab-cluster {
                bottom: var(--spacing-xl);
                right: var(--spacing-xl);
            }
            
            .fab-primary {
                width: 56px;
                height: 56px;
                font-size: 20px;
            }
            
            .main-content {
                padding: var(--spacing-lg);
            }
            
            .key-metrics-row,
            .business-kpis-row,
            .priority-matrix-row,
            .department-rankings {
                padding: var(--spacing-lg);
            }
        }

        /* Step Indicator Styles */
        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .step-indicator .w-8 {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 15px;
        }
        
        .step-indicator.active .w-8 {
            background-color: #2563eb !important;
            color: white !important;
        }
        
        .step-indicator.active span {
            color: #2563eb !important;
            font-weight: bold !important;
        }
        
        /* Form Option Styles */
        .frequency-option input:checked + div,
        .info-source input:checked + div,
        .consistency-option input:checked + div,
        .volume-option input:checked + div,
        .impact-option input:checked + div,
        .feasibility-option input:checked + div,
        .cost-option input:checked + div {
            border-color: #2563eb !important;
            background-color: #eff6ff !important;
            box-shadow: inset 4px 0 0 #2563eb, 0 2px 4px rgba(37, 99, 235, 0.1);
            transform: none !important;
        }
        
        /* Validation Error Styles */
        .validation-error {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .validation-error svg {
            width: 1rem;
            height: 1rem;
            margin-right: 0.25rem;
        }
        
        /* Field Error Styles */
        .field-error {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 1px #dc2626 !important;
        }
        
        .field-required::after {
            content: " *";
            color: #dc2626;
        }
        
        /* Currency Toggle Styling */
        .currency-toggle .currency-option {
            transition: all 0.2s ease;
        }
        
        .currency-toggle input:checked + .currency-option {
            background-color: #dbeafe !important;
            color: #1d4ed8 !important;
            font-weight: 600;
        }
        
        .currency-toggle input:not(:checked) + .currency-option {
            background-color: transparent;
            color: #6b7280;
        }
        
        /* Template Button Styles */
        .template-btn:hover {
            border-color: #2563eb !important;
            background-color: #f8fafc !important;
        }
        
        /* Time Slider Styles */
        .time-slider {
            background: linear-gradient(to right, #2563eb 0%, #2563eb var(--slider-progress, 50%), #e5e7eb var(--slider-progress, 50%), #e5e7eb 100%);
            border-radius: 8px;
            height: 8px;
        }
        
        .time-slider::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .time-slider::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        /* Step Content Animation */
        .step-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive Adjustments for Step Indicators */
        @media (max-width: 768px) {
            .step-indicator {
                margin: 0 5px;
            }
            
            .step-indicator .w-8 {
                margin-right: 0;
                margin-bottom: 5px;
            }
            
            .step-indicator span {
                font-size: 0.75rem;
            }
        }

        /* Storage Mode Toggle Styles */
        .storage-toggle {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .storage-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .storage-option:hover {
            border-color: #cbd5e1;
            background-color: #f8fafc;
        }

        .storage-option input[type="radio"] {
            margin-right: 8px;
        }

        .storage-option input[type="radio"]:checked + .storage-option-label {
            color: #2563eb;
            font-weight: 600;
        }

        .storage-option:has(input:checked) {
            border-color: #2563eb;
            background-color: #eff6ff;
        }

        .storage-option-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.875rem;
        }

        .storage-mode-info {
            margin-top: 12px;
            padding: 8px;
            background-color: #f8fafc;
            border-radius: 6px;
            border-left: 3px solid #2563eb;
        }

        /* Process Management Enhancements */
        .process-item-deleted {
            opacity: 0;
            transform: translateX(-100%);
            transition: opacity 0.3s, transform 0.3s;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(8px);
            color: white;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(-100px);
            opacity: 0;
            pointer-events: none;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.9));
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
        }

        .notification.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.9), rgba(217, 119, 6, 0.9));
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(37, 99, 235, 0.9));
        }

        /* Refresh Button Animation */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* Enhanced hover states for process items */
        .process-item:hover {
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
        }
        
        /* Supporting Analysis Section */
        .supporting-analysis {
            background: var(--gray-50);
            padding: var(--spacing-2xl) var(--spacing-xl);
            min-height: 600px;
        }

        .analysis-container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: var(--spacing-2xl);
        }

        .analysis-card {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .analysis-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .analysis-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--gray-100);
        }

        .analysis-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .analysis-icon.departments {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
        }

        .analysis-icon.use-cases {
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-500) 100%);
        }

        .analysis-icon.roi {
            background: linear-gradient(135deg, var(--amber-600) 0%, var(--amber-500) 100%);
        }

        .analysis-title {
            color: var(--gray-900);
            margin-bottom: var(--spacing-xs);
        }

        .analysis-subtitle {
            color: var(--gray-500);
        }

        /* Department Rankings */
        .department-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .department-item {
            padding: var(--spacing-lg);
            background: var(--gray-50);
            border-radius: var(--border-radius-lg);
            border-left: 4px solid var(--primary-500);
            transition: all 0.2s ease;
        }

        .department-item:hover {
            background: var(--primary-50);
            transform: translateX(4px);
        }

        .department-info {
            margin-bottom: var(--spacing-md);
        }

        .department-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--spacing-xs);
        }

        .department-stats {
            color: var(--gray-600);
        }

        .department-score-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-600) 0%, var(--primary-500) 100%);
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        /* Use Case Priorities */
        .use-case-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .use-case-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            background: var(--gray-50);
            border-radius: var(--border-radius-lg);
            border-left: 4px solid var(--green-500);
            transition: all 0.2s ease;
        }

        .use-case-item:hover {
            background: var(--green-50);
            transform: translateX(4px);
        }

        .use-case-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--spacing-xs);
        }

        .use-case-details {
            color: var(--gray-600);
        }

        .use-case-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-md);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .use-case-badge.high {
            background: var(--green-100);
            color: var(--green-700);
        }

        .use-case-badge.medium {
            background: var(--amber-100);
            color: var(--amber-700);
        }

        /* ROI Breakdown */
        .roi-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .roi-stat-item {
            text-align: center;
            padding: var(--spacing-lg);
            background: var(--gray-50);
            border-radius: var(--border-radius-lg);
        }

        .roi-stat-label {
            color: var(--gray-600);
            margin-bottom: var(--spacing-xs);
        }

        .roi-stat-value {
            color: var(--gray-900);
            font-weight: 700;
        }

        .roi-chart-container {
            height: 180px;
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .roi-confidence {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-weight: 600;
        }

        /* Implementation Roadmap */
        .roadmap-section {
            background: white;
            padding: var(--spacing-2xl) var(--spacing-xl);
        }

        .roadmap-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .roadmap-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .roadmap-title {
            color: var(--gray-900);
            margin-bottom: var(--spacing-sm);
        }

        .roadmap-subtitle {
            color: var(--gray-500);
        }

        .roadmap-timeline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-xl);
            margin-top: var(--spacing-2xl);
        }

        .roadmap-phase {
            position: relative;
            background: white;
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .roadmap-phase:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .phase-marker {
            position: absolute;
            top: -12px;
            left: var(--spacing-xl);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: var(--shadow-md);
        }

        .phase-marker.phase-1 {
            background: var(--green-500);
        }

        .phase-marker.phase-2 {
            background: var(--amber-500);
        }

        .phase-marker.phase-3 {
            background: var(--primary-500);
        }

        .phase-marker.phase-4 {
            background: var(--red-500);
        }

        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--gray-100);
        }

        .phase-title {
            color: var(--gray-900);
        }

        .phase-duration {
            color: var(--gray-500);
            font-weight: 600;
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--gray-100);
            border-radius: var(--border-radius-md);
        }

        .phase-items {
            margin-bottom: var(--spacing-lg);
        }

        .phase-item {
            padding: var(--spacing-sm) 0;
            color: var(--gray-700);
            border-left: 3px solid var(--gray-300);
            padding-left: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        .phase-impact {
            color: var(--green-600);
            font-weight: 600;
            text-align: center;
            padding: var(--spacing-md);
            background: var(--green-50);
            border-radius: var(--border-radius-md);
        }

        /* Inline Editing System */
        .editable {
            position: relative;
            transition: all 0.2s ease;
        }
        
        .editable:hover {
            background: rgba(59, 130, 246, 0.02);
            cursor: pointer;
        }
        
        .editable.editing {
            background: rgba(59, 130, 246, 0.05);
            border: 2px solid var(--primary-500);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-xs);
        }
        
        .edit-controls {
            position: absolute;
            top: -32px;
            right: 0;
            display: none;
            align-items: center;
            gap: var(--spacing-xs);
            z-index: 10;
            background: white;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
        }
        
        .editable.editing .edit-controls,
        .editable:hover .edit-controls {
            display: flex;
        }
        
        .edit-icon {
            width: 16px;
            height: 16px;
            color: var(--gray-400);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .edit-icon:hover {
            color: var(--primary-500);
            transform: scale(1.1);
        }
        
        .save-btn, .cancel-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .save-btn {
            background: var(--green-500);
            color: white;
        }
        
        .save-btn:hover {
            background: var(--green-600);
            transform: scale(1.05);
        }
        
        .cancel-btn {
            background: var(--red-500);
            color: white;
        }
        
        .cancel-btn:hover {
            background: var(--red-600);
            transform: scale(1.05);
        }
        
        .inline-input {
            background: white;
            border: 1px solid var(--primary-500);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            width: 100%;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .inline-textarea {
            background: white;
            border: 1px solid var(--primary-500);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-sm);
            font-family: inherit;
            font-size: inherit;
            color: inherit;
            width: 100%;
            min-height: 60px;
            resize: vertical;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .edit-feedback {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            z-index: 20;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .edit-feedback.show {
            opacity: 1;
            transform: translateY(4px);
        }
        
        .edit-feedback.error {
            background: rgba(239, 68, 68, 0.9);
        }
        
        /* Phase item editing */
        .phase-items {
            position: relative;
        }
        
        .phase-item.editable {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border-left: 3px solid var(--gray-300);
            border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
        }
        
        .phase-item-content {
            flex: 1;
        }
        
        .phase-item-actions {
            display: none;
            align-items: center;
            gap: var(--spacing-xs);
        }
        
        .phase-item:hover .phase-item-actions {
            display: flex;
        }
        
        .add-item-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm);
            background: var(--gray-50);
            border: 2px dashed var(--gray-300);
            border-radius: var(--border-radius-md);
            color: var(--gray-500);
            font-size: var(--text-small);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: var(--spacing-sm);
        }
        
        .add-item-btn:hover {
            background: var(--primary-50);
            border-color: var(--primary-300);
            color: var(--primary-600);
        }
        
        .loading-state {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }
        
        .loading-state::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            border: 2px solid var(--primary-200);
            border-top: 2px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* Undo system */
        .undo-notification {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--gray-800);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .undo-notification.show {
            transform: translateX(0);
        }
        
        .undo-btn {
            background: var(--primary-500);
            color: white;
            border: none;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: background 0.2s ease;
        }
        
        .undo-btn:hover {
            background: var(--primary-600);
        }

        /* Action Center */
        .action-center {
            background: var(--gray-50);
            padding: var(--spacing-2xl) var(--spacing-xl);
        }

        .action-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .action-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .action-title {
            color: var(--gray-900);
            margin-bottom: var(--spacing-sm);
        }

        .action-subtitle {
            color: var(--gray-500);
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--spacing-xl);
        }

        .action-card {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gray-200);
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-lg);
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .action-card.priority-high {
            border-left: 6px solid var(--green-500);
        }

        .action-card.priority-medium {
            border-left: 6px solid var(--amber-500);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-500) 100%);
            flex-shrink: 0;
        }

        .action-card.priority-medium .action-icon {
            background: linear-gradient(135deg, var(--amber-600) 0%, var(--amber-500) 100%);
        }

        .action-item-title {
            color: var(--gray-900);
            margin-bottom: var(--spacing-md);
        }

        .action-description {
            color: var(--gray-700);
            margin-bottom: var(--spacing-md);
        }

        .action-meta {
            color: var(--gray-500);
            font-weight: 500;
        }

        /* Animation Delays */
        .animate-delay-200 {
            animation-delay: 0.2s;
        }
        
        .animate-delay-300 {
            animation-delay: 0.3s;
        }
        
        .animate-delay-400 {
            animation-delay: 0.4s;
        }
        
        .animate-delay-500 {
            animation-delay: 0.5s;
        }
        
        .animate-delay-600 {
            animation-delay: 0.6s;
        }
        
        /* ===== IMPROVED PROJECT OVERVIEW STYLES ===== */
        
        /* Enhanced metric cards with left border accent */
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .metric-card:hover::before {
            opacity: 1;
        }
        
        /* Improved Visual Hierarchy */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--gray-100);
        }
        
        .section-title {
            color: var(--gray-900);
            font-weight: 700;
            font-size: 1.5rem;
            margin: 0;
        }
        
        .section-subtitle {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-top: 4px;
        }
        
        /* Clean Grid Layout */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--spacing-xl);
            margin-top: var(--spacing-xl);
        }
        
        /* Professional workspace header with better spacing */
        .workspace-header-improved {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
            padding: 20px 32px;
            position: sticky;
            top: 0;
            z-index: 20;
        }
        
        .workspace-title-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .workspace-main-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
            line-height: 1.2;
        }
        
        .workspace-description {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin: 0;
        }
        
        .workspace-stats {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-left: auto;
            margin-right: 24px;
        }
        
        .workspace-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .workspace-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
        }
        
        .workspace-stat-label {
            font-size: 0.75rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>AI Opportunity Navigator</h1>
                    <p>Business Process Automation Intelligence</p>
                </div>
                <div class="header-controls">
                    <div class="project-selector">
                        <span>Active Project:</span>
                        <select id="headerProjectSelector" onchange="switchProject(this.value)">
                            <option value="">Select Project...</option>
                        </select>
                    </div>
                    <button class="settings-trigger" 
                            onclick="toggleHeaderSettings()" 
                            id="headerSettingsTrigger"
                            aria-label="Open system settings"
                            aria-expanded="false"
                            aria-haspopup="menu"
                            role="button"
                            tabindex="0"
                            data-tooltip="System Settings"
                            onkeydown="handleSettingsKeyDown(event)">
                        <!-- Hidden text for screen readers -->
                        <span class="sr-only" id="settings-help-text">Press Enter or Space to open system settings panel</span>
                        <!-- Modern sliders icon for better recognition -->
                        <svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                        </svg>
                        <span class="settings-tooltip">System Settings</span>
                    </button>
                    
                    <!-- Settings Backdrop -->
                    <div class="settings-backdrop" id="settingsBackdrop" onclick="closeHeaderSettings()"></div>
                    
                    <!-- Header Settings Panel -->
                    <div class="settings-dropdown" id="headerSettingsPanel">
                        <div class="settings-header">
                            <h3 class="settings-title">Process Control Center</h3>
                            <p class="settings-subtitle">Manage your automation workspace</p>
                            <button class="settings-close-btn" 
                                    onclick="closeHeaderSettings()" 
                                    aria-label="Close settings panel"
                                    style="position: absolute; top: 12px; right: 12px; background: none; border: none; cursor: pointer; padding: 4px; border-radius: 4px; transition: background-color 0.2s;">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="settings-body">
                            <!-- System Health Bar (Always Visible) -->
                            <div class="system-health-bar" id="systemHealthBar">
                                <div class="health-status">
                                    <div class="status-indicator" id="healthIndicator"></div>
                                    <span class="status-text" id="healthStatus">Supabase Connected</span>
                                    <span class="status-detail" id="healthDetail">Last sync: 2 mins ago</span>
                                </div>
                                <div class="workspace-info">
                                    <span class="workspace-name" id="workspaceName">Current Workspace</span>
                                    <span class="process-count" id="processCount">Active Processes: 0</span>
                                </div>
                            </div>

                            <!-- Process Tools (Primary Section) -->
                            <div class="settings-section process-tools-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                    </svg>
                                    Process Tools
                                </h4>
                                <div class="settings-item">
                                    <div class="tools-grid">
                                        <button onclick="showDuplicateDetection()" class="tool-btn tool-btn-primary" id="findDuplicatesBtn">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                            </svg>
                                            <span>Find Duplicates</span>
                                        </button>
                                        <button onclick="showBulkActions()" class="tool-btn tool-btn-warning" id="bulkActionsBtn">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                            </svg>
                                            <span>Bulk Actions</span>
                                        </button>
                                        <button onclick="showDepartmentLinks()" class="tool-btn tool-btn-success" id="generateLinksBtn">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                            </svg>
                                            <span>Generate Links</span>
                                        </button>
                                        <button onclick="exportWorkflows()" class="tool-btn tool-btn-secondary" id="exportBtn">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                            </svg>
                                            <span>Export Data</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Storage Preferences -->
                                    <div class="storage-preferences">
                                        <span class="preference-label">Storage Preference:</span>
                                        <div class="storage-toggle">
                                            <label class="storage-option">
                                                <input type="radio" name="storageMode" value="supabase" id="storageSupabase" onchange="updateStorageMode('supabase')" checked>
                                                <span class="storage-option-label">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                                                    </svg>
                                                    Supabase Cloud
                                                </span>
                                            </label>
                                            <label class="storage-option">
                                                <input type="radio" name="storageMode" value="localStorage" id="storageLocal" onchange="updateStorageMode('localStorage')">
                                                <span class="storage-option-label">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                                                    </svg>
                                                    Local Storage
                                                </span>
                                            </label>
                                        </div>
                                        <p class="storage-info" id="storageModeDescription">
                                             All new projects use Supabase cloud database. Existing projects keep current storage.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Actions (Collapsible) -->
                            <details class="advanced-actions" id="advancedActions">
                                <summary class="advanced-summary">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Advanced Actions
                                </summary>
                                <div class="advanced-content">
                                    <div class="warning-notice">
                                        <svg class="w-4 h-4 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.08 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                        </svg>
                                        These actions affect your business data
                                    </div>
                                    
                                    <div class="danger-zone">
                                        <div class="account-actions">
                                            <button onclick="logout()" class="danger-btn logout-btn" id="logoutBtn">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                                </svg>
                                                Sign Out
                                            </button>
                                        </div>
                                        
                                        <div class="destructive-actions">
                                            <button onclick="showResetConfirmation()" class="danger-btn reset-btn" id="resetBtn">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                                </svg>
                                                Reset Database
                                            </button>
                                            <p class="danger-warning">This will delete ALL processes and cannot be undone</p>
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Row 1: Key Metrics -->
            <section class="key-metrics-row animate-fade-in">
                <div class="metrics-container">
                    <div class="metric-card">
                        <div class="metric-icon project">
                            <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm2.5 7a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm2.45 4a2.5 2.5 0 10-4.9 0h4.9zM12 9a1 1 0 100 2h3a1 1 0 100-2h-3zm-1 4a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label text-small">Project Name</div>
                            <div class="metric-value text-h2" id="currentProjectName">testSept9b</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon processes">
                            <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label text-small">Total Processes</div>
                            <div class="metric-value text-h2" id="totalProcesses">5</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon departments">
                            <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                                <path d="M6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label text-small">Departments</div>
                            <div class="metric-value text-h2" id="activeDepartments">3</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon updated">
                            <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label text-small">Last Updated</div>
                            <div class="metric-value text-h2" id="lastUpdated">Today</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Row 2: Business KPIs -->
            <section class="business-kpis-row animate-fade-in animate-delay-200">
                <div class="kpis-container">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-title text-small">Automation Readiness Score</div>
                                <div class="kpi-value" id="readinessScore">87<span style="font-size: 1.5rem; color: var(--gray-500);">/100</span></div>
                                <div class="kpi-description text-small">Excellent readiness across all processes</div>
                            </div>
                            <div>
                                <svg class="progress-ring" width="80" height="80" id="readinessRing">
                                    <circle class="bg" cx="40" cy="40" r="30"></circle>
                                    <circle class="progress" cx="40" cy="40" r="30"></circle>
                                </svg>
                            </div>
                        </div>
                        <div class="kpi-trend text-small" style="color: var(--green-600); display: flex; align-items: center; gap: 4px; margin-top: var(--spacing-md);">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            +12% from last quarter
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-title text-small">Projected Annual Savings</div>
                                <div class="kpi-value" id="projectedSavings">$2.4M</div>
                                <div class="kpi-description text-small">Based on current automation portfolio</div>
                            </div>
                            <div class="kpi-trend text-small" style="color: var(--green-600); display: flex; align-items: center; gap: 4px;">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                85% confidence level
                            </div>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3 class="kpi-title">Quick Wins</h3>
                            <div class="kpi-icon quick-wins">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="kpi-value" id="quickWins">12</div>
                        <p class="kpi-description">High-impact, low-effort automation opportunities identified</p>
                        <div class="kpi-progress">
                            <div class="kpi-progress-bar quick-wins" style="width: 80%"></div>
                        </div>
                        <div class="kpi-subtitle">Ready to implement</div>
                    </div>
                </div>
            </section>


            <!-- Supporting Analysis Section -->
            <section class="supporting-analysis animate-fade-in animate-delay-400">
                <div class="analysis-container">
                    <!-- Department Rankings -->
                    <div class="analysis-card departments">
                        <div class="analysis-header">
                            <div class="analysis-icon departments">
                                <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="analysis-title-group">
                                <h3 class="analysis-title text-h3">Department Rankings</h3>
                                <p class="analysis-subtitle text-small">Automation readiness by department</p>
                            </div>
                        </div>
                        <div class="department-list">
                            <div class="department-item">
                                <div class="department-info">
                                    <div class="department-name text-body">Finance & Accounting</div>
                                    <div class="department-stats text-small">2 processes  Avg Score: 8.5/10</div>
                                </div>
                                <div class="department-score-bar">
                                    <div class="score-fill" style="width: 85%"></div>
                                </div>
                            </div>
                            <div class="department-item">
                                <div class="department-info">
                                    <div class="department-name text-body">Customer Service</div>
                                    <div class="department-stats text-small">2 processes  Avg Score: 7.8/10</div>
                                </div>
                                <div class="department-score-bar">
                                    <div class="score-fill" style="width: 78%"></div>
                                </div>
                            </div>
                            <div class="department-item">
                                <div class="department-info">
                                    <div class="department-name text-body">Operations</div>
                                    <div class="department-stats text-small">1 process  Avg Score: 7.2/10</div>
                                </div>
                                <div class="department-score-bar">
                                    <div class="score-fill" style="width: 72%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Use Case Priorities -->
                    <div class="analysis-card use-cases">
                        <div class="analysis-header">
                            <div class="analysis-icon use-cases">
                                <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="analysis-title-group">
                                <h3 class="analysis-title text-h3">Use Case Priorities</h3>
                                <p class="analysis-subtitle text-small">Ranked by ROI potential</p>
                            </div>
                        </div>
                        <div class="use-case-list">
                            <div class="use-case-item">
                                <div class="use-case-info">
                                    <div class="use-case-name text-body">Invoice Processing</div>
                                    <div class="use-case-details text-small">Priority Score: 9.2  6-8 week timeline</div>
                                </div>
                                <div class="use-case-badge high">High</div>
                            </div>
                            <div class="use-case-item">
                                <div class="use-case-info">
                                    <div class="use-case-name text-body">Resume Screening</div>
                                    <div class="use-case-details text-small">Priority Score: 8.7  4-6 week timeline</div>
                                </div>
                                <div class="use-case-badge high">High</div>
                            </div>
                            <div class="use-case-item">
                                <div class="use-case-info">
                                    <div class="use-case-name text-body">Email Automation</div>
                                    <div class="use-case-details text-small">Priority Score: 8.1  3-4 week timeline</div>
                                </div>
                                <div class="use-case-badge medium">Medium</div>
                            </div>
                            <div class="use-case-item">
                                <div class="use-case-info">
                                    <div class="use-case-name text-body">Customer Onboarding</div>
                                    <div class="use-case-details text-small">Priority Score: 7.4  8-12 week timeline</div>
                                </div>
                                <div class="use-case-badge medium">Medium</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ROI Breakdown -->
                    <div class="analysis-card roi-breakdown">
                        <div class="analysis-header">
                            <div class="analysis-icon roi">
                                <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                    <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="analysis-title-group">
                                <h3 class="analysis-title text-h3">ROI Breakdown</h3>
                                <p class="analysis-subtitle text-small">Financial impact analysis</p>
                            </div>
                        </div>
                        <div class="roi-stats">
                            <div class="roi-stat-item">
                                <div class="roi-stat-label text-small">Annual Savings</div>
                                <div class="roi-stat-value text-h2">$2.4M</div>
                            </div>
                            <div class="roi-stat-item">
                                <div class="roi-stat-label text-small">Average ROI</div>
                                <div class="roi-stat-value text-h2">370%</div>
                            </div>
                            <div class="roi-stat-item">
                                <div class="roi-stat-label text-small">Payback Period</div>
                                <div class="roi-stat-value text-h2">6.2mo</div>
                            </div>
                            <div class="roi-stat-item">
                                <div class="roi-stat-label text-small">Time Reduction</div>
                                <div class="roi-stat-value text-h2">45%</div>
                            </div>
                        </div>
                        <div class="roi-chart-container">
                            <canvas id="roiChart" width="300" height="180"></canvas>
                        </div>
                        <div class="roi-confidence text-small" style="color: var(--green-600); margin-top: var(--spacing-md);">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            85% Confidence Level
                        </div>
                    </div>
                </div>
            </section>

            <!-- Implementation Roadmap -->
            <section class="roadmap-section animate-fade-in animate-delay-500">
                <div class="roadmap-container">
                    <div class="roadmap-header">
                        <h2 class="roadmap-title text-h1">Implementation Roadmap</h2>
                        <p class="roadmap-subtitle text-body">Phase-based automation rollout strategy</p>
                    </div>
                    
                    <div class="roadmap-timeline">
                        <div class="roadmap-phase">
                            <div class="phase-marker phase-1"></div>
                            <div class="phase-content">
                                <div class="phase-header">
                                    <h3 class="phase-title text-h3 editable" data-field="title" data-phase="1" onclick="editPhaseField(this)">
                                        Phase 1: Quick Wins
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </h3>
                                    <span class="phase-duration text-small editable" data-field="duration" data-phase="1" onclick="editPhaseField(this)">
                                        Months 1-3
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </span>
                                </div>
                                <div class="phase-items" data-phase="1">
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Invoice Processing Automation</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">HR Resume Screening</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Email Response Automation</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="add-item-btn" onclick="addPhaseItem(1)">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                        </svg>
                                        Add Process
                                    </div>
                                </div>
                                <div class="phase-impact text-small editable" data-field="savings" data-phase="1" onclick="editPhaseField(this)">
                                    Expected Savings: $180k annually
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="roadmap-phase">
                            <div class="phase-marker phase-2"></div>
                            <div class="phase-content">
                                <div class="phase-header">
                                    <h3 class="phase-title text-h3 editable" data-field="title" data-phase="2" onclick="editPhaseField(this)">
                                        Phase 2: Mid-tier Automation
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </h3>
                                    <span class="phase-duration text-small editable" data-field="duration" data-phase="2" onclick="editPhaseField(this)">
                                        Months 4-8
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </span>
                                </div>
                                <div class="phase-items" data-phase="2">
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Customer Onboarding Workflow</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Inventory Management</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Report Generation</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="add-item-btn" onclick="addPhaseItem(2)">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                        </svg>
                                        Add Process
                                    </div>
                                </div>
                                <div class="phase-impact text-small editable" data-field="savings" data-phase="2" onclick="editPhaseField(this)">
                                    Expected Savings: $320k annually
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="roadmap-phase">
                            <div class="phase-marker phase-3"></div>
                            <div class="phase-content">
                                <div class="phase-header">
                                    <h3 class="phase-title text-h3 editable" data-field="title" data-phase="3" onclick="editPhaseField(this)">
                                        Phase 3: Major Projects
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </h3>
                                    <span class="phase-duration text-small editable" data-field="duration" data-phase="3" onclick="editPhaseField(this)">
                                        Months 9-18
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </span>
                                </div>
                                <div class="phase-items" data-phase="3">
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">ERP Integration</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Supply Chain Automation</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Advanced Analytics</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="add-item-btn" onclick="addPhaseItem(3)">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                        </svg>
                                        Add Process
                                    </div>
                                </div>
                                <div class="phase-impact text-small editable" data-field="savings" data-phase="3" onclick="editPhaseField(this)">
                                    Expected Savings: $1.2M annually
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="roadmap-phase">
                            <div class="phase-marker phase-4"></div>
                            <div class="phase-content">
                                <div class="phase-header">
                                    <h3 class="phase-title text-h3 editable" data-field="title" data-phase="4" onclick="editPhaseField(this)">
                                        Phase 4: Optimization
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </h3>
                                    <span class="phase-duration text-small editable" data-field="duration" data-phase="4" onclick="editPhaseField(this)">
                                        Months 19-24
                                        <div class="edit-controls">
                                            <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </div>
                                    </span>
                                </div>
                                <div class="phase-items" data-phase="4">
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">AI-Driven Insights</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Process Optimization</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="phase-item text-small editable" onclick="editPhaseItem(this)">
                                        <span class="phase-item-content">Scale & Expand</span>
                                        <div class="phase-item-actions">
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="add-item-btn" onclick="addPhaseItem(4)">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                        </svg>
                                        Add Process
                                    </div>
                                </div>
                                <div class="phase-impact text-small editable" data-field="savings" data-phase="4" onclick="editPhaseField(this)">
                                    Expected Savings: $700k annually
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Action Center -->
            <section class="action-center animate-fade-in animate-delay-600">
                <div class="action-container">
                    <div class="action-header">
                        <h2 class="action-title text-h1">Recommended Actions</h2>
                        <p class="action-subtitle text-body">Strategic next steps for maximizing automation ROI</p>
                    </div>
                    
                    <div class="action-grid">
                        <div class="action-card priority-high" data-action="1">
                            <div class="action-icon">
                                <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="action-content">
                                <h3 class="action-item-title text-h3 editable" data-field="title" data-action="1" onclick="editActionField(this)">
                                    Start with Invoice Processing
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </h3>
                                <p class="action-description text-body editable" data-field="description" data-action="1" onclick="editActionField(this)">
                                    Begin implementation with highest ROI quick win. Expected 340% ROI within 8 weeks.
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </p>
                                <div class="action-meta text-small editable" data-field="meta" data-action="1" onclick="editActionField(this)">
                                    Priority: High  Timeline: 6-8 weeks  Investment: $25k
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-card priority-high" data-action="2">
                            <div class="action-icon">
                                <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                                    <path d="M6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path>
                                </svg>
                            </div>
                            <div class="action-content">
                                <h3 class="action-item-title text-h3 editable" data-field="title" data-action="2" onclick="editActionField(this)">
                                    Establish Automation Team
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </h3>
                                <p class="action-description text-body editable" data-field="description" data-action="2" onclick="editActionField(this)">
                                    Form cross-functional team with Finance, IT, and Operations representatives.
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </p>
                                <div class="action-meta text-small editable" data-field="meta" data-action="2" onclick="editActionField(this)">
                                    Priority: High  Timeline: 2 weeks  Investment: Internal
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-card priority-medium" data-action="3">
                            <div class="action-icon">
                                <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="action-content">
                                <h3 class="action-item-title text-h3 editable" data-field="title" data-action="3" onclick="editActionField(this)">
                                    Vendor Evaluation
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </h3>
                                <p class="action-description text-body editable" data-field="description" data-action="3" onclick="editActionField(this)">
                                    Evaluate RPA platforms and AI automation tools for enterprise deployment.
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </p>
                                <div class="action-meta text-small editable" data-field="meta" data-action="3" onclick="editActionField(this)">
                                    Priority: Medium  Timeline: 4 weeks  Investment: $15k
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-card priority-medium" data-action="4">
                            <div class="action-icon">
                                <svg width="24" height="24" fill="white" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="action-content">
                                <h3 class="action-item-title text-h3 editable" data-field="title" data-action="4" onclick="editActionField(this)">
                                    Process Documentation
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </h3>
                                <p class="action-description text-body editable" data-field="description" data-action="4" onclick="editActionField(this)">
                                    Document current state processes in detail to enable accurate automation design.
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </p>
                                <div class="action-meta text-small editable" data-field="meta" data-action="4" onclick="editActionField(this)">
                                    Priority: Medium  Timeline: 3 weeks  Investment: Internal
                                    <div class="edit-controls">
                                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Hidden compatibility elements for chart functionality -->
            <div id="debug-info" class="debug-info" style="display: none;">
                <strong>Debug Information:</strong><br>
                <span id="debug-content">Initializing dashboard...</span>
            </div>
            
            <!-- Hidden chart containers for compatibility -->
            <div class="chart-grid" style="display: none;">
                <div class="chart-container">
                    <div class="chart-title">Process Priority Matrix</div>
                    <canvas id="bubbleChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Department Distribution</div>
                    <canvas id="donutChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Automation Readiness Scores</div>
                    <canvas id="radarChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Weekly Time Investment</div>
                    <canvas id="barChart"></canvas>
                </div>
            </div>
            
            <!-- Modern Debug Panel -->
            <div class="debug-panel" id="debugPanel">
                <div class="debug-toggle" id="debugToggle">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313-12.454z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0-2 2a2 2 0 0 0-2-2a2 2 0 0 0 2-2"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11a1 1 0 1 0 2 0a1 1 0 0 0-2 0"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 11a1 1 0 1 0 2 0a1 1 0 0 0-2 0"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14a2 2 0 0 0 4 0"/>
                    </svg>
                    <div class="debug-indicator" id="debugIndicator"></div>
                </div>
                
                <div class="debug-content" id="debugContent">
                    <div class="debug-header">
                        <h4>
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Debug Console
                            <span class="debug-badge">Live</span>
                        </h4>
                    </div>
                    <div class="debug-body" id="debugMessages">
                        <div class="debug-message">
                            <div class="debug-timestamp">Loading...</div>
                            <div class="debug-text">Initializing dashboard...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Global variables for dashboard state
        let currentProjectId = null;
        let currentProject = 'SunSep7';
        let projects = [];
        let processes = [];
        let charts = {};
        let currentStep = 1;
        let editingProcessId = null;
        let workshopMode = false;
        let currentDepartment = '';
        let currentProjectContext = null;
        let autoLoadProject = false;
        let currentDepartmentFilter = null;
        let workshopReviewMode = false;
        let isAdmin = true;
        let sampleProcesses = [];
        let debugPanelExpanded = false;
        let debugMessages = [];
        const MAX_DEBUG_MESSAGES = 50;

        // Enhanced project data structure matching backup
        const projectData = {
            'SunSep7': [
                {
                    id: 'proc_001',
                    name: "Invoice Processing Automation",
                    department: "Finance", 
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 15,
                    scores: { repetitive: 9, dataDriven: 8, ruleBased: 9, highVolume: 8 },
                    notes: "Manual invoice processing takes significant time and prone to errors",
                    created_at: new Date('2024-09-01').toISOString(),
                    automation_avg: 8.5,
                    priority_score: 7.8
                },
                {
                    id: 'proc_002',
                    name: "Customer Onboarding Workflow",
                    department: "Sales",
                    impact: 9,
                    feasibility: 6,
                    timeSpent: 12,
                    scores: { repetitive: 7, dataDriven: 6, ruleBased: 8, highVolume: 7 },
                    notes: "Multiple touchpoints and manual data entry required",
                    created_at: new Date('2024-09-02').toISOString(),
                    automation_avg: 7.0,
                    priority_score: 7.4
                },
                {
                    id: 'proc_003',
                    name: "Report Generation System",
                    department: "Operations",
                    impact: 6,
                    feasibility: 9,
                    timeSpent: 8,
                    scores: { repetitive: 10, dataDriven: 9, ruleBased: 7, highVolume: 6 },
                    notes: "Weekly reports compiled manually from multiple sources",
                    created_at: new Date('2024-09-03').toISOString(),
                    automation_avg: 8.0,
                    priority_score: 7.2
                }
            ],
            'Project Alpha': [
                {
                    id: 'proc_004',
                    name: "Employee Performance Reviews",
                    department: "HR",
                    impact: 7,
                    feasibility: 8,
                    timeSpent: 10,
                    scores: { repetitive: 6, dataDriven: 7, ruleBased: 6, highVolume: 5 },
                    notes: "Quarterly review process requires standardization",
                    created_at: new Date('2024-09-04').toISOString(),
                    automation_avg: 6.0,
                    priority_score: 6.8
                },
                {
                    id: 'proc_005',
                    name: "Inventory Management",
                    department: "Operations",
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 20,
                    scores: { repetitive: 8, dataDriven: 9, ruleBased: 8, highVolume: 9 },
                    notes: "Stock level monitoring and reorder process",
                    created_at: new Date('2024-09-05').toISOString(),
                    automation_avg: 8.5,
                    priority_score: 8.0
                },
                {
                    id: 'proc_006',
                    name: "Expense Report Processing",
                    department: "Finance",
                    impact: 6,
                    feasibility: 8,
                    timeSpent: 8,
                    scores: { repetitive: 9, dataDriven: 8, ruleBased: 8, highVolume: 7 },
                    notes: "Manual approval workflow causes delays",
                    created_at: new Date('2024-09-06').toISOString(),
                    automation_avg: 8.0,
                    priority_score: 7.2
                }
            ],
            'Project Beta': [
                {
                    id: 'proc_007',
                    name: "Social Media Scheduling",
                    department: "Marketing",
                    impact: 5,
                    feasibility: 9,
                    timeSpent: 6,
                    scores: { repetitive: 9, dataDriven: 5, ruleBased: 7, highVolume: 6 },
                    notes: "Content scheduling across multiple platforms",
                    created_at: new Date('2024-09-07').toISOString(),
                    automation_avg: 6.75,
                    priority_score: 6.5
                },
                {
                    id: 'proc_008',
                    name: "Customer Support Tickets",
                    department: "Support",
                    impact: 9,
                    feasibility: 6,
                    timeSpent: 25,
                    scores: { repetitive: 7, dataDriven: 6, ruleBased: 8, highVolume: 9 },
                    notes: "High volume of tickets requiring triage and routing",
                    created_at: new Date('2024-09-08').toISOString(),
                    automation_avg: 7.5,
                    priority_score: 7.8
                },
                {
                    id: 'proc_009',
                    name: "Data Backup Procedures",
                    department: "IT",
                    impact: 10,
                    feasibility: 8,
                    timeSpent: 5,
                    scores: { repetitive: 10, dataDriven: 8, ruleBased: 9, highVolume: 4 },
                    notes: "Critical system backups performed manually",
                    created_at: new Date('2024-09-09').toISOString(),
                    automation_avg: 7.75,
                    priority_score: 8.5
                },
                {
                    id: 'proc_010',
                    name: "Lead Qualification Process",
                    department: "Sales",
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 15,
                    scores: { repetitive: 8, dataDriven: 9, ruleBased: 8, highVolume: 8 },
                    notes: "Manual lead scoring and assignment process",
                    created_at: new Date('2024-09-10').toISOString(),
                    automation_avg: 8.25,
                    priority_score: 7.9
                },
                {
                    id: 'proc_011',
                    name: "Document Approval Workflow",
                    department: "Legal",
                    impact: 7,
                    feasibility: 6,
                    timeSpent: 18,
                    scores: { repetitive: 6, dataDriven: 5, ruleBased: 8, highVolume: 6 },
                    notes: "Contract and document approval routing",
                    created_at: new Date('2024-09-11').toISOString(),
                    automation_avg: 6.25,
                    priority_score: 6.7
                }
            ]
        };

        // Enhanced project metadata
        const projectMetadata = {
            'SunSep7': {
                name: 'SunSep7',
                description: 'Q3 2024 Automation Assessment',
                created_at: '2024-09-07',
                facilitator: 'Workshop Admin',
                departments: ['Finance', 'Sales', 'Operations'],
                status: 'active'
            },
            'Project Alpha': {
                name: 'Project Alpha',
                description: 'HR & Operations Optimization',
                created_at: '2024-08-15',
                facilitator: 'Process Manager',
                departments: ['HR', 'Operations', 'Finance'],
                status: 'active'
            },
            'Project Beta': {
                name: 'Project Beta',
                description: 'Enterprise-wide Digital Transformation',
                created_at: '2024-08-01',
                facilitator: 'Digital Lead',
                departments: ['Marketing', 'Support', 'IT', 'Sales', 'Legal'],
                status: 'active'
            }
        };

        // Initialize projects with sample data if needed
        function initializeProjects() {
            const savedProjects = localStorage.getItem('businessProjects');
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
            } else {
                // Initialize with sample projects if none exist
                projects = [
                    {
                        id: '550e8400-e29b-41d4-a716-446655440001',
                        name: 'SunSep7 Automation',
                        clientName: 'Q3 2024 Automation Assessment',
                        createdAt: new Date('2024-09-07').toISOString()
                    },
                    {
                        id: '550e8400-e29b-41d4-a716-446655440002', 
                        name: 'Project Alpha',
                        clientName: 'Digital Transformation Initiative',
                        createdAt: new Date('2024-08-15').toISOString()
                    },
                    {
                        id: '550e8400-e29b-41d4-a716-446655440003',
                        name: 'Project Beta', 
                        clientName: 'Enterprise-wide Process Optimization',
                        createdAt: new Date('2024-08-01').toISOString()
                    }
                ];
                saveProjects();
            }
            
            // Update dropdowns after initialization
            debugLog(' Projects initialized: ' + projects.length + ' projects');
        }
        
        // Initialize current data - now using dynamic processes array instead of static projectData
        // sampleProcesses = projectData[currentProject] || []; // DEPRECATED: Now using dynamic processes array
        
        // Notification System
        function showNotification(message, type = 'info', duration = 4000) {
            // Create notification element if it doesn't exist
            let notification = document.getElementById('globalNotification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'globalNotification';
                notification.className = 'notification';
                document.body.appendChild(notification);
            }

            // Clear any existing hide timeout
            if (notification.hideTimeout) {
                clearTimeout(notification.hideTimeout);
            }

            // Set message and type
            notification.textContent = message;
            notification.className = `notification ${type}`;

            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            // Auto-hide after duration
            notification.hideTimeout = setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }
        
        // Utility Functions
        function generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }
        
        function getPreferredStorageMode() {
            const supabaseRadio = document.getElementById('storageSupabase');
            const localRadio = document.getElementById('storageLocal');
            
            if (supabaseRadio && supabaseRadio.checked) {
                return 'supabase';
            } else if (localRadio && localRadio.checked) {
                return 'localStorage';
            }
            
            // Default to supabase if no preference is set
            return 'supabase';
        }
        
        function updateStorageMode(mode) {
            const description = document.getElementById('storageModeDescription');
            if (description) {
                if (mode === 'supabase') {
                    description.innerHTML = ' All new projects will use Supabase cloud database. Existing projects keep their current storage type.';
                } else {
                    description.innerHTML = ' All new projects will use local storage. Data stays on this device only.';
                }
            }
            console.log(` Storage mode updated to: ${mode}`);
        }
        
        // Additional process management helper functions
        if (typeof saveProcesses === 'undefined') {
            async function saveProcesses() {
                try {
                    const preferredStorageMode = getPreferredStorageMode();
                    
                    if (preferredStorageMode === 'localStorage') {
                        localStorage.setItem('businessProcesses', JSON.stringify(processes));
                        console.log(' Processes saved to localStorage');
                        return true;
                    } else {
                        // For Supabase mode, individual processes are managed through submitProcess/updateProcess/deleteProcess
                        // Just save to localStorage for UI consistency
                        localStorage.setItem('businessProcesses', JSON.stringify(processes));
                        console.log(' Processes synced to localStorage for UI consistency');
                        return true;
                    }
                } catch (error) {
                    console.error(' Failed to save processes:', error);
                    return false;
                }
            }
        }
        
        if (typeof loadProcesses === 'undefined') {
            async function loadProcesses(projectId) {
                try {
                    const preferredStorageMode = getPreferredStorageMode();
                    
                    if (preferredStorageMode === 'supabase' && window.workshopDB && window.workshopDB.isConnected()) {
                        // Load from Supabase
                        const supabaseProcesses = await window.workshopDB.getProcesses(projectId);
                        processes = supabaseProcesses.map(p => ({
                            id: p.id,
                            name: p.name,
                            department: p.department,
                            customDepartment: p.custom_department,
                            timeSpent: p.time_spent,
                            scores: p.scores || {},
                            impact: p.impact,
                            feasibility: p.feasibility,
                            notes: p.notes,
                            projectId: p.project_id,
                            createdAt: p.created_at,
                            updatedAt: p.updated_at,
                            storageType: 'supabase'
                        }));
                        console.log(' Processes loaded from Supabase:', processes.length);
                    } else {
                        // Load from localStorage
                        const saved = localStorage.getItem('businessProcesses');
                        if (saved) {
                            const allProcesses = JSON.parse(saved);
                            processes = projectId ? allProcesses.filter(p => p.projectId === projectId) : allProcesses;
                        } else {
                            processes = [];
                        }
                        console.log(' Processes loaded from localStorage:', processes.length);
                    }
                    
                    renderProcessList();
                    return processes;
                } catch (error) {
                    console.error(' Failed to load processes:', error);
                    processes = [];
                    return [];
                }
            }
        }
        
        if (typeof renderProcessList === 'undefined') {
            function renderProcessList() {
                // Update any process list displays
                if (currentWorkspace === 'process') {
                    refreshProcessWorkspaceList();
                }
                debugLog(' Process list rendered');
            }
        }
        
        function debugLog(message) {
            // Only show debug messages in development mode with debug=true parameter
            const isDebugMode = window.location.hostname === 'localhost' && window.location.search.includes('debug=true');
            
            if (isDebugMode) {
                console.log(message);
                
                // Legacy compatibility - update old debug-content if it exists
                const oldDebugContent = document.getElementById('debug-content');
                if (oldDebugContent) {
                    oldDebugContent.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
                }
                
                // Add to new debug system
                addDebugMessage(message);
            }
        }
        
        // Debug function to check current project processes
        window.checkProcessCount = function(projectId = currentProjectId) {
            if (!projectId) {
                console.log(' No project ID provided or current project set');
                return;
            }
            
            console.log(' Checking processes for project:', projectId);
            console.log(' Current processes array length:', processes.length);
            console.log(' Current processes:', processes);
            
            // Also try to get fresh data from storage
            if (window.workshopDB && window.workshopDB.isConnected()) {
                window.workshopDB.getProcesses(projectId).then(freshProcesses => {
                    debugLog(' Fresh data from Supabase: ' + freshProcesses.length + ' processes');
                    freshProcesses.forEach((process, index) => {
                        debugLog(`${index + 1}. ${process.name} (${process.department})`);
                    });
                });
            }
        };
        
        function addDebugMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            const debugMessage = {
                timestamp,
                text: message,
                id: Date.now()
            };
            
            // Add to messages array
            debugMessages.unshift(debugMessage);
            
            // Keep only the latest messages
            if (debugMessages.length > MAX_DEBUG_MESSAGES) {
                debugMessages = debugMessages.slice(0, MAX_DEBUG_MESSAGES);
            }
            
            // Update the debug panel if it exists
            updateDebugPanel();
            
            // Pulse the indicator
            pulseDebugIndicator();
        }
        
        function updateDebugPanel() {
            const debugMessagesContainer = document.getElementById('debugMessages');
            if (!debugMessagesContainer) return;
            
            if (debugMessages.length === 0) {
                debugMessagesContainer.innerHTML = `
                    <div class="debug-message">
                        <div class="debug-timestamp">Ready</div>
                        <div class="debug-text">No debug messages yet...</div>
                    </div>
                `;
                return;
            }
            
            const messagesHtml = debugMessages.map(msg => `
                <div class="debug-message">
                    <div class="debug-timestamp">${msg.timestamp}</div>
                    <div class="debug-text">${msg.text}</div>
                </div>
            `).join('');
            
            debugMessagesContainer.innerHTML = messagesHtml;
            
            // Auto-scroll to top (latest message)
            debugMessagesContainer.scrollTop = 0;
        }
        
        function pulseDebugIndicator() {
            const indicator = document.getElementById('debugIndicator');
            if (!indicator) return;
            
            // Add pulse animation
            indicator.style.animation = 'none';
            setTimeout(() => {
                indicator.style.animation = 'pulse 1s ease-in-out';
            }, 10);
        }
        
        function toggleDebugPanel() {
            debugPanelExpanded = !debugPanelExpanded;
            
            const debugToggle = document.getElementById('debugToggle');
            const debugContent = document.getElementById('debugContent');
            
            if (!debugToggle || !debugContent) return;
            
            if (debugPanelExpanded) {
                debugToggle.classList.add('expanded');
                debugContent.classList.add('show');
                updateDebugPanel();
                addDebugMessage(' Debug panel opened');
            } else {
                debugToggle.classList.remove('expanded');
                debugContent.classList.remove('show');
                addDebugMessage(' Debug panel closed');
            }
        }
        
        function initializeDebugPanel() {
            const debugToggle = document.getElementById('debugToggle');
            if (debugToggle) {
                debugToggle.addEventListener('click', toggleDebugPanel);
                addDebugMessage(' Debug panel initialized');
                updateDebugPanel();
            }
            
            // Close panel when clicking outside
            document.addEventListener('click', (e) => {
                const debugPanel = document.getElementById('debugPanel');
                if (debugPanel && !debugPanel.contains(e.target) && debugPanelExpanded) {
                    toggleDebugPanel();
                }
            });
        }

        // Enhanced Interactive Functions for New UI
        function showQuadrantDetails(quadrant) {
            const details = {
                'major': {
                    title: 'Major Projects',
                    description: 'High-impact initiatives requiring significant investment and planning.',
                    characteristics: ['Complex implementation', 'High ROI potential', 'Strategic importance'],
                    timeline: '6-18 months',
                    resources: 'High'
                },
                'quick': {
                    title: 'Quick Wins',
                    description: 'High-impact opportunities with minimal implementation effort.',
                    characteristics: ['Immediate benefits', 'Low complexity', 'Fast deployment'],
                    timeline: '1-3 months',
                    resources: 'Low'
                },
                'fillins': {
                    title: 'Fill-in Projects',
                    description: 'Low-impact initiatives suitable for resource balancing.',
                    characteristics: ['Simple automation', 'Minimal risk', 'Training opportunities'],
                    timeline: '1-2 months',
                    resources: 'Low'
                },
                'avoid': {
                    title: 'Avoid Zone',
                    description: 'Low-impact, high-effort initiatives that should be deprioritized.',
                    characteristics: ['Poor ROI', 'High complexity', 'Resource intensive'],
                    timeline: 'Indefinite',
                    resources: 'High'
                }
            };

            const detail = details[quadrant];
            if (detail) {
                const message = `${detail.title}\n\n${detail.description}\n\nCharacteristics:\n${detail.characteristics.map(c => ' ' + c).join('\n')}\n\nTimeline: ${detail.timeline}\nResource Requirement: ${detail.resources}`;
                alert(message);
            }
        }

        function updateKeyMetrics() {
            const projectSelector = document.getElementById('projectSelector');
            const currentProjectName = document.getElementById('currentProjectName');
            const totalProcesses = document.getElementById('totalProcesses');
            const activeDepartments = document.getElementById('activeDepartments');
            const lastUpdated = document.getElementById('lastUpdated');

            if (currentProjectName && projectSelector) {
                const selectedProject = projectSelector.options[projectSelector.selectedIndex];
                currentProjectName.textContent = selectedProject ? selectedProject.text : '-';
            }

            if (totalProcesses) {
                totalProcesses.textContent = processes.length;
            }

            if (activeDepartments) {
                const departments = [...new Set(processes.map(p => p.department).filter(d => d))];
                activeDepartments.textContent = departments.length;
            }

            if (lastUpdated) {
                lastUpdated.textContent = new Date().toLocaleDateString();
            }
        }

        function updateBusinessKPIs() {
            // Calculate automation readiness score
            let readinessScore = 0;
            if (processes.length > 0) {
                const avgComplexity = processes.reduce((sum, p) => sum + (p.complexity || 5), 0) / processes.length;
                const avgImpact = processes.reduce((sum, p) => sum + (p.impact || 5), 0) / processes.length;
                readinessScore = Math.round(((10 - avgComplexity) * 5 + avgImpact * 5) * 1.6);
            }

            // Calculate projected savings
            const avgSavings = processes.reduce((sum, p) => sum + (p.potentialSavings || 0), 0);
            const projectedSavings = avgSavings > 1000000 ? 
                `$${(avgSavings / 1000000).toFixed(1)}M` : 
                `$${Math.round(avgSavings / 1000)}K`;

            // Count quick wins (high impact, low complexity)
            const quickWins = processes.filter(p => 
                (p.impact || 5) >= 7 && (p.complexity || 5) <= 4
            ).length;

            // Update UI
            const readinessEl = document.getElementById('readinessScore');
            const savingsEl = document.getElementById('projectedSavings');
            const quickWinsEl = document.getElementById('quickWins');

            if (readinessEl) readinessEl.innerHTML = `${readinessScore}<span style="font-size: 1.5rem; color: var(--gray-500);">/100</span>`;
            if (savingsEl) savingsEl.textContent = projectedSavings;
            if (quickWinsEl) quickWinsEl.textContent = quickWins;

            // Animate progress ring
            const progressRing = document.querySelector('#readinessRing .progress');
            if (progressRing) {
                const circumference = 2 * Math.PI * 30; // radius = 30
                const progress = readinessScore;
                const offset = circumference - (progress / 100) * circumference;
                progressRing.style.strokeDashoffset = offset;
            }

            // Update progress bars
            const readinessBar = document.querySelector('.kpi-progress-bar.readiness');
            const savingsBar = document.querySelector('.kpi-progress-bar.savings');
            const quickWinsBar = document.querySelector('.kpi-progress-bar.quick-wins');

            if (readinessBar) readinessBar.style.width = `${readinessScore}%`;
            if (savingsBar) savingsBar.style.width = `${Math.min(avgSavings / 3700000 * 100, 100)}%`;
            if (quickWinsBar) quickWinsBar.style.width = `${Math.min(quickWins / 15 * 100, 100)}%`;
        }

        function updatePriorityMatrix() {
            // Categorize processes into quadrants
            const quadrants = {
                major: [], // High impact, high complexity
                quick: [], // High impact, low complexity
                fillins: [], // Low impact, low complexity
                avoid: [] // Low impact, high complexity
            };

            processes.forEach(process => {
                const impact = process.impact || 5;
                const complexity = process.complexity || 5;
                
                if (impact >= 6) {
                    if (complexity >= 6) {
                        quadrants.major.push(process);
                    } else {
                        quadrants.quick.push(process);
                    }
                } else {
                    if (complexity >= 6) {
                        quadrants.avoid.push(process);
                    } else {
                        quadrants.fillins.push(process);
                    }
                }
            });

            // Update counts
            const majorCount = document.getElementById('majorProjectsCount');
            const quickCount = document.getElementById('quickWinsCount');
            const fillInsCount = document.getElementById('fillInsCount');
            const avoidCount = document.getElementById('avoidCount');

            if (majorCount) majorCount.textContent = quadrants.major.length;
            if (quickCount) quickCount.textContent = quadrants.quick.length;
            if (fillInsCount) fillInsCount.textContent = quadrants.fillins.length;
            if (avoidCount) avoidCount.textContent = quadrants.avoid.length;

            // Update process lists
            updateQuadrantProcesses('majorProjectsList', quadrants.major, 'major-projects');
            updateQuadrantProcesses('quickWinsList', quadrants.quick, 'quick-wins');
            updateQuadrantProcesses('fillInsList', quadrants.fillins, 'fill-ins');
            updateQuadrantProcesses('avoidList', quadrants.avoid, 'avoid');
        }

        function updateQuadrantProcesses(containerId, processes, quadrantType) {
            const container = document.getElementById(containerId);
            if (!container) return;

            if (processes.length === 0) {
                container.innerHTML = '<div class="process-item"><span class="process-name">No processes in this category</span></div>';
                return;
            }

            // Show top 3 processes
            const topProcesses = processes.slice(0, 3);
            container.innerHTML = topProcesses.map(process => {
                const score = Math.round((process.impact || 5) * 10 + (10 - (process.complexity || 5)) * 5);
                return `
                    <div class="process-item">
                        <span class="process-name">${process.name || 'Unnamed Process'}</span>
                        <span class="process-score">${score}</span>
                    </div>
                `;
            }).join('');

            // Add "show more" if there are more processes
            if (processes.length > 3) {
                container.innerHTML += `
                    <div class="process-item" style="opacity: 0.7; font-style: italic;">
                        <span class="process-name">+${processes.length - 3} more processes</span>
                    </div>
                `;
            }
        }

        function updateDashboardSections() {
            updateKeyMetrics();
            updateBusinessKPIs();
            updatePriorityMatrix();
        }

        function switchProject(projectId) {
            if (!projectId) return;
            
            currentProjectId = projectId;
            localStorage.setItem('currentProjectId', projectId);
            
            // Load processes for the new project
            loadProcesses(projectId).then(() => {
                console.log(' Switched to project:', projectId);
                renderProcessList();
                updateDashboardSections();
                recreateCharts();
            }).catch(error => {
                console.error(' Error switching project:', error);
                showNotification('Failed to switch project', 'error');
            });
        }

        function createBubbleChart() {
            const element = document.getElementById('bubbleChart');
            const container = element.parentElement;
            
            debugLog(` Bubble chart - Element: ${!!element}, Container: ${!!container}`);
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                debugLog(` Container dimensions: ${containerRect.width}x${containerRect.height}`);
                
                // Force proper canvas dimensions
                const width = Math.max(containerRect.width - 40, 400); // Account for padding
                const height = Math.max(containerRect.height - 60, 300); // Account for title
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
                
                debugLog(` Set canvas dimensions: ${width}x${height}`);
            }

            const ctx = element.getContext('2d');
            
            if (charts.bubble) {
                charts.bubble.destroy();
            }

            const data = (processes || []).map(process => ({
                x: process.impact || 0,
                y: process.feasibility || 0,
                r: Math.max(process.timeSpent || 0, 5),
                label: process.name || 'Unknown',
                department: process.department || 'Unknown'
            }));
            
            // Debug logging
            console.log(` Bubble chart data: ${data.length} points from ${processes.length} processes`);
            if (data.length > 0) {
                console.log(' Sample chart point:', data[0]);
                // Check for any zero values
                const zeroPoints = data.filter(d => d.x === 0 || d.y === 0);
                if (zeroPoints.length > 0) {
                    console.warn(` ${zeroPoints.length} points have zero values:`, zeroPoints);
                }
            }

            charts.bubble = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Business Processes',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw.label} (${context.raw.department}): Impact ${context.raw.x}, Feasibility ${context.raw.y}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Business Impact',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            min: 0,
                            max: 10
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Technical Feasibility',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            min: 0,
                            max: 10
                        }
                    }
                }
            });
            
            debugLog(` Bubble chart created successfully`);
        }

        function createDonutChart() {
            const element = document.getElementById('donutChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.donut) {
                charts.donut.destroy();
            }

            // Calculate department hours
            const departmentHours = {};
            (processes || []).forEach(p => {
                departmentHours[p.department] = (departmentHours[p.department] || 0) + p.timeSpent;
            });

            charts.donut = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(departmentHours),
                    datasets: [{
                        data: Object.values(departmentHours),
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)', 
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(124, 58, 237, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed} hours/week`;
                                }
                            }
                        }
                    }
                }
            });
            
            debugLog(` Donut chart created successfully`);
        }

        function createRadarChart() {
            const element = document.getElementById('radarChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.radar) {
                charts.radar.destroy();
            }

            // Calculate average scores
            const avgScores = (processes || []).reduce((acc, p) => {
                const scores = p.scores || {};
                acc.repetitive += scores.repetitive || 0;
                acc.dataDriven += scores.dataDriven || 0;
                acc.ruleBased += scores.ruleBased || 0;
                acc.highVolume += scores.highVolume || 0;
                return acc;
            }, { repetitive: 0, dataDriven: 0, ruleBased: 0, highVolume: 0 });

            const processCount = (processes || []).length;
            Object.keys(avgScores).forEach(key => {
                avgScores[key] = avgScores[key] / processCount;
            });

            charts.radar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Repetitive Tasks', 'Data-Driven', 'Rule-Based', 'High Volume'],
                    datasets: [{
                        label: 'Automation Readiness',
                        data: [
                            avgScores.repetitive,
                            avgScores.dataDriven,
                            avgScores.ruleBased,
                            avgScores.highVolume
                        ],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
            
            debugLog(` Radar chart created successfully`);
        }

        function createBarChart() {
            const element = document.getElementById('barChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.bar) {
                charts.bar.destroy();
            }

            charts.bar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: (processes || []).map(p => p.name),
                    datasets: [{
                        label: 'Hours per Week',
                        data: (processes || []).map(p => p.timeSpent),
                        backgroundColor: 'rgba(245, 158, 11, 0.7)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y} hours/week`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours per Week',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            debugLog(` Bar chart created successfully`);
        }
        
        // New ROI Chart function for the comprehensive dashboard
        function createROIChart() {
            const element = document.getElementById('roiChart');
            if (!element) {
                debugLog(' ROI chart canvas not found');
                return;
            }
            
            const ctx = element.getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts.roi) {
                charts.roi.destroy();
            }
            
            // Calculate metrics from current processes
            const metrics = calculateROIMetrics();
            
            charts.roi = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Projected Savings', 'Remaining Potential', 'Investment Required'],
                    datasets: [{
                        data: [metrics.projectedSavings, metrics.remainingPotential, metrics.investmentRequired],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)', 
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(245, 158, 11, 1)',
                            'rgba(239, 68, 68, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                padding: 10,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    return label + ': $' + (value / 1000).toFixed(1) + 'K';
                                }
                            }
                        }
                    }
                }
            });
            
            debugLog(' ROI chart created successfully');
        }
        
        // Calculate ROI metrics from current processes
        function calculateROIMetrics() {
            if (!processes || processes.length === 0) {
                return {
                    projectedSavings: 0,
                    remainingPotential: 0,
                    investmentRequired: 0,
                    averageROI: 0,
                    paybackPeriod: 0,
                    timeReduction: 0
                };
            }
            
            // Calculate based on actual process data
            const totalImpact = processes.reduce((sum, p) => sum + (p.impact || 0), 0);
            const totalFeasibility = processes.reduce((sum, p) => sum + (p.feasibility || 0), 0);
            const totalTimeSpent = processes.reduce((sum, p) => sum + (p.timeSpent || 0), 0);
            
            const projectedSavings = Math.round((totalImpact * totalTimeSpent * 2000) + Math.random() * 500000);
            const investmentRequired = Math.round(projectedSavings * 0.3);
            const remainingPotential = Math.round(projectedSavings * 0.6);
            const averageROI = Math.round((projectedSavings / investmentRequired) * 100);
            const paybackPeriod = Math.round((investmentRequired / (projectedSavings / 12)) * 10) / 10;
            const timeReduction = Math.round((totalImpact / processes.length) * 10);
            
            return {
                projectedSavings,
                remainingPotential,
                investmentRequired,
                averageROI,
                paybackPeriod,
                timeReduction
            };
        }
        
        // Update dashboard metrics with real data
        function updateDashboardMetrics() {
            try {
                // Update project name - use project name from projects array, not ID
                const projectNameElement = document.getElementById('currentProjectName');
                if (projectNameElement && currentProjectId) {
                    const currentProjectObj = projects.find(p => p.id === currentProjectId);
                    if (currentProjectObj) {
                        projectNameElement.textContent = currentProjectObj.name;
                    } else {
                        projectNameElement.textContent = 'Unknown Project';
                    }
                } else if (projectNameElement) {
                    projectNameElement.textContent = 'No Project Selected';
                }
                
                // Update total processes
                const totalProcessesElement = document.getElementById('totalProcesses');
                if (totalProcessesElement) {
                    totalProcessesElement.textContent = processes.length;
                }
                
                // Update departments (count unique departments)
                const departments = [...new Set(processes.map(p => p.department).filter(Boolean))];
                const departmentsElement = document.getElementById('activeDepartments');
                if (departmentsElement) {
                    // Show actual department count, not hardcoded fallback
                    departmentsElement.textContent = departments.length;
                }
                
                // Update last updated
                const lastUpdatedElement = document.getElementById('lastUpdated');
                if (lastUpdatedElement) {
                    lastUpdatedElement.textContent = 'Today';
                }
                
                // Update readiness score (calculate from process data)
                const readinessScoreElement = document.getElementById('readinessScore');
                if (readinessScoreElement && processes.length > 0) {
                    const avgScore = processes.reduce((sum, p) => {
                        const automation_avg = p.automation_avg || ((p.impact + p.feasibility) / 2);
                        return sum + automation_avg;
                    }, 0) / processes.length;
                    const score = Math.round(avgScore * 10);
                    readinessScoreElement.innerHTML = `${score}<span style="font-size: 1.5rem; color: var(--gray-500);">/100</span>`;
                    
                    // Update progress ring
                    const progressRing = document.querySelector('#readinessRing .progress');
                    if (progressRing) {
                        const circumference = 2 * Math.PI * 30;
                        const offset = circumference - (score / 100) * circumference;
                        progressRing.style.strokeDashoffset = offset;
                    }
                }
                
                // Update ROI metrics
                const metrics = calculateROIMetrics();
                const projectedSavingsElement = document.getElementById('projectedSavings');
                if (projectedSavingsElement) {
                    projectedSavingsElement.textContent = '$' + (metrics.projectedSavings / 1000000).toFixed(1) + 'M';
                }
                
                // Update quick wins count  
                const quickWinsElement = document.getElementById('quickWins');
                if (quickWinsElement) {
                    const quickWins = processes.filter(p => (p.impact >= 7) && (p.feasibility >= 7)).length;
                    quickWinsElement.textContent = quickWins;
                }
                
                // Update matrix counts
                updateMatrixCounts();
                
                // Hide/show sections based on whether project has processes
                toggleEmptyProjectSections(processes.length === 0);
                
                debugLog(' Dashboard metrics updated successfully');
            } catch (error) {
                debugLog(' Error updating dashboard metrics: ' + error.message);
            }
        }
        
        // Update priority matrix quadrant counts
        function updateMatrixCounts() {
            try {
                const majorProjects = processes.filter(p => (p.impact >= 7) && (p.feasibility <= 5)).length;
                const quickWins = processes.filter(p => (p.impact >= 7) && (p.feasibility >= 7)).length;
                const fillIns = processes.filter(p => (p.impact <= 5) && (p.feasibility >= 7)).length;
                const avoid = processes.filter(p => (p.impact <= 5) && (p.feasibility <= 5)).length;
                
                const majorElement = document.getElementById('majorProjectsCount');
                if (majorElement) majorElement.textContent = majorProjects;
                
                const quickElement = document.getElementById('quickWinsCount');
                if (quickElement) quickElement.textContent = quickWins;
                
                const fillElement = document.getElementById('fillInsCount');
                if (fillElement) fillElement.textContent = fillIns;
                
                const avoidElement = document.getElementById('avoidCount');
                if (avoidElement) avoidElement.textContent = avoid;
                
                debugLog(' Matrix counts updated successfully');
            } catch (error) {
                debugLog(' Error updating matrix counts: ' + error.message);
            }
        }

        // Toggle visibility of sections that shouldn't show for empty projects
        function toggleEmptyProjectSections(isEmpty) {
            try {
                // ROI Breakdown section
                const roiSection = document.querySelector('.roi-section, .roi-breakdown, #roiSection');
                if (roiSection) {
                    roiSection.style.display = isEmpty ? 'none' : '';
                }
                
                // Implementation Roadmap section
                const roadmapSection = document.querySelector('#implementationRoadmap, .roadmap-section');
                if (roadmapSection) {
                    roadmapSection.style.display = isEmpty ? 'none' : '';
                }
                
                // Recommended Actions section
                const actionsSection = document.querySelector('.action-center, .recommended-actions, .actions-section');
                if (actionsSection) {
                    actionsSection.style.display = isEmpty ? 'none' : '';
                }
                
                debugLog(`${isEmpty ? ' Hidden' : ' Shown'} content sections for ${isEmpty ? 'empty' : 'populated'} project`);
            } catch (error) {
                debugLog(' Error toggling sections: ' + error.message);
            }
        }

        function recreateCharts() {
            debugLog(` Recreating all charts...`);
            document.getElementById('debug-content').innerHTML = 'Recreating charts...';
            
            setTimeout(() => {
                createBubbleChart();
                createDonutChart();
                createRadarChart();
                createBarChart();
                createROIChart();
                updateDashboardMetrics();
                debugLog(` All charts recreation complete`);
            }, 100);
        }

        // Header functionality
        async function switchProject(projectId) {
            debugLog(` Switching to project: ${projectId}`);
            currentProject = projectId;
            currentProjectId = projectId; // Also set currentProjectId for process management
            
            // Load processes for the selected project
            if (projectId) {
                await loadProcesses(projectId);
                renderProcessList();
                debugLog(` Loaded ${processes.length} processes for project: ${projectId}`);
                
                // Log the loaded processes for debugging
                if (processes.length > 0) {
                    console.log(' Loaded processes:', processes);
                    console.log(' Sample process:', {
                        name: processes[0].name,
                        impact: processes[0].impact,
                        feasibility: processes[0].feasibility,
                        timeSpent: processes[0].timeSpent
                    });
                }
            } else {
                processes = []; // Clear processes if no project selected
            }
            
            // Ensure charts are recreated with the new data
            setTimeout(() => {
                recreateCharts();
                updateDashboardMetrics(); // Ensure project name and metrics update
                
                // Always update settings panel data (even if closed) for next time it opens
                updateSystemHealthBar();
                
                // Store current project info for settings panel
                if (typeof updateSystemHealthBar === 'function') {
                    // Force update even if panel is closed
                    console.log(' Forcing settings health bar update after project switch');
                }
                
                debugLog(` Charts recreated with ${processes.length} processes`);
            }, 100);
        }

        // Quadrant interaction function
        // Header Settings Functions (REUSED FROM BACKUP)
        let headerSettingsOpen = false;
        
        function toggleHeaderSettings() {
            if (headerSettingsOpen) {
                closeHeaderSettings();
            } else {
                openHeaderSettings();
            }
        }
        
        function openHeaderSettings() {
            const trigger = document.getElementById('headerSettingsTrigger');
            const panel = document.getElementById('headerSettingsPanel');
            
            if (!trigger || !panel) {
                console.warn('Header settings elements not found');
                return;
            }
            
            // Add loading state
            trigger.classList.add('loading');
            
            // Simulate brief loading for better UX
            setTimeout(() => {
                trigger.classList.remove('loading');
                trigger.classList.add('active');
                trigger.setAttribute('aria-expanded', 'true');
                panel.classList.add('active');
                headerSettingsOpen = true;
                
                // Sync settings with current state
                syncSettingsState();
                
                // Add subtle haptic feedback for mobile
                if (navigator.vibrate) {
                    navigator.vibrate(20);
                }
                
                // Add click outside handler
                setTimeout(() => {
                    document.addEventListener('click', handleHeaderSettingsClickOutside);
                }, 100);
            }, 150);
        }
        
        function closeHeaderSettings() {
            const trigger = document.getElementById('headerSettingsTrigger');
            const panel = document.getElementById('headerSettingsPanel');
            
            if (trigger) {
                trigger.classList.remove('active');
                trigger.setAttribute('aria-expanded', 'false');
            }
            if (panel) panel.classList.remove('active');
            headerSettingsOpen = false;
            
            // Remove click outside handler
            document.removeEventListener('click', handleHeaderSettingsClickOutside);
        }
        
        function handleHeaderSettingsClickOutside(event) {
            const panel = document.getElementById('headerSettingsPanel');
            const trigger = document.getElementById('headerSettingsTrigger');
            if (panel && !panel.contains(event.target) && !trigger.contains(event.target)) {
                closeHeaderSettings();
            }
        }
        
        // Enhanced keyboard navigation for settings button
        function initializeSettingsKeyboardNavigation() {
            const trigger = document.getElementById('headerSettingsTrigger');
            if (!trigger) return;
            
            trigger.addEventListener('keydown', function(event) {
                switch(event.key) {
                    case 'Enter':
                    case ' ': // Spacebar
                        event.preventDefault();
                        toggleHeaderSettings();
                        break;
                    case 'Escape':
                        if (headerSettingsOpen) {
                            event.preventDefault();
                            closeHeaderSettings();
                        }
                        break;
                }
            });
            
            // Enhanced focus management
            trigger.addEventListener('focus', function() {
                // Focus styles are handled by CSS :focus-visible
                if (!headerSettingsOpen) {
                    this.setAttribute('aria-describedby', 'settings-help-text');
                }
            });
            
            trigger.addEventListener('blur', function() {
                this.removeAttribute('aria-describedby');
            });
            
            // Add touch support for mobile devices
            trigger.addEventListener('touchstart', function(e) {
                e.preventDefault(); // Prevent double-tap zoom
                this.style.transform = 'translateY(1px) scale(0.98)';
            });
            
            trigger.addEventListener('touchend', function(e) {
                e.preventDefault();
                this.style.transform = '';
                // Small delay to show touch feedback
                setTimeout(() => {
                    toggleHeaderSettings();
                }, 50);
            });
        }
        
        // Enhanced keyboard handler function
        function handleSettingsKeyDown(event) {
            switch(event.key) {
                case 'Enter':
                case ' ': // Spacebar
                    event.preventDefault();
                    toggleHeaderSettings();
                    break;
                case 'Escape':
                    if (headerSettingsOpen) {
                        event.preventDefault();
                        closeHeaderSettings();
                    }
                    break;
                case 'ArrowDown':
                    if (headerSettingsOpen) {
                        event.preventDefault();
                        // Focus first setting in panel
                        const firstSetting = document.querySelector('#headerSettingsPanel button, #headerSettingsPanel input, #headerSettingsPanel select');
                        if (firstSetting) firstSetting.focus();
                    }
                    break;
            }
        }
        
        // Initialize keyboard navigation when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeSettingsKeyboardNavigation();
            
            // Add settings panel keyboard navigation
            const settingsPanel = document.getElementById('headerSettingsPanel');
            if (settingsPanel) {
                settingsPanel.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape') {
                        event.preventDefault();
                        closeHeaderSettings();
                        document.getElementById('headerSettingsTrigger').focus();
                    }
                });
            }
        });
        
        // Enhanced function to show notification with settings button feedback
        function showSettingsNotification(message, type = 'info') {
            const trigger = document.getElementById('headerSettingsTrigger');
            
            // Add visual feedback to settings button
            if (trigger) {
                trigger.classList.add('loading');
                setTimeout(() => {
                    trigger.classList.remove('loading');
                }, 1000);
            }
            
            // Show the actual notification
            showNotification(message, type);
        }
        
        function syncSettingsState() {
            // Update connection status in settings based on storage mode toggle
            const connectionStatus = document.getElementById('connectionStatus');
            if (connectionStatus) {
                const statusIndicator = connectionStatus.querySelector('.status-indicator');
                const statusText = connectionStatus.querySelector('.status-text');
                
                if (statusIndicator && statusText) {
                    const preferredStorageMode = getPreferredStorageMode();
                    
                    if (preferredStorageMode === 'supabase') {
                        if (window.workshopDB && window.workshopDB.isConnected()) {
                            statusIndicator.className = 'status-indicator online';
                            statusText.textContent = 'Supabase';
                        } else {
                            statusIndicator.className = 'status-indicator offline';
                            statusText.textContent = 'Supabase (Offline)';
                        }
                    } else {
                        statusIndicator.className = 'status-indicator online';
                        statusText.textContent = 'localStorage';
                    }
                }
            }
        }

        function showFabCluster() {
            console.log(' showFabCluster called');
            const existingCluster = document.getElementById('fabCluster');
            if (existingCluster) {
                console.log(' FAB cluster already exists, skipping');
                return; // Already exists
            }
            
            const fabCluster = document.createElement('div');
            fabCluster.id = 'fabCluster';
            fabCluster.className = 'fab-cluster';
            
            // Debug: Make sure it's visible
            console.log(' Creating FAB cluster element...');
            fabCluster.style.cssText = 'position: fixed; bottom: 48px; right: 48px; z-index: 9999; pointer-events: auto;';
            
            fabCluster.innerHTML = `
                <!-- Primary FAB -->
                <button class="fab-primary" onclick="toggleFabMenu()" id="primaryFab">
                    <span id="fabIcon"></span>
                </button>
                
                <!-- Secondary FABs -->
                <div class="fab-secondary-group" id="secondaryFabs">
                    
                    <button class="fab-secondary" onclick="openProjectWorkspace()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        <div class="fab-tooltip">Manage Projects</div>
                    </button>
                    
                    <button class="fab-secondary" onclick="openProcessWorkspace()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m5 0a2 2 0 002-2V7a2 2 0 00-2-2H9m0 0v12m0-12h6m-6 0V3"/>
                        </svg>
                        <div class="fab-tooltip">Add Process</div>
                    </button>
                    
                    <button class="fab-secondary" onclick="openPresentationMode()">
                        <svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5l-1 2v1h8v-1l-1-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H3V5h18v10z"/>
                        </svg>
                        <div class="fab-tooltip">Present Mode</div>
                    </button>
                </div>
            `;
            
            document.body.appendChild(fabCluster);
            console.log(' FAB cluster added to DOM:', fabCluster);
        }

        let fabExpanded = false;
        
        function toggleFabMenu() {
            const cluster = document.getElementById('fabCluster');
            const icon = document.getElementById('fabIcon');
            
            fabExpanded = !fabExpanded;
            
            if (fabExpanded) {
                cluster.classList.add('expanded');
                icon.textContent = '';
            } else {
                cluster.classList.remove('expanded');
                icon.textContent = '';
            }
        }

        // Utility Functions
        function generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        }
        
        async function saveProjects() {
            const preferredStorageMode = getPreferredStorageMode();
            
            if (preferredStorageMode === 'supabase') {
                // For Supabase mode, projects are managed individually through createProject/updateProject/deleteProject
                // We still save to localStorage for local UI consistency
                localStorage.setItem('businessProjects', JSON.stringify(projects));
                console.log(' Projects synced to localStorage for UI consistency');
            } else {
                // Save to localStorage only
                localStorage.setItem('businessProjects', JSON.stringify(projects));
                console.log(' Projects saved to localStorage');
            }
        }
        
        async function loadProcesses(projectId) {
            const preferredStorageMode = getPreferredStorageMode();
            
            if (preferredStorageMode === 'supabase') {
                if (!window.workshopDB || !window.workshopDB.isConnected()) {
                    console.error(' Supabase storage requested but not available. Connection failed.');
                    showNotification('Failed to load: Supabase not connected', 'error');
                    processes = []; // Initialize empty array
                } else {
                    try {
                        // Load from Supabase only
                        processes = await window.workshopDB.getProcesses(projectId) || [];
                        console.log(' Processes loaded from Supabase:', processes.length);
                    } catch (error) {
                        console.error(' Failed to load processes from Supabase:', error);
                        showNotification('Failed to load processes from Supabase', 'error');
                        processes = []; // Initialize empty array on error
                    }
                }
            } else {
                try {
                    // Load from localStorage only
                    const savedProcesses = localStorage.getItem(`processes_${projectId}`);
                    processes = savedProcesses ? JSON.parse(savedProcesses) : [];
                    console.log(' Processes loaded from localStorage:', processes.length);
                } catch (error) {
                    console.error(' Failed to load processes from localStorage:', error);
                    showNotification('Failed to load processes from localStorage', 'error');
                    processes = []; // Initialize empty array on error
                }
            }
            
            renderProcessList();
            recreateCharts();
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize dashboard
        // Project Management Functions
        function openProjectModal() {
            const modal = document.getElementById('projectModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeProjectModal() {
            debugLog(' closeProjectModal called');
            const modal = document.getElementById('projectModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
            
            const form = document.getElementById('projectForm');
            form.reset();
            
            // Reset edit mode
            debugLog(' Clearing editId, was: ' + form.dataset.editId);
            delete form.dataset.editId;
            debugLog(' EditId after clearing: ' + form.dataset.editId);
            
            document.querySelector('#projectModal h2').textContent = 'Create New Project';
            document.querySelector('#projectModal button[type="submit"]').textContent = 'Create Project ';
            debugLog(' Modal reset complete');
        }

        // Process Management Functions
        function updateProcessModalProjectIndicator() {
            const currentProject = projects.find(p => p.id === currentProjectId);
            const projectNameElement = document.getElementById('processModalProjectName');
            
            if (currentProject && projectNameElement) {
                projectNameElement.textContent = currentProject.name;
                debugLog(' Process modal project indicator updated: ' + currentProject.name);
            } else {
                if (projectNameElement) {
                    projectNameElement.textContent = 'No project selected';
                }
                console.warn(' Could not update project indicator - project not found or element missing');
            }
        }
        
        function updateProcessEntryProjectIndicator() {
            const currentProject = projects.find(p => p.id === currentProjectId);
            const projectNameElement = document.getElementById('processEntryProjectName');
            
            if (currentProject && projectNameElement) {
                projectNameElement.textContent = currentProject.name;
                debugLog(' Process entry project indicator updated: ' + currentProject.name);
            } else {
                if (projectNameElement) {
                    projectNameElement.textContent = 'No project selected';
                }
                console.warn(' Could not update process entry project indicator - project not found or element missing');
            }
        }
        
        function addProcess() {
            if (!currentProjectId) {
                alert('Please select a project first');
                return;
            }
            
            // Update project indicator
            updateProcessModalProjectIndicator();
            
            document.getElementById('processModal').classList.remove('hidden');
            
            // Initialize error cost options with default currency
            updateErrorCostOptions('USD');
            
            // Initialize sliders to ensure event listeners work
            initializeSliders();
            
            // Re-apply department selection if in workshop mode
            if (workshopMode && currentDepartment) {
                setTimeout(() => preselectDepartment(currentDepartment), 100);
            }
        }

        function openAddProcessModal() {
            console.log(' Opening Add Process Modal');
            try {
                // Ensure we have the correct modal setup
                document.querySelector('#processModal h2').textContent = 'Add Business Process';
                document.getElementById('submitBtn').innerHTML = 'Add Process ';
                
                // Update project indicator
                updateProcessModalProjectIndicator();
                
                // Show the modal
                document.getElementById('processModal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // Focus on first input
                const firstInput = document.querySelector('#processModal input');
                if (firstInput) {
                    setTimeout(() => firstInput.focus(), 100);
                }
                
                console.log(' Add Process Modal opened successfully');
            } catch (error) {
                console.error(' Error opening Add Process Modal:', error);
            }
        }

        function closeProcessModal() {
            document.getElementById('processModal').classList.add('hidden');
            document.getElementById('processForm').reset();
            document.body.style.overflow = 'auto';
            // Reset step to 1
            currentStep = 1;
            updateStepDisplay();
            // Clear selected template
            window.selectedTemplate = null;
            editingProcessId = null;
            // Reset modal title
            document.querySelector('#processModal h2').textContent = 'Add Business Process';
            document.getElementById('submitBtn').innerHTML = 'Add Process ';
        }

        function updateErrorCostOptions(currency) {
            const costOptions = {
                USD: [
                    { value: 'low', emoji: '', amount: 'Under $100', description: 'Minor cost' },
                    { value: 'medium', emoji: '', amount: '$100-$1,000', description: 'Noticeable impact' },
                    { value: 'high', emoji: '', amount: '$1,000-$10,000', description: 'Significant cost' },
                    { value: 'critical', emoji: '', amount: '$10,000+', description: 'Major financial impact' }
                ],
                INR: [
                    { value: 'low', emoji: '', amount: 'Under 8,000', description: 'Minor cost' },
                    { value: 'medium', emoji: '', amount: '8,000-80,000', description: 'Noticeable impact' },
                    { value: 'high', emoji: '', amount: '80,000-8,00,000', description: 'Significant cost' },
                    { value: 'critical', emoji: '', amount: '8,00,000+', description: 'Major financial impact' }
                ]
            };
            const container = document.getElementById('errorCostOptions');
            const options = costOptions[currency] || costOptions.USD;
            
            container.innerHTML = options.map(option => `
                <label class="cost-option cursor-pointer">
                    <input type="radio" name="errorCost" value="${option.value}" class="sr-only">
                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                        <div class="text-2xl mb-2">${option.emoji}</div>
                        <div class="font-medium">${option.amount}</div>
                        <div class="text-xs text-gray-500">${option.description}</div>
                    </div>
                </label>
            `).join('');
        }

        function initializeSliders() {
            const sliders = ['timeSpent', 'repetitive', 'dataDriven', 'ruleBased', 'highVolume', 'impact', 'feasibility'];
            
            sliders.forEach(sliderId => {
                const slider = document.getElementById(sliderId);
                const valueDisplay = document.getElementById(sliderId + 'Value');
                
                if (slider && valueDisplay) {
                    slider.addEventListener('input', function() {
                        if (sliderId === 'timeSpent') {
                            updateTimeDisplay();
                        } else {
                            valueDisplay.textContent = this.value;
                        }
                    });
                    
                    // Initialize time slider on first load
                    if (sliderId === 'timeSpent') {
                        updateTimeDisplay();
                        updateSliderFill();
                    }
                }
            });
        }

        function preselectDepartment(dept) {
            const deptName = departmentNames[dept.toLowerCase()];
            const select = document.getElementById('processDepartment');
            
            // Find the matching option value
            let optionValue = '';
            for (let i = 0; i < select.options.length; i++) {
                const option = select.options[i];
                if (option.textContent.includes(deptName)) {
                    optionValue = option.value;
                    break;
                }
            }
            
            if (optionValue) {
                select.value = optionValue;
                // Disable the select to lock the department
                select.disabled = true;
                select.style.backgroundColor = '#f3f4f6';
                select.style.cursor = 'not-allowed';
            }
        }

        function fillTemplate(templateType) {
            const templates = {
                invoicing: {
                    name: "Processing Invoices",
                    department: "Finance",
                    frequency: "weekly",
                    infoSources: ["spreadsheets", "documents"],
                    consistency: "similar",
                    volume: "medium",
                    impact: "significant",
                    feasibility: "moderate"
                },
                scheduling: {
                    name: "Staff Scheduling", 
                    department: "Operations",
                    frequency: "weekly",
                    infoSources: ["spreadsheets"],
                    consistency: "similar", 
                    volume: "medium",
                    impact: "significant",
                    feasibility: "easy"
                },
                orders: {
                    name: "Processing Customer Orders",
                    department: "Sales",
                    frequency: "daily",
                    infoSources: ["spreadsheets", "documents"],
                    consistency: "exact",
                    volume: "high",
                    impact: "critical",
                    feasibility: "moderate"
                },
                payroll: {
                    name: "Monthly Payroll Processing",
                    department: "HR",
                    frequency: "monthly",
                    infoSources: ["spreadsheets"],
                    consistency: "exact",
                    volume: "medium",
                    impact: "critical", 
                    feasibility: "complex"
                },
                inventory: {
                    name: "Inventory Management",
                    department: "Operations", 
                    frequency: "daily",
                    infoSources: ["spreadsheets"],
                    consistency: "similar",
                    volume: "high",
                    impact: "significant",
                    feasibility: "moderate"
                },
                customer: {
                    name: "Customer Support Tickets",
                    department: "Customer Service",
                    frequency: "daily", 
                    infoSources: ["documents", "communication"],
                    consistency: "different",
                    volume: "high",
                    impact: "significant",
                    feasibility: "complex"
                }
            };
            const template = templates[templateType];
            if (template) {
                // Fill basic info
                document.getElementById('processName').value = template.name;
                document.getElementById('processDepartment').value = template.department;
                
                // Pre-select options for step 2 (will be used when user reaches that step)
                window.selectedTemplate = template;
                
                // Visual feedback
                document.querySelector('.template-btn').style.backgroundColor = '#eff6ff';
                setTimeout(() => {
                    document.querySelectorAll('.template-btn').forEach(btn => {
                        btn.style.backgroundColor = 'white';
                    });
                }, 1000);
            }
        }

        function nextStep() {
            if (currentStep < 3) {
                // Validate current step
                if (validateCurrentStep()) {
                    // Store current scroll position relative to modal
                    const modal = document.getElementById('processModal');
                    const modalContent = modal.querySelector('.bg-white');
                    const currentScrollTop = modalContent.scrollTop;
                    
                    currentStep++;
                    updateStepDisplay();
                    
                    // Auto-fill template selections when entering step 2
                    if (currentStep === 2 && window.selectedTemplate) {
                        autoFillTemplateStep2(window.selectedTemplate);
                    }
                    
                    // Auto-fill template selections when entering step 3
                    if (currentStep === 3 && window.selectedTemplate) {
                        autoFillTemplateStep3(window.selectedTemplate);
                    }
                    
                    // Scroll to step header within modal
                    setTimeout(() => {
                        const stepContent = document.getElementById(`step${currentStep}`);
                        if (stepContent) {
                            stepContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 100);
                }
            }
        }

        function autoFillTemplateStep2(template) {
            // Select frequency
            const frequencyInput = document.querySelector(`input[name="frequency"][value="${template.frequency}"]`);
            if (frequencyInput) frequencyInput.checked = true;
            
            // Select info sources
            template.infoSources.forEach(source => {
                const infoInput = document.querySelector(`input[name="infoSource"][value="${source}"]`);
                if (infoInput) infoInput.checked = true;
            });
            
            // Select consistency
            const consistencyInput = document.querySelector(`input[name="consistency"][value="${template.consistency}"]`);
            if (consistencyInput) consistencyInput.checked = true;
            
            // Select volume
            const volumeInput = document.querySelector(`input[name="volume"][value="${template.volume}"]`);
            if (volumeInput) volumeInput.checked = true;
        }

        function autoFillTemplateStep3(template) {
            // Select impact
            const impactInput = document.querySelector(`input[name="impact"][value="${template.impact}"]`);
            if (impactInput) impactInput.checked = true;
            
            // Select feasibility
            const feasibilityInput = document.querySelector(`input[name="feasibility"][value="${template.feasibility}"]`);
            if (feasibilityInput) feasibilityInput.checked = true;
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(step => step.classList.add('hidden'));
            
            // Show current step
            document.getElementById(`step${currentStep}`).classList.remove('hidden');
            
            // Update step indicators
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                if (index + 1 <= currentStep) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.classList.toggle('hidden', currentStep === 1);
            nextBtn.classList.toggle('hidden', currentStep === 3);
            submitBtn.classList.toggle('hidden', currentStep !== 3);
        }

        function validateCurrentStep() {
            clearAllErrors();
            let isValid = true;
            
            switch(currentStep) {
                case 1:
                    if (document.getElementById('processName').value.trim() === '') {
                        showError('processName', 'Please enter a name for this process');
                        isValid = false;
                    }
                    const dept = document.getElementById('processDepartment').value;
                    if (dept === '') {
                        showError('processDepartment', 'Please select a department or team');
                        isValid = false;
                    } else if (dept === 'Custom' && document.getElementById('customDepartment').value.trim() === '') {
                        showError('processDepartment', 'Please specify the department name');
                        isValid = false;
                    }
                    break;
                case 2:
                    if (!document.querySelector('input[name="frequency"]:checked')) {
                        showError('frequency', 'Please select how often you do this process');
                        isValid = false;
                    }
                    if (!document.querySelector('input[name="consistency"]:checked')) {
                        showError('consistency', 'Please select how consistent this process is');
                        isValid = false;
                    }
                    if (!document.querySelector('input[name="volume"]:checked')) {
                        showError('volume', 'Please select the work volume');
                        isValid = false;
                    }
                    if (document.querySelectorAll('input[name="infoSource"]:checked').length === 0) {
                        showError('infoSource', 'Please select at least one information source');
                        isValid = false;
                    }
                    break;
                case 3:
                    if (!document.querySelector('input[name="impact"]:checked')) {
                        showError('impact', 'Please select the business impact');
                        isValid = false;
                    }
                    if (!document.querySelector('input[name="feasibility"]:checked')) {
                        showError('feasibility', 'Please select implementation difficulty');
                        isValid = false;
                    }
                    break;
                default:
                    return true;
            }
            return isValid;
        }

        function showError(fieldId, message) {
            const errorDiv = document.getElementById(fieldId + '-error');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
            }
            const field = document.getElementById(fieldId);
            if (field) {
                field.classList.add('field-error');
            }
        }

        function clearAllErrors() {
            document.querySelectorAll('.validation-error').forEach(error => {
                error.classList.add('hidden');
            });
            document.querySelectorAll('.field-error').forEach(field => {
                field.classList.remove('field-error');
            });
        }

        function toggleCustomDepartment() {
            const select = document.getElementById('processDepartment');
            const customInput = document.getElementById('customDepartment');
            if (select.value === 'Custom') {
                customInput.classList.remove('hidden');
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.value = '';
            }
        }

        function toggleOtherInfo() {
            const checkbox = document.querySelector('input[name="infoSource"][value="other"]');
            const input = document.getElementById('otherInfoSource');
            const placeholder = document.getElementById('otherInfoPlaceholder');
            
            if (checkbox.checked) {
                input.classList.remove('hidden');
                placeholder.classList.add('hidden');
                input.focus();
            } else {
                input.classList.add('hidden');
                placeholder.classList.remove('hidden');
                input.value = '';
            }
        }

        function updateTimeUnit() {
            const isDaily = document.querySelector('input[name="timeUnit"][value="daily"]').checked;
            const timeSlider = document.getElementById('timeSpent');
            const timeMin = document.getElementById('timeMin');
            const timeMax = document.getElementById('timeMax');
            
            if (isDaily) {
                // Switch to daily mode
                timeSlider.min = 1;
                timeSlider.max = 8;
                if (parseInt(timeSlider.value) > 8) {
                    timeSlider.value = 8;
                }
                timeMin.textContent = '1 hour';
                timeMax.textContent = '8+ hours';
            } else {
                // Switch to weekly mode
                timeSlider.min = 1;
                timeSlider.max = 40;
                if (parseInt(timeSlider.value) > 40) {
                    timeSlider.value = 40;
                }
                timeMin.textContent = '1 hour';
                timeMax.textContent = '40+ hours';
            }
            
            // Update display and slider fill
            updateTimeDisplay();
            updateSliderFill();
        }

        function updateSliderFill() {
            const slider = document.getElementById('timeSpent');
            const min = parseInt(slider.min);
            const max = parseInt(slider.max);
            const value = parseInt(slider.value);
            
            // Calculate percentage
            const percentage = ((value - min) / (max - min)) * 100;
            
            // Update CSS custom property for gradient
            slider.style.setProperty('--slider-progress', `${percentage}%`);
        }
        
        function updateSliderValue(fieldId, value) {
            // Update the hidden field value for form fields like repetitive, dataDriven, etc.
            const field = document.getElementById(fieldId);
            if (field) {
                field.value = value;
            }
            
            // If there are any display elements that show these values, update them too
            const displayElement = document.getElementById(fieldId + 'Value');
            if (displayElement) {
                displayElement.textContent = value;
            }
        }

        function updateErrorCostCurrency(currency) {
            updateErrorCostOptions(currency);
        }

        function calculateScores() {
            // Calculate repetitive score based on frequency
            const frequency = document.querySelector('input[name="frequency"]:checked')?.value;
            let repetitiveScore = 5;
            switch(frequency) {
                case 'daily': repetitiveScore = 9; break;
                case 'weekly': repetitiveScore = 7; break;
                case 'monthly': repetitiveScore = 5; break;
                case 'rarely': repetitiveScore = 2; break;
            }
            
            // Calculate data-driven score based on info sources
            const infoSources = Array.from(document.querySelectorAll('input[name="infoSource"]:checked')).map(cb => cb.value);
            let dataDrivenScore = 1;
            if (infoSources.includes('spreadsheets')) dataDrivenScore = 9;
            else if (infoSources.includes('documents')) dataDrivenScore = 6;
            else if (infoSources.includes('communication')) dataDrivenScore = 3;
            else if (infoSources.includes('experience')) dataDrivenScore = 1;
            
            // Calculate rule-based score based on consistency
            const consistency = document.querySelector('input[name="consistency"]:checked')?.value;
            let ruleBasedScore = 5;
            switch(consistency) {
                case 'exact': ruleBasedScore = 10; break;
                case 'similar': ruleBasedScore = 7; break;
                case 'different': ruleBasedScore = 4; break;
                case 'creative': ruleBasedScore = 1; break;
            }
            
            // Calculate volume score
            const volume = document.querySelector('input[name="volume"]:checked')?.value;
            let volumeScore = 5;
            switch(volume) {
                case 'low': volumeScore = 2; break;
                case 'medium': volumeScore = 5; break;
                case 'high': volumeScore = 8; break;
                case 'massive': volumeScore = 10; break;
            }
            
            // Calculate impact score
            const impact = document.querySelector('input[name="impact"]:checked')?.value;
            let impactScore = 5;
            switch(impact) {
                case 'critical': impactScore = 10; break;
                case 'significant': impactScore = 8; break;
                case 'moderate': impactScore = 5; break;
                case 'low': impactScore = 2; break;
            }
            
            // Calculate feasibility score
            const feasibility = document.querySelector('input[name="feasibility"]:checked')?.value;
            let feasibilityScore = 5;
            switch(feasibility) {
                case 'easy': feasibilityScore = 9; break;
                case 'moderate': feasibilityScore = 7; break;
                case 'complex': feasibilityScore = 4; break;
                case 'difficult': feasibilityScore = 2; break;
            }
            
            return {
                repetitive: repetitiveScore,
                dataDriven: dataDrivenScore,
                ruleBased: ruleBasedScore,
                highVolume: volumeScore,
                impact: impactScore,
                feasibility: feasibilityScore
            };
        }

        function updateTimeDisplay() {
            const isDaily = document.querySelector('input[name="timeUnit"][value="daily"]')?.checked ?? true;
            const timeSpent = parseInt(document.getElementById('timeSpent').value);
            const timeValue = document.getElementById('timeSpentValue');
            const conversion = document.getElementById('timeConversion');
            const convertedTime = document.getElementById('convertedTime');
            
            if (isDaily) {
                timeValue.textContent = `${timeSpent} hour${timeSpent > 1 ? 's' : ''} per day`;
                if (convertedTime) {
                    convertedTime.textContent = (timeSpent * 5).toFixed(1) + ' hours per week';
                }
            } else {
                timeValue.textContent = `${timeSpent} hour${timeSpent > 1 ? 's' : ''} per week`;
                if (convertedTime) {
                    convertedTime.textContent = (timeSpent / 5).toFixed(1) + ' hours per day';
                }
            }
            
            // Always show conversion
            if (conversion) {
                conversion.classList.remove('hidden');
            }
            
            // Update slider fill
            updateSliderFill();
        }

        function updateScore(slider) {
            // Optional: Add visual feedback for score updates
            console.log(`Updated ${slider.id} to ${slider.value}`);
        }

        // Wait for DOM to be ready before adding event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add process form handler
            const processForm = document.getElementById('processForm');
            if (processForm) {
                processForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const scores = calculateScores();
                    const department = document.getElementById('processDepartment').value;
                    const finalDepartment = department === 'Custom' ? document.getElementById('customDepartment').value : department;
                    
                    const processData = {
                        name: document.getElementById('processName').value,
                        department: finalDepartment,
                        customDepartment: department === 'Custom' ? document.getElementById('customDepartment').value : null,
                        timeSpent: parseInt(document.getElementById('timeSpent').value),
                        scores: {
                            repetitive: scores.repetitive,
                            dataDriven: scores.dataDriven,
                            ruleBased: scores.ruleBased,
                            highVolume: scores.highVolume
                        },
                        impact: scores.impact,
                        feasibility: scores.feasibility,
                        notes: document.getElementById('processNotes')?.value || '',
                        updatedAt: new Date().toISOString()
                    };

                    if (editingProcessId) {
                        // Update existing process
                        const processIndex = processes.findIndex(p => p.id === editingProcessId);
                        if (processIndex !== -1) {
                            processes[processIndex] = {
                                ...processes[processIndex],
                                ...processData,
                                id: editingProcessId
                            };
                            
                            // Save and show appropriate notification
                            const saveSuccess = await saveProcesses();
                            const preferredStorageMode = getPreferredStorageMode();
                            if (saveSuccess !== false) {
                                if (preferredStorageMode === 'supabase') {
                                    showNotification(' Process updated and saved to cloud database!', 'success');
                                } else {
                                    showNotification(' Process updated and saved locally!', 'success');
                                }
                            }
                        }
                        editingProcessId = null;
                    } else {
                        // Create new process
                        const newProcess = {
                            id: generateId(),
                            ...processData,
                            projectId: currentProjectId,
                            createdAt: new Date().toISOString()
                        };
                        
                        const preferredStorageMode = getPreferredStorageMode();
                        
                        if (preferredStorageMode === 'supabase') {
                            if (window.workshopDB && window.workshopDB.isConnected()) {
                                try {
                                    // Submit to Supabase first
                                    const supabaseProcess = await window.workshopDB.submitProcess({
                                        projectId: currentProjectId,
                                        department: newProcess.department,
                                        name: newProcess.name,
                                        customDepartment: newProcess.customDepartment,
                                        timeSpent: newProcess.timeSpent,
                                        scores: newProcess.scores,
                                        impact: newProcess.impact,
                                        feasibility: newProcess.feasibility,
                                        notes: newProcess.notes,
                                        token: 'dashboard-created'
                                    });
                                    
                                    // Add Supabase process to local array
                                    processes.push(supabaseProcess);
                                    console.log(' Process added to Supabase:', supabaseProcess.id);
                                    showNotification(' Process added and saved to cloud database!', 'success');
                                    
                                    // Trigger auto-refresh callback for Supabase process
                                    await onProcessCreated(supabaseProcess);
                                } catch (error) {
                                    console.error(' Failed to save process to Supabase:', error);
                                    showNotification('Failed to save process to Supabase', 'error');
                                    return;
                                }
                            } else {
                                console.error(' Supabase storage requested but not connected');
                                showNotification('Failed to save: Supabase not connected', 'error');
                                return;
                            }
                        } else {
                            // Add to local array and save to localStorage
                            processes.push(newProcess);
                            await saveProcesses();
                            showNotification(' Process added and saved locally!', 'success');
                        }
                        
                        // Trigger auto-refresh callback for new process
                        await onProcessCreated(newProcess);
                    }
                    
                    // Close modal (charts and workspace refresh handled by callback)
                    closeProcessModal();
                });
            }
            
            // Project form handler
            const projectForm = document.getElementById('projectForm');
            if (projectForm) {
                projectForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const projectName = document.getElementById('projectName').value;
                    const clientName = document.getElementById('clientName').value;
                    const editId = form.dataset.editId;
                    
                    if (editId) {
                        // Update existing project using storage mode toggle
                        const preferredStorageMode = getPreferredStorageMode();
                        
                        try {
                            if (preferredStorageMode === 'supabase') {
                                if (window.workshopDB && window.workshopDB.isConnected()) {
                                    // Update in Supabase
                                    const updates = {
                                        name: projectName,
                                        clientName: clientName,
                                        description: clientName
                                    };
                                    
                                    debugLog(' Updating project in Supabase: ' + editId + ' with updates: ' + JSON.stringify(updates));
                                    const updatedProject = await window.workshopDB.updateProject(editId, updates);
                                    debugLog(' Supabase response: ' + JSON.stringify(updatedProject));
                                    
                                    // Update local array with Supabase response
                                    const projectIndex = projects.findIndex(p => p.id === editId);
                                    if (projectIndex !== -1) {
                                        projects[projectIndex].name = updatedProject.name;
                                        projects[projectIndex].clientName = updatedProject.metadata?.clientName || updatedProject.description || clientName;
                                        projects[projectIndex].createdAt = updatedProject.created_at;
                                        projects[projectIndex].updatedAt = new Date().toISOString();
                                        projects[projectIndex].storageType = 'supabase';
                                        projects[projectIndex].supabaseData = updatedProject;
                                        debugLog(' Local array updated: ' + JSON.stringify(projects[projectIndex]));
                                    }
                                    
                                    console.log(' Project updated in Supabase:', editId);
                                } else {
                                    console.error(' Supabase storage requested but not connected for project update');
                                    showNotification('Failed to update: Supabase not connected', 'error');
                                    return;
                                }
                            } else {
                                // Update in localStorage
                                const projectIndex = projects.findIndex(p => p.id === editId);
                                if (projectIndex !== -1) {
                                    projects[projectIndex].name = projectName;
                                    projects[projectIndex].clientName = clientName;
                                    projects[projectIndex].updatedAt = new Date().toISOString();
                                }
                                await saveProjects();
                                console.log(' Project updated in localStorage:', editId);
                            }
                            
                            showNotification('Project updated successfully', 'success');
                            renderProjectList();
                            closeProjectModal();
                            debugLog(' Project edit completed, modal should be closed');
                        } catch (error) {
                            console.error(' Project update failed:', error);
                            showNotification('Failed to update project', 'error');
                        }
                    } else {
                        // Create new project using backend
                        const projectData = {
                            name: projectName,
                            description: clientName, // Using clientName as description
                            workshopDate: new Date().toISOString(),
                            facilitatorEmail: 'admin@example.com', // Default email
                            metadata: { clientName: clientName }
                        };
                        
                        createProjectWithBackend(projectData).then(newProject => {
                            if (newProject) {
                                // Add to local projects array for immediate UI update
                                const localProject = {
                                    id: newProject.id,
                                    name: newProject.name,
                                    clientName: clientName,
                                    createdAt: newProject.created_at || new Date().toISOString(),
                                    storageType: newProject.storageType || 'localStorage'
                                };
                                projects.push(localProject);
                                saveProjects();
                                renderProjectList();
                                
                                // Trigger auto-refresh callback
                                onProjectCreated({
                                    ...newProject,
                                    clientName: clientName
                                });
                            }
                            closeProjectModal();
                        }).catch(error => {
                            console.error('Project creation failed:', error);
                            showNotification('Project creation failed', 'error');
                            closeProjectModal();
                        });
                    }
                });
            }
        });
        
        function renderProjectList() {
            // Update header project selector
            updateProjectDropdowns();
            
            // Update project workspace if it's currently shown
            updateProjectWorkspaceIfVisible();
            
            console.log(' Project list updated - projects:', projects.length);
        }
        
        function updateProjectDropdowns() {
            // Update header selector
            const headerSelector = document.getElementById('headerProjectSelector');
            if (headerSelector) {
                const currentValue = headerSelector.value;
                headerSelector.innerHTML = '<option value="">Select Project...</option>';
                projects.forEach((project, index) => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = project.name;
                    // Select current project or default to first project
                    if (project.id === currentValue || (project.id === currentProjectId && !currentValue) || (!currentProjectId && index === 0)) {
                        option.selected = true;
                        currentProjectId = project.id; // Ensure currentProjectId is set
                    }
                    headerSelector.appendChild(option);
                });
                
                // If no project was selected but projects exist, select the first one
                if (!currentProjectId && projects.length > 0) {
                    currentProjectId = projects[0].id;
                    headerSelector.value = currentProjectId;
                    console.log(' Auto-selected first project:', currentProjectId);
                }
            }
            
            // Update any project selectors in settings
            const projectSelector = document.getElementById('projectSelector');
            if (projectSelector) {
                const currentValue = projectSelector.value;
                projectSelector.innerHTML = '<option value="">Select Project...</option>';
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = project.name;
                    if (project.id === currentValue) option.selected = true;
                    projectSelector.appendChild(option);
                });
            }
        }
        
        function updateProjectWorkspaceIfVisible() {
            // Check if project workspace is currently visible
            const workspaceContainer = document.getElementById('contextualWorkspace');
            if (workspaceContainer && workspaceContainer.classList.contains('active')) {
                // Check if it's the project workspace by looking for project overview content
                const content = workspaceContainer.querySelector('.workspace-body');
                if (content && content.innerHTML.includes('Project Overview')) {
                    refreshProjectOverviewModal();
                }
            }
        }

        // Auto-refresh functionality for Project Overview modal
        async function refreshProjectOverviewModal() {
            console.log(' Refreshing Project Overview modal...');
            
            // Reload projects from storage to ensure we have the latest data
            await loadAllProjects();
            
            // Re-render modal content
            renderProjectOverviewContent();
            
            // Highlight newly added project if we have a reference
            if (window.latestProjectId) {
                setTimeout(() => {
                    highlightProject(window.latestProjectId);
                    window.latestProjectId = null; // Clear after highlighting
                }, 300);
            }
        }

        function renderProjectOverviewContent() {
            const workspaceContainer = document.getElementById('contextualWorkspace');
            if (!workspaceContainer || !workspaceContainer.classList.contains('active')) {
                return; // Modal not open
            }
            
            const workspaceBody = workspaceContainer.querySelector('.workspace-body');
            if (workspaceBody) {
                // Re-render the entire project workspace content
                workspaceBody.innerHTML = createProjectWorkspace();
                console.log(' Project Overview modal content refreshed');
            }
        }

        function isProjectOverviewModalOpen() {
            const workspaceContainer = document.getElementById('contextualWorkspace');
            if (!workspaceContainer || !workspaceContainer.classList.contains('active')) {
                return false;
            }
            
            const content = workspaceContainer.querySelector('.workspace-body');
            return content && content.innerHTML.includes('Project Overview');
        }

        function highlightProject(projectId) {
            if (!projectId) return;
            
            // Find the project card and highlight it
            const projectCards = document.querySelectorAll('#workspaceProjectList .admin-control-card');
            projectCards.forEach(card => {
                const cardOnClick = card.getAttribute('onclick');
                if (cardOnClick && cardOnClick.includes(projectId)) {
                    // Add highlight animation
                    card.style.transition = 'all 0.3s ease';
                    card.style.transform = 'scale(1.02)';
                    card.style.boxShadow = '0 8px 25px rgba(59, 130, 246, 0.3)';
                    card.style.borderColor = '#3B82F6';
                    
                    // Remove highlight after animation
                    setTimeout(() => {
                        card.style.transform = '';
                        card.style.boxShadow = '';
                        card.style.borderColor = '';
                    }, 2000);
                }
            });
        }

        async function refreshProjectDropdown() {
            console.log(' Refreshing project dropdown...');
            updateProjectDropdowns();
        }

        async function loadAllProjects() {
            const preferredStorageMode = getPreferredStorageMode();
            
            if (preferredStorageMode === 'supabase') {
                // For Supabase mode, load projects from the backend
                if (window.workshopDB && window.workshopDB.isConnected()) {
                    try {
                        const supabaseProjects = await window.workshopDB.getAllProjects();
                        if (supabaseProjects && supabaseProjects.length > 0) {
                            projects = supabaseProjects.map(project => ({
                                id: project.id,
                                name: project.name,
                                clientName: project.description || project.metadata?.clientName || '',
                                createdAt: project.created_at,
                                storageType: 'supabase'
                            }));
                            console.log(' Projects loaded from Supabase:', projects.length);
                        }
                    } catch (error) {
                        console.error(' Failed to load projects from Supabase:', error);
                        // Fallback to localStorage
                        const savedProjects = localStorage.getItem('businessProjects');
                        if (savedProjects) {
                            projects = JSON.parse(savedProjects);
                        }
                    }
                } else {
                    console.warn(' Supabase requested but not connected, using localStorage');
                    const savedProjects = localStorage.getItem('businessProjects');
                    if (savedProjects) {
                        projects = JSON.parse(savedProjects);
                    }
                }
                
                // Always sync to localStorage for UI consistency
                localStorage.setItem('businessProjects', JSON.stringify(projects));
                console.log(' Projects synced to localStorage for UI consistency');
            } else {
                // Load from localStorage
                const savedProjects = localStorage.getItem('businessProjects');
                if (savedProjects) {
                    try {
                        projects = JSON.parse(savedProjects);
                        console.log(' Projects loaded from localStorage:', projects.length);
                    } catch (error) {
                        console.error(' Failed to parse saved projects:', error);
                        projects = [];
                    }
                } else {
                    projects = [];
                }
            }
            
            return projects;
        }

        async function onProjectCreated(newProject) {
            console.log(' Project created callback triggered:', newProject);
            
            try {
                // 1. Store reference to latest project for highlighting
                window.latestProjectId = newProject.id;
                
                // 2. Update local projects array (if not already done)
                const existingProject = projects.find(p => p.id === newProject.id);
                if (!existingProject) {
                    const localProject = {
                        id: newProject.id,
                        name: newProject.name,
                        clientName: newProject.clientName || newProject.description || '',
                        createdAt: newProject.created_at || newProject.createdAt || new Date().toISOString(),
                        storageType: newProject.storageType || 'localStorage'
                    };
                    projects.push(localProject);
                    saveProjects();
                }
                
                // 3. Refresh Project Overview modal (if open)
                if (isProjectOverviewModalOpen()) {
                    await refreshProjectOverviewModal();
                }
                
                // 4. Refresh main dashboard dropdown
                await refreshProjectDropdown();
                
                // 5. Show enhanced success notification
                showNotification(` Project "${newProject.name}" created successfully`, 'success');
                
                // 6. Optionally auto-select the new project
                await switchProject(newProject.id);
                
                console.log(' Project creation workflow completed');
            } catch (error) {
                console.error(' Error in project creation callback:', error);
                showNotification('Project created but refresh failed', 'warning');
            }
        }

        // Process Auto-Refresh Functions
        async function onProcessCreated(newProcess) {
            console.log(' Process created callback triggered:', newProcess);
            
            try {
                // 1. Update dashboard metrics immediately
                updateDashboardMetrics();
                
                // 2. Refresh process workspace list if open
                if (currentWorkspace === 'process') {
                    refreshProcessWorkspaceList();
                }
                
                // 3. Recreate all charts with new data
                recreateCharts();
                
                // 4. Show success notification
                showNotification(` Process "${newProcess.name}" created successfully`, 'success');
                
                console.log(' Process creation workflow completed');
            } catch (error) {
                console.error(' Error in process creation callback:', error);
                showNotification('Process created but refresh failed', 'warning');
            }
        }

        async function refreshProcessList() {
            console.log(' Refreshing process list...');
            
            try {
                // Reload processes for current project
                if (currentProjectId) {
                    await loadProcesses(currentProjectId);
                    
                    // Update all process-related UI
                    refreshProcessWorkspaceList();
                    updateDashboardMetrics();
                    recreateCharts();
                    
                    console.log(` Process list refreshed: ${processes.length} processes loaded`);
                }
            } catch (error) {
                console.error(' Error refreshing process list:', error);
                showNotification('Failed to refresh process list', 'error');
            }
        }

        async function refreshDashboardMetrics() {
            console.log(' Refreshing dashboard metrics...');
            updateDashboardMetrics();
        }

        async function updateProcessMetrics() {
            console.log(' Updating process metrics...');
            updateDashboardMetrics();
            recreateCharts();
        }
        
        async function selectProject(projectId) {
            currentProjectId = projectId;
            const project = projects.find(p => p.id === projectId);
            if (project) {
                // Update header project selector
                const headerSelector = document.getElementById('headerProjectSelector');
                if (headerSelector) {
                    headerSelector.value = projectId;
                }
                
                await loadProcesses(projectId);
                renderProjectList(); // Re-render to show selection
                updateDashboard();
                
                // Close workspace after selection
                closeWorkspace();
                showNotification(`Switched to project: ${project.name}`, 'success');
            }
        }
        
        function editProject(projectId) {
            debugLog(' editProject called with projectId: ' + projectId);
            
            // Force close any existing modal state first
            const modal = document.getElementById('projectModal');
            console.log(' Modal state before edit - hidden class:', modal.classList.contains('hidden'), 'display:', modal.style.display);
            
            const project = projects.find(p => p.id === projectId);
            if (!project) {
                console.error(' Project not found:', projectId);
                return;
            }
            
            console.log(' Found project:', project);
            
            // Ensure modal is completely reset before opening
            const form = document.getElementById('projectForm');
            form.reset();
            delete form.dataset.editId;
            
            // Fill form with existing data
            document.getElementById('projectName').value = project.name;
            document.getElementById('clientName').value = project.clientName;
            
            // Update form to edit mode
            form.dataset.editId = projectId;
            console.log(' Form editId set to:', form.dataset.editId);
            
            // Update modal title and button
            document.querySelector('#projectModal h2').textContent = 'Edit Project';
            document.querySelector('#projectModal button[type="submit"]').textContent = 'Save Changes';
            
            // Show modal with explicit style setting
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            document.body.style.overflow = 'hidden';
            
            console.log(' Modal state after edit - hidden class:', modal.classList.contains('hidden'), 'display:', modal.style.display);
            console.log(' Modal should now be visible');
        }
        
        async function deleteProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            if (confirm(`Are you sure you want to delete "${project.name}"? This will also delete all associated processes.`)) {
                const preferredStorageMode = getPreferredStorageMode();
                
                try {
                    // Delete from Supabase if using Supabase mode
                    if (preferredStorageMode === 'supabase') {
                        if (window.workshopDB && window.workshopDB.isConnected()) {
                            // Delete processes first
                            const processes = await window.workshopDB.getProcesses(projectId);
                            for (const process of processes) {
                                await window.workshopDB.deleteProcess(process.id);
                            }
                            
                            // Delete department tokens
                            await window.workshopDB.deleteDepartmentTokens(projectId);
                            
                            // Delete project
                            await window.workshopDB.deleteProject(projectId);
                            
                            console.log(' Project deleted from Supabase:', projectId);
                        } else {
                            console.error(' Supabase deletion requested but not connected');
                            showNotification('Failed to delete: Supabase not connected', 'error');
                            return;
                        }
                    }
                    
                    // Remove from local array
                    projects = projects.filter(p => p.id !== projectId);
                    await saveProjects();
                    
                    // Remove associated processes from localStorage (cleanup)
                    localStorage.removeItem(`processes_${projectId}`);
                    
                    // Clear current selection if deleted
                    if (currentProjectId === projectId) {
                        currentProjectId = null;
                        processes = [];
                        document.getElementById('currentProject').textContent = 'Select Project ';
                        updateDashboard();
                    }
                    
                    renderProjectList();
                    showNotification('Project deleted successfully', 'success');
                } catch (error) {
                    console.error(' Project deletion failed:', error);
                    showNotification('Failed to delete project', 'error');
                }
            }
        }
        
        async function createProjectWithBackend(projectData) {
            const preferredStorageMode = getPreferredStorageMode();
            
            if (preferredStorageMode === 'supabase') {
                if (!window.workshopDB || !window.workshopDB.isConnected()) {
                    console.error(' Supabase storage requested but not available for project creation.');
                    showNotification('Failed to create project: Supabase not connected', 'error');
                    throw new Error('Supabase not available');
                }
                
                try {
                    const newProject = await window.workshopDB.createProject(projectData);
                    
                    // Mark as Supabase project
                    newProject.storageType = 'supabase';
                    
                    // Generate department tokens
                    const departments = ['Finance', 'Operations', 'HR', 'IT', 'Marketing', 'Sales'];
                    await window.workshopDB.generateDepartmentTokens(newProject.id, departments);
                    
                    console.log(' Project created with Supabase:', newProject.id);
                    return newProject;
                } catch (error) {
                    console.error(' Supabase project creation failed:', error);
                    showNotification('Failed to create project in Supabase', 'error');
                    throw error;
                }
            } else {
                try {
                    // Create localStorage project only
                    const localProject = {
                        id: generateId(),
                        name: projectData.name,
                        clientName: projectData.description,
                        storageType: 'localStorage',
                        createdAt: new Date().toISOString()
                    };
                    console.log(' Project created in localStorage:', localProject.id);
                    return localProject;
                } catch (error) {
                    console.error(' localStorage project creation failed:', error);
                    showNotification('Failed to create project in localStorage', 'error');
                    throw error;
                }
            }
        }
        

        // Process Management Functions
        function renderProcessList() {
            const processList = document.getElementById('processList');
            if (!processList) {
                console.log('processList element not found, skipping render');
                return;
            }
            
            // Filter processes by department if in workshop mode or if filter is applied
            let filteredProcesses = processes;
            if (currentDepartmentFilter && currentDepartmentFilter !== 'all') {
                filteredProcesses = processes.filter(process => 
                    process.department === currentDepartmentFilter
                );
            }
            
            if (filteredProcesses.length === 0) {
                const message = currentDepartmentFilter && currentDepartmentFilter !== 'all' 
                    ? `No processes found for ${currentDepartmentFilter}` 
                    : 'No processes added yet';
                processList.innerHTML = `<div class="text-white/60 text-center py-4">${message}</div>`;
                return;
            }
            
            processList.innerHTML = filteredProcesses.map(process => {
                const scores = process.scores || {};
                const avgScore = ((scores.repetitive || 0) + (scores.dataDriven || 0) + (scores.ruleBased || 0) + (scores.highVolume || 0)) / 4;
                const scoreColor = avgScore >= 7 ? 'bg-success' : avgScore >= 5 ? 'bg-warning' : 'bg-danger';
                
                // Department color coding for workshop mode
                const departmentColors = {
                    'Finance': 'bg-green-100 text-green-800 border-green-300',
                    'HR': 'bg-orange-100 text-orange-800 border-orange-300',
                    'Operations': 'bg-blue-100 text-blue-800 border-blue-300',
                    'IT': 'bg-purple-100 text-purple-800 border-purple-300',
                    'Marketing': 'bg-pink-100 text-pink-800 border-pink-300',
                    'Sales': 'bg-indigo-100 text-indigo-800 border-indigo-300',
                    'Customer Service': 'bg-teal-100 text-teal-800 border-teal-300',
                    'Legal': 'bg-gray-100 text-gray-800 border-gray-300',
                    'Administration': 'bg-slate-100 text-slate-800 border-slate-300',
                    'R&D': 'bg-cyan-100 text-cyan-800 border-cyan-300',
                    'Quality Assurance': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                    'Procurement': 'bg-emerald-100 text-emerald-800 border-emerald-300',
                    'Facilities': 'bg-stone-100 text-stone-800 border-stone-300',
                    'Other': 'bg-neutral-100 text-neutral-800 border-neutral-300'
                };
                
                const departmentStyle = workshopReviewMode && departmentColors[process.department] 
                    ? departmentColors[process.department] 
                    : '';
                
                const borderClass = workshopReviewMode && departmentColors[process.department] 
                    ? `border-2 ${departmentColors[process.department].split(' ')[2]}` 
                    : 'border border-gray-200';
                
                return `
                    <div class="process-card group relative rounded-lg p-4 fade-in bg-white/95 ${borderClass} hover:shadow-md transition-all duration-200">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 pr-4">${process.name}</h4>
                                <div class="flex items-center space-x-2 mt-1">
                                    ${workshopReviewMode && departmentStyle ? 
                                        `<span class="text-xs px-2 py-1 rounded-full ${departmentStyle}">${process.department}</span>` : 
                                        `<p class="text-sm text-gray-600">${process.department}</p>`
                                    }
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="${scoreColor} text-white text-xs px-3 py-1 rounded-full font-semibold">${avgScore.toFixed(1)}/10</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-700 space-y-1 mb-3">
                            <div class="flex justify-between">
                                <span>Impact:</span>
                                <span class="font-medium">${process.impact}/10</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Feasibility:</span>
                                <span class="font-medium">${process.feasibility}/10</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Weekly Time:</span>
                                <span class="font-medium">${process.timeSpent} hrs</span>
                            </div>
                        </div>
                        ${!workshopMode || isAdmin ? `
                        <div class="flex justify-end space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <button onclick="editProcess('${process.id}')" class="text-blue-600 hover:text-blue-800 p-2 rounded hover:bg-blue-50 transition-colors" title="Edit process">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button onclick="deleteProcess('${process.id}')" class="text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50 transition-colors" title="Delete process">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function editProcess(processId) {
            console.log(' editProcess called with ID:', processId);
            const process = processes.find(p => p.id === processId);
            if (!process) return;
            
            editingProcessId = processId;
            
            // Fill form with existing data - Step 1
            document.getElementById('processName').value = process.name;
            document.getElementById('processDepartment').value = process.department === 'Custom' ? 'Custom' : process.department;
            if (process.department === 'Custom') {
                document.getElementById('customDepartment').value = process.customDepartment || '';
                toggleCustomDepartment();
            }
            document.getElementById('timeSpent').value = process.timeSpent;
            
            // Fill slider values - Step 2
            if (process.scores) {
                document.getElementById('repetitive').value = process.scores.repetitive || 5;
                document.getElementById('dataDriven').value = process.scores.dataDriven || 5;
                document.getElementById('ruleBased').value = process.scores.ruleBased || 5;
                document.getElementById('highVolume').value = process.scores.highVolume || 5;
                
                // Update slider displays
                updateSliderValue('repetitive', process.scores.repetitive || 5);
                updateSliderValue('dataDriven', process.scores.dataDriven || 5);
                updateSliderValue('ruleBased', process.scores.ruleBased || 5);
                updateSliderValue('highVolume', process.scores.highVolume || 5);
            }
            
            // Fill impact and feasibility values - Step 3
            document.getElementById('impact').value = process.impact || 5;
            document.getElementById('feasibility').value = process.feasibility || 5;
            updateSliderValue('impact', process.impact || 5);
            updateSliderValue('feasibility', process.feasibility || 5);
            
            // Fill notes - Step 4
            console.log(' Looking for processNotes field...');
            const notesField = document.getElementById('processNotes');
            console.log(' processNotes field found:', !!notesField);
            if (notesField) {
                notesField.value = process.notes || '';
                console.log(' processNotes field populated');
            } else {
                console.error(' processNotes field not found in DOM');
            }
            
            // Close the workspace first
            closeWorkspace();
            
            // Show the modal in edit mode
            const processModal = document.getElementById('processModal');
            if (processModal) {
                processModal.classList.remove('hidden');
                
                // Set edit mode
                editingProcessId = processId;
                
                // Update modal title and button for edit mode
                const modalTitle = document.querySelector('#processModal h2');
                const submitBtn = document.getElementById('submitBtn');
                
                if (modalTitle) modalTitle.textContent = 'Edit Business Process';
                if (submitBtn) submitBtn.innerHTML = 'Update Process ';
                
                // Update step display
                currentStep = 1;
                updateStepDisplay();
                
                // Prevent body scrolling
                document.body.style.overflow = 'hidden';
                
                console.log(' Process edit modal opened for:', process.name);
            } else {
                console.error(' processModal element not found in DOM');
            }
        }

        async function deleteProcess(processId) {
            const process = processes.find(p => p.id === processId);
            if (!process) return;
            
            if (confirm(`Are you sure you want to delete "${process.name}"?`)) {
                const preferredStorageMode = getPreferredStorageMode();
                
                try {
                    // Delete from Supabase if using Supabase mode
                    if (preferredStorageMode === 'supabase') {
                        if (window.workshopDB && window.workshopDB.isConnected()) {
                            await window.workshopDB.deleteProcess(processId);
                            console.log(' Process deleted from Supabase:', processId);
                        } else {
                            console.error(' Supabase deletion requested but not connected');
                            showNotification('Failed to delete: Supabase not connected', 'error');
                            return;
                        }
                    }
                    
                    // Remove from local array
                    processes = processes.filter(p => p.id !== processId);
                    await saveProcesses();
                    
                    renderProcessList();
                    recreateCharts();
                    showNotification('Process deleted successfully', 'success');
                } catch (error) {
                    console.error(' Process deletion failed:', error);
                    showNotification('Failed to delete process', 'error');
                }
            }
        }

        function getCurrentProjectStorageType() {
            const currentProj = projects.find(p => p.id === currentProjectId);
            return currentProj?.storageType || 'localStorage'; // default to localStorage for backward compatibility
        }

        function updateStorageMode(mode) {
            // Save the storage mode preference globally
            localStorage.setItem('preferredStorageMode', mode);
            
            // Update the visual state of the toggle
            const supabaseOption = document.querySelector('input[value="supabase"]');
            const localStorageOption = document.querySelector('input[value="localStorage"]');
            
            if (mode === 'supabase') {
                supabaseOption.checked = true;
                localStorageOption.checked = false;
            } else {
                supabaseOption.checked = false;
                localStorageOption.checked = true;
            }
            
            // Update the description text
            updateStorageDescription(mode);
            
            // Update the system status display immediately
            syncSettingsState();
            
            // Show notification about the change
            showNotification(`Storage mode switched to ${mode === 'supabase' ? 'Supabase Cloud' : 'Local Storage'}`, 'success');
            
            console.log(` Storage mode updated to: ${mode}`);
        }

        function updateStorageDescription(mode) {
            // This function can be extended to update description text if needed
            console.log(` Storage mode description updated for: ${mode}`);
        }

        function getPreferredStorageMode() {
            return localStorage.getItem('preferredStorageMode') || 'supabase';
        }

        function initializeStorageModeToggle() {
            const preferredMode = getPreferredStorageMode();
            
            // Set the correct radio button
            const supabaseOption = document.querySelector('input[value="supabase"]');
            const localStorageOption = document.querySelector('input[value="localStorage"]');
            
            if (supabaseOption && localStorageOption) {
                if (preferredMode === 'supabase') {
                    supabaseOption.checked = true;
                    localStorageOption.checked = false;
                } else {
                    supabaseOption.checked = false;
                    localStorageOption.checked = true;
                }
                
                // Update description
                updateStorageDescription(preferredMode);
                
                // Update system status display
                syncSettingsState();
                
                console.log(` Storage mode toggle initialized: ${preferredMode}`);
            }
        }

        async function saveProcesses() {
            if (!currentProjectId) return;
            
            const preferredStorageMode = getPreferredStorageMode();
            
            if (preferredStorageMode === 'supabase') {
                if (!window.workshopDB || !window.workshopDB.isConnected()) {
                    console.error(' Supabase storage requested but not available. Connection failed.');
                    showNotification('Failed to save: Supabase not connected', 'error');
                    return false;
                }
                
                try {
                    // Save to Supabase only
                    await window.workshopDB.saveProcesses(currentProjectId, processes);
                    console.log(' Processes saved to Supabase');
                    return true;
                } catch (error) {
                    console.error(' Failed to save processes to Supabase:', error);
                    showNotification('Failed to save processes to Supabase', 'error');
                    return false;
                }
            } else {
                try {
                    // Save to localStorage only
                    localStorage.setItem(`processes_${currentProjectId}`, JSON.stringify(processes));
                    console.log(' Processes saved to localStorage');
                    return true;
                } catch (error) {
                    console.error(' Failed to save processes to localStorage:', error);
                    showNotification('Failed to save processes to localStorage', 'error');
                    return false;
                }
            }
        }

        function initializeDashboard() {
            const APP_VERSION = '1.0.1-uuid-fix'; // Version to track cache updates
            debugLog(` Initializing dashboard v${APP_VERSION}...`);
            
            // Check if we need to clear old data with wrong UUIDs
            const lastVersion = localStorage.getItem('appVersion');
            if (lastVersion !== APP_VERSION) {
                console.log(` Version changed from ${lastVersion} to ${APP_VERSION}, clearing old project IDs...`);
                
                // Clear old projects with invalid UUIDs
                const savedProjects = localStorage.getItem('businessProjects');
                if (savedProjects) {
                    const projects = JSON.parse(savedProjects);
                    const hasOldIds = projects.some(p => p.id && p.id.startsWith('proj_'));
                    if (hasOldIds) {
                        console.log(' Clearing old projects with invalid IDs...');
                        localStorage.removeItem('businessProjects');
                    }
                }
                
                localStorage.setItem('appVersion', APP_VERSION);
            }
            
            // Initialize storage mode toggle
            initializeStorageModeToggle();
            
            // Initialize projects data
            initializeProjects();
            
            // Set default currentProjectId if projects exist but none selected
            if (projects.length > 0 && !currentProjectId) {
                currentProjectId = projects[0].id; // Use first project as default
                console.log(' Set default currentProjectId:', currentProjectId);
            }
            
            // Load processes for the current project
            if (currentProjectId) {
                loadProcesses(currentProjectId).then(() => {
                    console.log(' Processes loaded for current project:', currentProjectId);
                    renderProcessList();
                    updateDashboardSections();
                    recreateCharts();
                });
            }
            
            // Populate project selector with real projects
            updateProjectDropdowns();
            
            // Initialize charts and UI elements
            setTimeout(() => {
                // Only recreate charts if no current project (processes won't be loaded)
                if (!currentProjectId) {
                    recreateCharts();
                }
                showFabCluster();
            }, 200);
            
            // Enhance with database functionality
            enhanceInitializeDashboard();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog(` Page loaded, initializing dashboard...`);
            initializeDebugPanel();
            initializeDashboard();
            
            // Initialize new dashboard sections with default data
            setTimeout(() => {
                updateDashboardMetrics();
                createROIChart();
                
                // Initialize progress ring animation
                const progressRing = document.querySelector('#readinessRing .progress');
                if (progressRing) {
                    const circumference = 2 * Math.PI * 30;
                    progressRing.style.strokeDasharray = circumference;
                    const progress = 87; // Default readiness score
                    const offset = circumference - (progress / 100) * circumference;
                    progressRing.style.strokeDashoffset = offset;
                }
            }, 500);
        });

        // Handle window resize with debouncing to prevent excessive recreations
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                debugLog(` Window resized, recreating charts...`);
                recreateCharts();
            }, 250); // Debounce for 250ms
        });

        // ===== MISSING FUNCTIONS FROM BACKUP - START =====
        
        // Settings Panel Functions
        function logout() {
            // For this dashboard, logout just shows a confirmation message
            // since there's no login screen in this standalone version
            if (confirm('Are you sure you want to reset the session?')) {
                // Clear any temporary data
                localStorage.removeItem('currentProject');
                
                // Show notification
                showNotification('Session cleared successfully', 'success');
                
                // Reset to default project
                currentProject = 'SunSep7';
                document.getElementById('headerProjectSelector').value = currentProject;
                
                // Recreate charts with default data
                recreateCharts();
                
                // Close settings panel
                closeHeaderSettings();
            }
        }

        function showBulkActions() {
            // Create bulk actions modal
            const modalHtml = `
                <div id="bulkModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl p-8 w-full max-w-2xl shadow-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900"> Bulk Actions</h2>
                            <button onclick="closeBulkModal()" class="text-gray-400 hover:text-gray-600 text-2xl"></button>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold mb-2">Department Actions</h3>
                                <div class="space-y-2">
                                    <button onclick="bulkDeleteByDepartment()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-red-50 hover:border-red-300">
                                         Delete all processes from a specific department
                                    </button>
                                    <button onclick="bulkMoveToProject()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300">
                                         Move processes to different project
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-semibold mb-2">Score Actions</h3>
                                <div class="space-y-2">
                                    <button onclick="bulkAdjustScores()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-yellow-50 hover:border-yellow-300">
                                         Adjust scores for low-quality submissions
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function closeBulkModal() {
            const modal = document.getElementById('bulkModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function bulkDeleteByDepartment() {
            const dept = prompt('Enter department name to delete all processes (this cannot be undone):');
            if (!dept) return;
            
            // Use the dynamic processes array
            const matchingProcesses = processes.filter(p => p.department && p.department.toLowerCase() === dept.toLowerCase());
            
            if (matchingProcesses.length === 0) {
                showNotification('No processes found for that department', 'error');
                return;
            }
            
            if (confirm(`Delete ${matchingProcesses.length} processes from ${dept}?`)) {
                // Delete from processes array and save
                processes = processes.filter(p => !p.department || p.department.toLowerCase() !== dept.toLowerCase());
                saveProcesses();
                renderProcessList();
                recreateCharts();
                showNotification(`Deleted ${matchingProcesses.length} processes from ${dept}`, 'success');
                closeBulkModal();
            }
        }
        
        function bulkMoveToProject() {
            showNotification('Bulk move feature coming soon', 'info');
            closeBulkModal();
        }
        
        function bulkAdjustScores() {
            showNotification('Bulk score adjustment feature coming soon', 'info');
            closeBulkModal();
        }

        function showDepartmentLinks() {
            const baseUrl = window.location.origin + window.location.pathname;
            const departmentTokens = {
                'Finance': 'fin_2024',
                'HR': 'hr_2024', 
                'Operations': 'ops_2024',
                'Sales': 'sales_2024',
                'Marketing': 'mkt_2024',
                'IT': 'it_2024',
                'Customer Service': 'cs_2024',
                'Legal': 'legal_2024',
                'Administration': 'admin_2024',
                'R&D': 'rd_2024',
                'Quality Assurance': 'qa_2024',
                'Procurement': 'proc_2024',
                'Facilities': 'fac_2024',
                'Other': 'other_2024'
            };
            
            const modalHtml = `
                <div id="linksModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900"> Department Workshop Links</h2>
                            <button onclick="closeLinksModal()" class="text-gray-400 hover:text-gray-600 text-2xl"></button>
                        </div>
                        <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <h3 class="font-semibold text-blue-800 mb-2"> Instructions:</h3>
                            <ol class="text-sm text-blue-700 space-y-1">
                                <li>1. Copy the link for each department</li>
                                <li>2. Send to department leads via email/chat</li>
                                <li>3. Department leads click their unique link to submit processes</li>
                                <li>4. Return here to review all submissions in Workshop Mode</li>
                            </ol>
                        </div>
                        <div class="space-y-3">
                            ${Object.keys(departmentTokens).map(dept => {
                                const deptKey = dept.toLowerCase().replace(/\s+/g, '');
                                const url = `${baseUrl}?dept=${deptKey}&token=${departmentTokens[dept]}`;
                                return `
                                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                                        <div class="flex-1">
                                            <div class="font-semibold text-gray-900">${dept}</div>
                                            <div class="text-sm text-gray-500 font-mono break-all">${url}</div>
                                        </div>
                                        <button onclick="copyToClipboard('${url}', '${dept}')" class="ml-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium">
                                             Copy
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="mt-6 text-center">
                            <button onclick="copyAllLinks()" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium">
                                 Copy All Links
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function copyToClipboard(text, department) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`${department} link copied to clipboard!`, 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`${department} link copied to clipboard!`, 'success');
            });
        }
        
        function copyAllLinks() {
            const baseUrl = window.location.origin + window.location.pathname;
            const departmentTokens = {
                'Finance': 'fin_2024',
                'HR': 'hr_2024', 
                'Operations': 'ops_2024',
                'Sales': 'sales_2024',
                'Marketing': 'mkt_2024',
                'IT': 'it_2024',
                'Customer Service': 'cs_2024',
                'Legal': 'legal_2024',
                'Administration': 'admin_2024',
                'R&D': 'rd_2024',
                'Quality Assurance': 'qa_2024',
                'Procurement': 'proc_2024',
                'Facilities': 'fac_2024',
                'Other': 'other_2024'
            };
            
            const allLinks = Object.keys(departmentTokens).map(dept => {
                const deptKey = dept.toLowerCase().replace(/\s+/g, '');
                const url = `${baseUrl}?dept=${deptKey}&token=${departmentTokens[dept]}`;
                return `${dept}: ${url}`;
            }).join('\n\n');
            
            const fullMessage = ` Department Workshop Links - Business Automation Tool\n\n` +
                `Instructions:\n` +
                `- Click your department's link below\n` +
                `- Fill out the business process form\n` +
                `- Submit processes your team wants to automate\n` +
                `- Workshop review will happen after all submissions\n\n` +
                `${allLinks}`;
            
            navigator.clipboard.writeText(fullMessage).then(() => {
                showNotification('All department links copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = fullMessage;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('All department links copied to clipboard!', 'success');
            });
        }
        
        function closeLinksModal() {
            const modal = document.getElementById('linksModal');
            if (modal) {
                modal.remove();
            }
        }

        function showDuplicateDetection() {
            // For demo purposes, show a simple notification
            showNotification(' Duplicate detection feature - coming soon!', 'info');
        }

        // Process Management Functions
        async function deleteProcess(processId) {
            if (!processId) {
                showNotification('Process ID is required', 'error');
                return;
            }

            // Show confirmation dialog
            const process = processes.find(p => p.id === processId);
            if (!process) {
                showNotification('Process not found', 'error');
                return;
            }

            const confirmed = confirm(`Are you sure you want to delete "${process.name}"?\n\nThis action cannot be undone.`);
            if (!confirmed) {
                return;
            }

            try {
                showNotification(' Deleting process...', 'info');

                const preferredStorageMode = getPreferredStorageMode();
                
                if (preferredStorageMode === 'supabase' && window.workshopDB && window.workshopDB.isConnected()) {
                    // Delete from Supabase
                    try {
                        await window.workshopDB.deleteProcess(processId);
                        console.log(' Process deleted from Supabase:', processId);
                    } catch (error) {
                        console.error(' Failed to delete from Supabase:', error);
                        showNotification('Failed to delete from cloud database', 'error');
                        return;
                    }
                }

                // Remove from local array
                const processIndex = processes.findIndex(p => p.id === processId);
                if (processIndex !== -1) {
                    processes.splice(processIndex, 1);
                    
                    // Save updated processes
                    await saveProcesses();
                    
                    // Update UI
                    refreshProcessWorkspaceList();
                    recreateCharts();
                    
                    // Remove the process item from DOM with animation
                    const processItem = document.getElementById(`process-item-${processId}`);
                    if (processItem) {
                        processItem.style.transition = 'opacity 0.3s, transform 0.3s';
                        processItem.style.opacity = '0';
                        processItem.style.transform = 'translateX(-100%)';
                        setTimeout(() => {
                            if (processItem.parentNode) {
                                processItem.parentNode.removeChild(processItem);
                            }
                        }, 300);
                    }
                    
                    showNotification(` "${process.name}" deleted successfully`, 'success');
                    console.log(' Process deleted successfully:', processId);
                } else {
                    showNotification('Process not found in local data', 'error');
                }
            } catch (error) {
                console.error(' Delete process failed:', error);
                showNotification(`Failed to delete process: ${error.message}`, 'error');
            }
        }

        async function refreshProcessData() {
            try {
                const refreshBtn = document.querySelector('button[onclick="refreshProcessData()"]');
                if (refreshBtn) {
                    refreshBtn.disabled = true;
                    refreshBtn.innerHTML = `
                        <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Refreshing...
                    `;
                }

                showNotification(' Refreshing process data...', 'info');
                
                // Reload processes from storage
                if (currentProjectId) {
                    await loadProcesses(currentProjectId);
                    
                    // Update workspace if it's currently open
                    if (currentWorkspace === 'process') {
                        refreshProcessWorkspaceList();
                    }
                    
                    // Recreate charts
                    recreateCharts();
                    
                    showNotification(` Refreshed ${processes.length} processes`, 'success');
                    debugLog(` Process data refreshed: ${processes.length} processes loaded`);
                } else {
                    showNotification('No project selected', 'warning');
                }
            } catch (error) {
                console.error(' Refresh failed:', error);
                showNotification(`Refresh failed: ${error.message}`, 'error');
            } finally {
                // Restore refresh button
                const refreshBtn = document.querySelector('button[onclick="refreshProcessData()"]');
                if (refreshBtn) {
                    refreshBtn.disabled = false;
                    refreshBtn.innerHTML = `
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Refresh
                    `;
                }
            }
        }

        function refreshProcessWorkspaceList() {
            const workspaceListContainer = document.getElementById('processWorkspaceList');
            if (!workspaceListContainer) return;

            // Re-render the process list with updated data
            if (processes.length === 0) {
                workspaceListContainer.innerHTML = `
                    <div class="px-6 py-8 text-center">
                        <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <h4 class="text-lg font-medium text-gray-900 mb-2">No processes yet</h4>
                        <p class="text-gray-600 mb-4">Start by adding your first business process</p>
                        <button onclick="addProcess(); closeWorkspace();" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                            Add First Process
                        </button>
                    </div>
                `;
            } else {
                const processItems = processes.map(process => {
                    const scores = process.scores || {};
                    const avgScore = ((scores.repetitive || 0) + (scores.dataDriven || 0) + (scores.ruleBased || 0) + (scores.highVolume || 0)) / 4;
                    const scoreColor = avgScore >= 7 ? 'bg-green-100 text-green-800' : avgScore >= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                    const impactColor = (process.impact || 0) >= 8 ? 'text-red-600' : (process.impact || 0) >= 6 ? 'text-yellow-600' : 'text-gray-600';
                    return `
                        <div class="px-6 py-4 hover:bg-gray-50 transition-colors" id="process-item-${process.id}">
                            <div class="flex items-center justify-between">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center space-x-3">
                                        <h4 class="font-semibold text-gray-900 truncate">${process.name}</h4>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                            ${process.department || 'No Department'}
                                        </span>
                                        <span class="text-xs px-2 py-1 rounded-full ${scoreColor}">
                                            ${avgScore.toFixed(1)}/10
                                        </span>
                                    </div>
                                    <div class="flex items-center space-x-4 mt-2 text-sm text-gray-600">
                                        <span> ${process.timeSpent || 0} hrs/week</span>
                                        <span class="${impactColor}"> Impact: ${process.impact || 0}/10</span>
                                        <span class="text-blue-600"> Feasibility: ${process.feasibility || 0}/10</span>
                                        ${process.notes ? `<span class="text-gray-500" title="${process.notes}"> Has notes</span>` : ''}
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button onclick="editProcess('${process.id}')" class="flex items-center px-3 py-1 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors text-sm">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                        Edit
                                    </button>
                                    <button onclick="deleteProcess('${process.id}')" class="flex items-center px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                workspaceListContainer.innerHTML = processItems;
            }
            
            // Also update the statistics cards
            updateProcessStatistics();
        }
        
        function updateProcessStatistics() {
            // Update the statistics displayed in the workspace
            const statisticsContainers = document.querySelectorAll('.process-statistics');
            statisticsContainers.forEach(container => {
                const totalProcesses = container.querySelector('.stat-total-processes');
                const highImpact = container.querySelector('.stat-high-impact');
                const totalHours = container.querySelector('.stat-total-hours');
                const departments = container.querySelector('.stat-departments');
                
                if (totalProcesses) totalProcesses.textContent = processes.length;
                if (highImpact) highImpact.textContent = processes.filter(p => p.impact >= 8).length;
                if (totalHours) totalHours.textContent = processes.reduce((sum, p) => sum + (p.timeSpent || 0), 0);
                if (departments) departments.textContent = new Set(processes.map(p => p.department).filter(Boolean)).size;
            });
        }
        
        function updateProcessEntryProjectIndicator() {
            const projectNameElement = document.getElementById('processEntryProjectName');
            if (projectNameElement && currentProjectId) {
                const currentProject = projects.find(p => p.id === currentProjectId);
                if (currentProject) {
                    projectNameElement.textContent = currentProject.name;
                } else {
                    projectNameElement.textContent = 'Unknown Project';
                }
            } else if (projectNameElement) {
                projectNameElement.textContent = 'No Project Selected';
            }
        }

        // Workspace Functions
        let currentWorkspace = null;
        
        function openProjectWorkspace() {
            closeFabMenu();
            showWorkspace('project', 'Project Overview', createProjectWorkspace());
        }
        
        function openProcessWorkspace() {
            closeFabMenu();
            showWorkspace('process', 'Process Entry', createProcessWorkspace());
            
            // Update project indicator after workspace is shown
            setTimeout(() => {
                updateProcessEntryProjectIndicator();
            }, 100);
        }

        function openPresentationMode() {
            closeFabMenu();
            showWorkspace('presentation', 'Workshop Presentation', createPresentationWorkspace());
        }
        
        function showWorkspace(type, title, content) {
            currentWorkspace = type;
            
            // Create workspace overlay if it doesn't exist
            let workspace = document.getElementById('contextualWorkspace');
            if (!workspace) {
                workspace = document.createElement('div');
                workspace.id = 'contextualWorkspace';
                workspace.className = 'contextual-workspace';
                workspace.onclick = (e) => {
                    if (e.target === workspace) closeWorkspace();
                };
                document.body.appendChild(workspace);
            }
            
            workspace.innerHTML = `
                <div class="workspace-content">
                    <header class="workspace-header workspace-header-professional">
                        <div class="workspace-header-left">
                            <button class="workspace-back-btn" onclick="closeWorkspace()">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </button>
                            <div class="workspace-title-group">
                                <h1 class="workspace-title">${title}</h1>
                                ${title === 'Project Overview' ? '<p class="workspace-description">Manage and organize your automation projects</p>' : ''}
                            </div>
                        </div>
                        <div class="workspace-actions">
                            ${title === 'Project Overview' ? '<button class="new-project-btn" onclick="openProjectModal(); event.stopPropagation();"><svg class="new-project-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>New Project</button>' : ''}
                            <button class="btn-system-close" onclick="closeWorkspace()">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </header>
                    <div class="workspace-body">
                        ${content}
                    </div>
                </div>
            `;
            
            // Blur dashboard background
            const dashboard = document.querySelector('.container');
            if (dashboard) {
                dashboard.classList.add('dashboard-blur');
            }
            
            // Activate workspace with animation
            setTimeout(() => {
                workspace.classList.add('active');
            }, 10);
        }
        
        function closeWorkspace() {
            const workspace = document.getElementById('contextualWorkspace');
            const dashboard = document.querySelector('.container');
            
            if (workspace) {
                workspace.classList.remove('active');
                setTimeout(() => {
                    workspace.remove();
                }, 400);
            }
            
            // Remove dashboard blur
            if (dashboard) {
                dashboard.classList.remove('dashboard-blur');
            }
            
            currentWorkspace = null;
        }

        function closeFabMenu() {
            const cluster = document.getElementById('fabCluster');
            const icon = document.getElementById('fabIcon');
            
            if (cluster && cluster.classList.contains('expanded')) {
                cluster.classList.remove('expanded');
                icon.textContent = '';
                fabExpanded = false;
            }
        }

        // Workspace Content Creators
        function createProjectWorkspace() {
            return `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="mb-8">
                        <div class="mb-6">
                            <!-- Title removed since it's now in header -->
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Active Projects</h3>
                                <p class="text-3xl font-bold text-blue-600">${projects.length}</p>
                            </div>
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Total Processes</h3>
                                <p class="text-3xl font-bold text-green-600">${processes.length}</p>
                            </div>
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Departments</h3>
                                <p class="text-3xl font-bold text-purple-600">${new Set(processes.map(p => p.department)).size}</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-900">All Projects</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="workspaceProjectList">
                            ${projects.map(project => `
                                <div class="admin-control-card hover:shadow-lg transition-all duration-200 cursor-pointer" onclick="selectProject('${project.id}'); closeWorkspace();">
                                    <div class="flex justify-between items-start mb-3">
                                        <h4 class="font-semibold text-gray-900">${project.name}</h4>
                                        <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">Active</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">${project.clientName || 'No description'}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-500">
                                            ${processes.filter(p => p.projectId === project.id).length} processes
                                        </span>
                                        <div class="flex space-x-2">
                                            <button onclick="editProject('${project.id}'); event.stopPropagation();" class="text-blue-600 hover:text-blue-800 text-sm">
                                                Edit
                                            </button>
                                            <button onclick="deleteProject('${project.id}'); event.stopPropagation();" class="text-red-600 hover:text-red-800 text-sm">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function createProcessWorkspace() {
            return `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="mb-8">
                        <!-- Improved Header Layout -->
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Process Management</h2>
                                    <p class="text-gray-600">Manage and analyze business processes for automation opportunities</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button onclick="refreshProcessData()" class="flex items-center px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-colors">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                        Refresh
                                    </button>
                                    <button class="flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors" onclick="addProcess(); closeWorkspace();">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                        </svg>
                                        Add Process
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Project Indicator -->
                            <div id="processEntryProjectIndicator" class="bg-green-50 border border-green-200 rounded-lg p-3 flex items-center">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                                <div>
                                    <span class="text-sm font-medium text-green-800">Active Project:</span>
                                    <span id="processEntryProjectName" class="text-sm font-semibold text-green-900 ml-1">Loading...</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Process Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h3 class="font-semibold text-blue-800 text-sm">Total Processes</h3>
                                <p class="text-2xl font-bold text-blue-900">${processes.length}</p>
                            </div>
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h3 class="font-semibold text-green-800 text-sm">High Impact</h3>
                                <p class="text-2xl font-bold text-green-900">${processes.filter(p => p.impact >= 8).length}</p>
                            </div>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <h3 class="font-semibold text-yellow-800 text-sm">Total Hours/Week</h3>
                                <p class="text-2xl font-bold text-yellow-900">${processes.reduce((sum, p) => sum + (p.timeSpent || 0), 0)}</p>
                            </div>
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                <h3 class="font-semibold text-purple-800 text-sm">Departments</h3>
                                <p class="text-2xl font-bold text-purple-900">${new Set(processes.map(p => p.department).filter(Boolean)).size}</p>
                            </div>
                        </div>
                        
                        <!-- Process List -->
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-900">All Processes</h3>
                                <p class="text-sm text-gray-600 mt-1">View and manage all processes in the current project</p>
                            </div>
                            <div class="divide-y divide-gray-200" id="processWorkspaceList">
                                ${processes.length === 0 ? `
                                    <div class="px-6 py-8 text-center">
                                        <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                        </svg>
                                        <h4 class="text-lg font-medium text-gray-900 mb-2">No processes yet</h4>
                                        <p class="text-gray-600 mb-4">Start by adding your first business process</p>
                                        <button onclick="addProcess(); closeWorkspace();" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                            Add First Process
                                        </button>
                                    </div>
                                ` : processes.map(process => {
                                    const scores = process.scores || {};
                                    const avgScore = ((scores.repetitive || 0) + (scores.dataDriven || 0) + (scores.ruleBased || 0) + (scores.highVolume || 0)) / 4;
                                    const scoreColor = avgScore >= 7 ? 'bg-green-100 text-green-800' : avgScore >= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                                    const impactColor = (process.impact || 0) >= 8 ? 'text-red-600' : (process.impact || 0) >= 6 ? 'text-yellow-600' : 'text-gray-600';
                                    return `
                                        <div class="px-6 py-4 hover:bg-gray-50 transition-colors" id="process-item-${process.id}">
                                            <div class="flex items-center justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center space-x-3">
                                                        <h4 class="font-semibold text-gray-900 truncate">${process.name}</h4>
                                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                            ${process.department || 'No Department'}
                                                        </span>
                                                        <span class="text-xs px-2 py-1 rounded-full ${scoreColor}">
                                                            ${avgScore.toFixed(1)}/10
                                                        </span>
                                                    </div>
                                                    <div class="flex items-center space-x-4 mt-2 text-sm text-gray-600">
                                                        <span> ${process.timeSpent || 0} hrs/week</span>
                                                        <span class="${impactColor}"> Impact: ${process.impact || 0}/10</span>
                                                        <span class="text-blue-600"> Feasibility: ${process.feasibility || 0}/10</span>
                                                        ${process.notes ? `<span class="text-gray-500" title="${process.notes}"> Has notes</span>` : ''}
                                                    </div>
                                                </div>
                                                <div class="flex items-center space-x-2 ml-4">
                                                    <button onclick="editProcess('${process.id}')" class="flex items-center px-3 py-1 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors text-sm">
                                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                                        </svg>
                                                        Edit
                                                    </button>
                                                    <button onclick="deleteProcess('${process.id}')" class="flex items-center px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm">
                                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                        </svg>
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createPresentationWorkspace() {
            return `
                <div style="max-width: 1400px; margin: 0 auto; padding: 20px;">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4">Workshop Presentation Mode</h2>
                        <p class="text-gray-600">Full-screen view optimized for workshop presentations and stakeholder reviews.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <canvas id="presentationBubbleChart" class="w-full h-96"></canvas>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <canvas id="presentationDonutChart" class="w-full h-96"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-8 rounded-xl border border-gray-200">
                        <h3 class="text-xl font-semibold mb-4">Key Insights</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center p-6 bg-blue-50 rounded-xl">
                                <div class="text-3xl font-bold text-blue-600">${(processes || []).length}</div>
                                <div class="text-sm text-blue-800">Total Processes</div>
                            </div>
                            <div class="text-center p-6 bg-green-50 rounded-xl">
                                <div class="text-3xl font-bold text-green-600">${(processes || []).filter(p => p.impact >= 8).length}</div>
                                <div class="text-sm text-green-800">High Impact</div>
                            </div>
                            <div class="text-center p-6 bg-purple-50 rounded-xl">
                                <div class="text-3xl font-bold text-purple-600">${Math.round((processes || []).reduce((sum, p) => sum + (p.timeSpent || 0), 0))}</div>
                                <div class="text-sm text-purple-800">Total Hours/Week</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }


        // ===== MISSING FUNCTIONS FROM BACKUP - END =====

        // ===== DATABASE FUNCTIONALITY FUNCTIONS - START =====
        
        // Database Reset Functions
        function showResetConfirmation() {
            const modal = document.getElementById('resetConfirmationModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Close any open settings panels
                closeHeaderSettings();
            }
        }
        
        function hideResetConfirmation() {
            const modal = document.getElementById('resetConfirmationModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        function confirmResetDatabase() {
            // Hide the modal first
            hideResetConfirmation();
            
            // Add a small delay then proceed with reset
            setTimeout(() => {
                performDatabaseReset();
            }, 300);
        }
        
        async function performDatabaseReset() {
            try {
                showNotification(' Resetting database...', 'info');
                
                // Call the reset function if workshopDB is available
                if (window.workshopDB) {
                    const result = await window.workshopDB.resetDatabase();
                    
                    if (result.success) {
                        showNotification(
                            ` ${result.message}`, 
                            'success'
                        );
                        
                        // Clear current project state
                        currentProject = 'SunSep7';
                        
                        // Close settings panel
                        closeHeaderSettings();
                        
                        // Reset to default data
                        recreateCharts();
                        
                    } else {
                        throw new Error(result.message || 'Reset failed');
                    }
                } else {
                    // Fallback to local reset
                    localStorage.clear();
                    currentProject = 'SunSep7';
                    document.getElementById('headerProjectSelector').value = currentProject;
                    recreateCharts();
                    showNotification(' Local data reset successfully', 'success');
                    closeHeaderSettings();
                }
            } catch (error) {
                console.error(' Database reset failed:', error);
                showNotification(
                    ` Database reset failed: ${error.message}`, 
                    'error'
                );
            }
        }

        // Connection Status Functions
        function updateSettingsConnectionStatus() {
            const statusBadge = document.getElementById('connectionStatus');
            if (!statusBadge) {
                console.warn(' Connection status element not found');
                return;
            }
            
            const indicator = statusBadge.querySelector('.status-indicator');
            const text = statusBadge.querySelector('.status-text');
            
            if (!indicator || !text) {
                console.warn(' Status indicator elements not found');
                return;
            }
            
            // Check if database is available and connected
            let isOnline = false;
            let statusText = 'Offline';
            
            try {
                if (window.workshopDB && typeof window.workshopDB.isConnected === 'function') {
                    isOnline = window.workshopDB.isConnected();
                    const status = window.workshopDB.getConnectionStatus();
                    statusText = isOnline ? `${status.database} Connected` : 'localStorage Only';
                } else {
                    statusText = 'localStorage Only';
                }
            } catch (error) {
                console.log('Database not available, running in offline mode');
                statusText = 'localStorage Only';
            }
            
            // Update UI
            indicator.className = 'status-indicator';
            if (isOnline) {
                indicator.classList.add('online');
            } else {
                indicator.classList.add('offline');
            }
            
            text.textContent = statusText;
            
            console.log(` Connection Status: ${statusText}`);
        }

        // Enhanced Project Data Management
        async function loadProjects() {
            const preferredStorageMode = getPreferredStorageMode();
            
            if (preferredStorageMode === 'supabase') {
                if (window.workshopDB && window.workshopDB.isConnected()) {
                    try {
                        const loadedProjects = await window.workshopDB.getProjects();
                        
                        // Map Supabase data structure to dashboard structure
                        projects = loadedProjects.map(project => ({
                            id: project.id,
                            name: project.name,
                            clientName: project.metadata?.clientName || project.description || 'No client name',
                            createdAt: project.created_at,
                            storageType: 'supabase',
                            // Keep original Supabase data for reference
                            supabaseData: project
                        }));
                        
                        console.log(' Projects loaded from Supabase:', projects.length);
                        console.log(' Mapped project data:', projects);
                        
                        // If no projects exist, create sample projects
                        if (projects.length === 0) {
                            await createDefaultProjects();
                        }
                    } catch (error) {
                        console.error(' Failed to load projects from Supabase:', error);
                        showNotification('Failed to load projects from Supabase', 'error');
                        projects = []; // Initialize empty array on error
                    }
                } else {
                    console.error(' Supabase storage requested but not connected for project loading');
                    showNotification('Failed to load: Supabase not connected', 'error');
                    projects = []; // Initialize empty array
                }
            } else {
                // Load from localStorage only
                try {
                    const savedProjects = localStorage.getItem('businessProjects');
                    if (savedProjects) {
                        projects = JSON.parse(savedProjects);
                        console.log(' Projects loaded from localStorage:', projects.length);
                    } else {
                        // Create default projects if none exist
                        createDefaultProjectsLocal();
                    }
                } catch (error) {
                    console.error(' Failed to load projects from localStorage:', error);
                    showNotification('Failed to load projects from localStorage', 'error');
                    projects = []; // Initialize empty array on error
                }
            }
            
            renderProjectList();
        }

        async function createDefaultProjects() {
            const defaultProjects = [
                {
                    name: 'Q4 Business Process Automation',
                    description: 'Quarterly automation initiative for business process optimization',
                    workshopDate: new Date().toISOString().split('T')[0],
                    facilitatorEmail: 'admin@company.com',
                    metadata: { department: 'Operations', priority: 'High' }
                },
                {
                    name: 'HR Process Digitization',
                    description: 'Digital transformation project for HR department processes',
                    workshopDate: new Date().toISOString().split('T')[0],
                    facilitatorEmail: 'admin@company.com',
                    metadata: { department: 'HR', priority: 'Medium' }
                }
            ];

            for (const projectData of defaultProjects) {
                const project = await window.workshopDB.createProject(projectData);
                projects.push(project);
            }
            console.log(' Default projects created:', projects.length);
        }

        function createDefaultProjectsLocal() {
            projects = [
                {
                    id: generateId(),
                    name: 'Q4 Business Process Automation',
                    description: 'Quarterly automation initiative for business process optimization',
                    createdAt: new Date().toISOString(),
                    department: 'Operations',
                    storageType: 'localStorage'
                },
                {
                    id: generateId(),
                    name: 'HR Process Digitization',
                    description: 'Digital transformation project for HR department processes',
                    createdAt: new Date().toISOString(),
                    department: 'HR',
                    storageType: 'localStorage'
                }
            ];
            localStorage.setItem('businessProjects', JSON.stringify(projects));
            console.log(' Default projects created locally:', projects.length);
        }

        async function saveProjects() {
            const preferredStorageMode = getPreferredStorageMode();
            
            if (preferredStorageMode === 'supabase') {
                // For Supabase mode, projects are managed individually through createProject/updateProject/deleteProject
                // We still save to localStorage for local UI consistency
                localStorage.setItem('businessProjects', JSON.stringify(projects));
                console.log(' Projects synced to localStorage for UI consistency');
            } else {
                // Save to localStorage only
                localStorage.setItem('businessProjects', JSON.stringify(projects));
                console.log(' Projects saved to localStorage');
            }
        }

        // Initialize Database Connection
        function initializeDatabaseConnection() {
            console.log(' Initializing database connection...');
            
            try {
                // Check if workshopDB is available
                if (window.workshopDB) {
                    const status = window.workshopDB.getConnectionStatus();
                    console.log(' Database Status:', status);
                }
            } catch (error) {
                console.log('Database not available, running in offline mode');
            }
            
            // Update connection status in settings
            updateSettingsConnectionStatus();
            
            // Load projects list
            loadProjects();
        }

        // Enhanced Settings Panel Initialization
        function initializeSettingsPanel() {
            console.log(' Initializing settings panel with database functionality...');
            
            // Initialize connection status
            updateSettingsConnectionStatus();
            
            // Update connection status periodically
            setInterval(updateSettingsConnectionStatus, 30000); // Every 30 seconds
            
            console.log(' Settings panel initialized with database features');
        }

        // Enhanced initialization with database features
        function enhanceInitializeDashboard() {
            debugLog(` Enhancing dashboard with database functionality...`);
            
            // Initialize database connection
            initializeDatabaseConnection();
            
            // Initialize settings panel
            initializeSettingsPanel();
        }

        // ===== DATABASE FUNCTIONALITY FUNCTIONS - END =====
        
        // ===== HEADER SETTINGS PANEL FUNCTIONS - START =====
        
        function toggleHeaderSettings() {
            const panel = document.getElementById('headerSettingsPanel');
            const backdrop = document.getElementById('settingsBackdrop');
            const trigger = document.getElementById('headerSettingsTrigger');
            
            if (panel && backdrop && trigger) {
                const isActive = panel.classList.contains('active');
                
                if (isActive) {
                    closeHeaderSettings();
                } else {
                    openHeaderSettings();
                }
            }
        }
        
        function openHeaderSettings() {
            const panel = document.getElementById('headerSettingsPanel');
            const backdrop = document.getElementById('settingsBackdrop');
            const trigger = document.getElementById('headerSettingsTrigger');
            
            if (panel && backdrop && trigger) {
                // Add active classes with slight delay for smooth animation
                backdrop.classList.add('active');
                setTimeout(() => {
                    panel.classList.add('active');
                }, 10);
                
                trigger.classList.add('active');
                trigger.setAttribute('aria-expanded', 'true');
                
                // Add escape key listener
                document.addEventListener('keydown', handleSettingsEscape);
                
                // Prevent body scroll on mobile
                document.body.style.overflow = 'hidden';
                
                console.log(' Settings panel opened');
            }
        }
        
        function closeHeaderSettings() {
            const panel = document.getElementById('headerSettingsPanel');
            const backdrop = document.getElementById('settingsBackdrop');
            const trigger = document.getElementById('headerSettingsTrigger');
            
            if (panel && backdrop && trigger) {
                // Remove active classes
                panel.classList.remove('active');
                backdrop.classList.remove('active');
                trigger.classList.remove('active');
                trigger.setAttribute('aria-expanded', 'false');
                
                // Remove escape key listener
                document.removeEventListener('keydown', handleSettingsEscape);
                
                // Restore body scroll
                document.body.style.overflow = '';
                
                console.log(' Settings panel closed');
            }
        }
        
        function handleSettingsEscape(event) {
            if (event.key === 'Escape') {
                closeHeaderSettings();
            }
        }
        
        function handleSettingsKeyDown(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                toggleHeaderSettings();
            }
        }
        
        // ===== HEADER SETTINGS PANEL FUNCTIONS - END =====
        
        // ===== NEW SETTINGS FUNCTIONS - START =====
        
        // Export workflows function
        function exportWorkflows() {
            try {
                console.log(' Exporting workflows...');
                
                const exportData = {
                    exportDate: new Date().toISOString(),
                    currentProject: currentProject,
                    processes: processes,
                    projects: projects,
                    metadata: {
                        version: '1.0',
                        format: 'business-automation-dashboard'
                    }
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `processes-export-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification(' Workflows exported successfully!', 'success', 3000);
                console.log(' Workflows exported successfully');
                
            } catch (error) {
                console.error(' Export failed:', error);
                showNotification(' Export failed. Please try again.', 'error', 5000);
            }
        }
        
        // Update system health bar
        function updateSystemHealthBar() {
            try {
                const healthIndicator = document.getElementById('healthIndicator');
                const healthStatus = document.getElementById('healthStatus');
                const healthDetail = document.getElementById('healthDetail');
                const workspaceName = document.getElementById('workspaceName');
                const processCount = document.getElementById('processCount');
                
                if (healthIndicator && healthStatus && healthDetail && workspaceName && processCount) {
                    // Update connection status
                    let isConnected = false;
                    let statusText = 'Local Storage';
                    
                    try {
                        if (window.workshopDB && typeof window.workshopDB.isConnected === 'function') {
                            isConnected = window.workshopDB.isConnected();
                            statusText = isConnected ? 'Supabase Connected' : 'Local Storage';
                        }
                    } catch (error) {
                        console.log('Database check failed, using local storage');
                    }
                    
                    // Update health indicator
                    healthIndicator.style.background = isConnected ? '#34d399' : '#fbbf24';
                    healthStatus.textContent = statusText;
                    
                    // Update sync time
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    healthDetail.textContent = `Last sync: ${timeStr}`;
                    
                    // Update workspace info with ACTUAL current project data
                    let projectName = 'No Project Selected';
                    let processCountNum = 0;
                    
                    // Get project name from dropdown - this is the source of truth
                    const projectDropdown = document.getElementById('headerProjectSelector');
                    if (projectDropdown && projectDropdown.value) {
                        const selectedOption = projectDropdown.options[projectDropdown.selectedIndex];
                        if (selectedOption && selectedOption.text) {
                            projectName = selectedOption.text;
                        }
                    }
                    
                    // Get actual process count from global processes array
                    if (typeof processes !== 'undefined' && Array.isArray(processes)) {
                        processCountNum = processes.length;
                    }
                    
                    // Update the display
                    workspaceName.textContent = projectName;
                    processCount.textContent = `Active Processes: ${processCountNum}`;
                    
                    console.log(' Health bar updated - Project:', projectName, 'Processes:', processCountNum);
                }
            } catch (error) {
                console.error('Error updating system health bar:', error);
            }
        }
        
        // Enhanced storage mode update with health bar refresh
        function updateStorageModeEnhanced(mode) {
            updateStorageMode(mode); // Call existing function
            setTimeout(() => {
                updateSystemHealthBar(); // Refresh health bar
            }, 100);
        }
        
        // Initialize health bar when settings panel opens
        function initializeSettingsPanel() {
            // Force refresh of all data
            updateSystemHealthBar();
            
            // Update storage mode based on current preference
            const currentMode = localStorage.getItem('preferredStorageMode') || 'supabase';
            const supabaseRadio = document.getElementById('storageSupabase');
            const localRadio = document.getElementById('storageLocal');
            
            if (currentMode === 'supabase' && supabaseRadio) {
                supabaseRadio.checked = true;
            } else if (currentMode === 'localStorage' && localRadio) {
                localRadio.checked = true;
            }
            
            // Update storage mode change handlers
            if (supabaseRadio) {
                supabaseRadio.onchange = () => updateStorageModeEnhanced('supabase');
            }
            
            if (localRadio) {
                localRadio.onchange = () => updateStorageModeEnhanced('localStorage');
            }
            
            console.log(' Settings panel initialized with current project data');
        }
        
        // Override the existing header settings function to include initialization
        const originalToggleHeaderSettings = toggleHeaderSettings;
        toggleHeaderSettings = function() {
            originalToggleHeaderSettings();
            
            // If panel is now active, initialize it
            const panel = document.getElementById('headerSettingsPanel');
            if (panel && panel.classList.contains('active')) {
                setTimeout(() => {
                    initializeSettingsPanel();
                }, 100);
            }
        };
        
        // ===== NEW SETTINGS FUNCTIONS - END =====
        
    </script>

    <!-- Database Reset Confirmation Modal -->
    <div id="resetConfirmationModal" class="reset-confirmation-modal">
        <div class="reset-modal-backdrop" onclick="hideResetConfirmation()"></div>
        <div class="reset-modal-content">
            <div class="reset-modal-header">
                <div class="reset-modal-icon">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-2.694-.833-3.464 0L3.349 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                </div>
                <h3 class="reset-modal-title">Reset Database?</h3>
                <p class="reset-modal-description">
                    This will permanently delete all projects, processes, and workshop data. This action cannot be undone.
                </p>
            </div>
            <div class="reset-modal-actions">
                <button onclick="hideResetConfirmation()" class="reset-cancel-btn">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    Cancel
                </button>
                <button onclick="confirmResetDatabase()" class="reset-confirm-btn">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Yes, Delete Everything
                </button>
            </div>
        </div>
    </div>

    <div id="projectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden" style="z-index: 100000;">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Create New Project</h2>
                <button onclick="closeProjectModal()" class="text-gray-500 hover:text-gray-700 text-xl"></button>
            </div>
            <form id="projectForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                    <input type="text" id="projectName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-energy-blue focus:border-energy-blue" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                    <input type="text" id="clientName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-energy-blue focus:border-energy-blue" required>
                </div>
                <div class="flex justify-between space-x-4">
                    <button type="button" onclick="closeProjectModal()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium">
                        Create Project 
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Process Modal -->
    <div id="processModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden" style="z-index: 150;">
        <div class="bg-white rounded-2xl p-8 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900">Add Business Process</h2>
                    <p class="text-gray-600 mt-1">Define a new process for automation analysis</p>
                </div>
                <button onclick="closeProcessModal()" class="text-gray-400 hover:text-gray-600 text-2xl transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Project Indicator -->
            <div id="processModalProjectIndicator" class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6 flex items-center">
                <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                <div>
                    <span class="text-sm font-medium text-blue-800">Adding process to:</span>
                    <span id="processModalProjectName" class="text-sm font-semibold text-blue-900 ml-1">Loading...</span>
                </div>
            </div>
            <!-- Step Navigation -->
            <div class="flex justify-center mb-8">
                <div class="flex items-center space-x-4">
                    <div class="step-indicator active" data-step="1">
                        <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-bold">1</div>
                        <span class="text-sm font-medium text-gray-700 mt-2">Basic Info</span>
                    </div>
                    <div class="w-12 h-1 bg-gray-200 rounded"></div>
                    <div class="step-indicator" data-step="2">
                        <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center text-sm font-bold">2</div>
                        <span class="text-sm font-medium text-gray-500 mt-2">How You Work</span>
                    </div>
                    <div class="w-12 h-1 bg-gray-200 rounded"></div>
                    <div class="step-indicator" data-step="3">
                        <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center text-sm font-bold">3</div>
                        <span class="text-sm font-medium text-gray-500 mt-2">Business Impact</span>
                    </div>
                </div>
            </div>

            <form id="processForm" class="space-y-6">
                <!-- Step 1: Basic Information -->
                <div id="step1" class="step-content">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Let's start with the basics</h3>
                        <p class="text-gray-600">Tell us about the process you'd like to analyze</p>
                    </div>
                    
                    <!-- Quick Templates -->
                    <div class="bg-blue-50 p-6 rounded-xl mb-6">
                        <h4 class="font-semibold text-gray-800 mb-4"> Quick Start: Choose a common process</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('invoicing')">
                                <div class="font-medium text-sm"> Processing Invoices</div>
                                <div class="text-xs text-gray-500">Finance/Accounting</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('scheduling')">
                                <div class="font-medium text-sm"> Staff Scheduling</div>
                                <div class="text-xs text-gray-500">Operations</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('orders')">
                                <div class="font-medium text-sm"> Processing Orders</div>
                                <div class="text-xs text-gray-500">Sales/Operations</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('payroll')">
                                <div class="font-medium text-sm"> Payroll Processing</div>
                                <div class="text-xs text-gray-500">HR/Finance</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('inventory')">
                                <div class="font-medium text-sm"> Inventory Management</div>
                                <div class="text-xs text-gray-500">Operations</div>
                            </button>
                            <button type="button" class="template-btn text-left p-3 bg-white border border-gray-200 rounded-lg hover:border-primary transition-colors" onclick="fillTemplate('customer')">
                                <div class="font-medium text-sm"> Customer Support</div>
                                <div class="text-xs text-gray-500">Service</div>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-3"> Click any template to auto-fill, then customize as needed</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3 field-required">What do you call this process?</label>
                            <input type="text" id="processName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="e.g., Paying suppliers, Scheduling staff, Processing orders" required>
                            <div class="validation-error hidden" id="processName-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please enter a name for this process
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Give it a simple name that you and your team would recognize</p>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3 field-required">Which department owns this process?</label>
                            <select id="processDepartment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" required onchange="toggleCustomDepartment()">
                                <option value="">Select department...</option>
                                <option value="Finance"> Finance & Accounting</option>
                                <option value="HR"> Human Resources</option>
                                <option value="Operations"> Operations</option>
                                <option value="Sales"> Sales</option>
                                <option value="Marketing"> Marketing</option>
                                <option value="IT"> Information Technology</option>
                                <option value="Customer Service"> Customer Service</option>
                                <option value="Legal"> Legal & Compliance</option>
                                <option value="Administration"> Administration</option>
                                <option value="R&D"> Research & Development</option>
                                <option value="Quality Assurance"> Quality Assurance</option>
                                <option value="Procurement"> Procurement</option>
                                <option value="Facilities"> Facilities</option>
                                <option value="Custom"> Other (specify below)</option>
                            </select>
                            <div class="validation-error hidden" id="processDepartment-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please select a department or team
                            </div>
                            <input type="text" id="customDepartment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors mt-3 hidden" placeholder="Enter department/team name" maxlength="50">
                            <p class="text-xs text-gray-500 mt-1">This helps organize processes by department for workshop analysis</p>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-6 rounded-xl">
                        <label class="block text-sm font-semibold text-gray-700 mb-4">How much time does this process take?</label>
                        <div class="flex items-center space-x-4 mb-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="timeUnit" value="daily" class="mr-2" checked onchange="updateTimeUnit()">
                                <span class="text-sm font-medium">Per day</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="timeUnit" value="weekly" class="mr-2" onchange="updateTimeUnit()">
                                <span class="text-sm font-medium">Per week</span>
                            </label>
                        </div>
                        <!-- Time display above slider -->
                        <div class="text-center mb-3">
                            <span id="timeSpentValue" class="text-2xl font-bold text-primary">2 hours per day</span>
                        </div>
                        <input type="range" id="timeSpent" min="1" max="8" value="2" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer time-slider" oninput="updateTimeDisplay()">
                        <div class="flex justify-between text-sm text-gray-500 mt-2">
                            <span id="timeMin">1 hour</span>
                            <span id="timeMax">8+ hours</span>
                        </div>
                        <div id="timeConversion" class="text-xs text-blue-600 mt-2">
                             <span id="convertedTime">10.0</span> hours per week
                        </div>
                        <p class="text-xs text-gray-600 mt-2"> Include time from everyone who works on this process</p>
                    </div>
                </div>

                <!-- Step 2: How You Work -->
                <div id="step2" class="step-content hidden">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">How do you currently handle this?</h3>
                        <p class="text-gray-600">Help us understand your current process</p>
                    </div>

                    <div class="space-y-6">
                        <!-- Frequency Question -->
                        <div class="bg-green-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">How often do you do this process?</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="frequency-option cursor-pointer" for="freq-daily">
                                    <input type="radio" name="frequency" value="daily" id="freq-daily" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Multiple times daily</div>
                                        <div class="text-xs text-gray-500">Several times per day</div>
                                    </div>
                                </label>
                                <label class="frequency-option cursor-pointer" for="freq-weekly">
                                    <input type="radio" name="frequency" value="weekly" id="freq-weekly" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Daily or weekly</div>
                                        <div class="text-xs text-gray-500">Regular routine</div>
                                    </div>
                                </label>
                                <label class="frequency-option cursor-pointer" for="freq-monthly">
                                    <input type="radio" name="frequency" value="monthly" id="freq-monthly" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Monthly</div>
                                        <div class="text-xs text-gray-500">End of month tasks</div>
                                    </div>
                                </label>
                                <label class="frequency-option cursor-pointer" for="freq-rarely">
                                    <input type="radio" name="frequency" value="rarely" id="freq-rarely" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">As needed</div>
                                        <div class="text-xs text-gray-500">Irregular timing</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Information Sources -->
                        <div class="bg-purple-50 p-6 rounded-xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-800 field-required">What information do you need to complete this process?</h4>
                                <span class="text-sm text-purple-600 font-medium">Select all that apply</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-4"> You can select multiple options - choose everything you typically use</p>
                            <div class="validation-error hidden" id="infoSource-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please select at least one information source
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="info-source cursor-pointer" for="info-spreadsheets">
                                    <input type="checkbox" name="infoSource" value="spreadsheets" id="info-spreadsheets" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Spreadsheets or databases</div>
                                                <div class="text-xs text-gray-500">Excel, Google Sheets, databases</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer" for="info-documents">
                                    <input type="checkbox" name="infoSource" value="documents" id="info-documents" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Documents or emails</div>
                                                <div class="text-xs text-gray-500">PDFs, Word docs, email attachments</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer" for="info-communication">
                                    <input type="checkbox" name="infoSource" value="communication" id="info-communication" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Phone calls or meetings</div>
                                                <div class="text-xs text-gray-500">Talking with people to get info</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer" for="info-experience">
                                    <input type="checkbox" name="infoSource" value="experience" id="info-experience" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Experience and judgment</div>
                                                <div class="text-xs text-gray-500">You just know how to do it</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="info-source cursor-pointer" for="info-other">
                                    <input type="checkbox" name="infoSource" value="other" id="info-other" class="sr-only" onchange="toggleOtherInfo()">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div class="flex-1">
                                                <div class="font-medium">Other sources</div>
                                                <input type="text" id="otherInfoSource" class="text-xs text-gray-500 border-0 bg-transparent p-0 mt-1 w-full hidden" placeholder="Specify other information sources" maxlength="100">
                                                <div class="text-xs text-gray-500 mt-1" id="otherInfoPlaceholder">Specify other information sources</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Process Consistency -->
                        <div class="bg-orange-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4 field-required">How consistent is this process?</h4>
                            <div class="validation-error hidden" id="consistency-error">
                                <svg fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                Please select how consistent this process is
                            </div>
                            <div class="space-y-3">
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="exact" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">I follow the exact same steps every time</div>
                                                <div class="text-xs text-gray-500">There's a clear procedure that never changes</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="similar" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">I follow steps but make small adjustments</div>
                                                <div class="text-xs text-gray-500">Basic process is the same, but details vary</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="different" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">I use different approaches each time</div>
                                                <div class="text-xs text-gray-500">Each situation needs a custom solution</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="consistency-option cursor-pointer">
                                    <input type="radio" name="consistency" value="creative" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">It requires creativity and intuition</div>
                                                <div class="text-xs text-gray-500">Success depends on experience and insight</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Volume Assessment -->
                        <div class="bg-red-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">How much work does this process involve?</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="low" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Just a few items</div>
                                        <div class="text-xs text-gray-500">1-10 things to process</div>
                                    </div>
                                </label>
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="medium" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Moderate amount</div>
                                        <div class="text-xs text-gray-500">10-50 things</div>
                                    </div>
                                </label>
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="high" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Lots of items</div>
                                        <div class="text-xs text-gray-500">50-200 things</div>
                                    </div>
                                </label>
                                <label class="volume-option cursor-pointer">
                                    <input type="radio" name="volume" value="massive" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg text-center hover:border-primary transition-colors">
                                        <div class="text-2xl mb-2"></div>
                                        <div class="font-medium">Huge volume</div>
                                        <div class="text-xs text-gray-500">200+ things</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Business Impact -->
                <div id="step3" class="step-content hidden">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">What's the business impact?</h3>
                        <p class="text-gray-600">Help us understand why this process matters</p>
                    </div>

                    <div class="space-y-6">
                        <!-- Pain Points -->
                        <div class="bg-red-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">What happens when this process gets delayed or goes wrong?</h4>
                            <div class="space-y-3">
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="critical" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Business stops or customers get upset</div>
                                                <div class="text-xs text-gray-500">Major disruption, lost sales, angry customers</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="significant" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Creates problems but business continues</div>
                                                <div class="text-xs text-gray-500">Delays, extra work, some customer impact</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="moderate" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Inconvenient but manageable</div>
                                                <div class="text-xs text-gray-500">Some delays, internal frustration</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="impact-option cursor-pointer">
                                    <input type="radio" name="impact" value="low" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Not a big deal if it's delayed</div>
                                                <div class="text-xs text-gray-500">Nice to have but not urgent</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Implementation Difficulty -->
                        <div class="bg-green-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">How difficult would it be to change or improve this process?</h4>
                            <div class="space-y-3">
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="easy" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Pretty straightforward</div>
                                                <div class="text-xs text-gray-500">No special systems or approvals needed</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="moderate" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Would need some planning</div>
                                                <div class="text-xs text-gray-500">Might need new tools or training</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="complex" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Pretty complicated</div>
                                                <div class="text-xs text-gray-500">Involves multiple systems or people</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="feasibility-option cursor-pointer">
                                    <input type="radio" name="feasibility" value="difficult" class="sr-only">
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-3"></div>
                                            <div>
                                                <div class="font-medium">Very difficult to change</div>
                                                <div class="text-xs text-gray-500">Regulatory, legal, or major system constraints</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Cost of Problems -->
                        <div class="bg-yellow-50 p-6 rounded-xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-800">What does it cost when errors happen in this process?</h4>
                                <div class="currency-toggle">
                                    <label class="inline-flex items-center bg-white rounded-lg p-1 shadow-sm border border-gray-200">
                                        <input type="radio" name="errorCostCurrency" value="USD" class="sr-only" checked onchange="updateErrorCostCurrency('USD')">
                                        <span class="currency-option px-3 py-1 rounded text-sm font-medium cursor-pointer transition-colors bg-blue-100 text-blue-800">USD</span>
                                        <input type="radio" name="errorCostCurrency" value="INR" class="sr-only" onchange="updateErrorCostCurrency('INR')">
                                        <span class="currency-option px-3 py-1 rounded text-sm font-medium cursor-pointer transition-colors text-gray-600 hover:bg-gray-100">INR</span>
                                    </label>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="errorCostOptions">
                                <!-- Cost options will be populated dynamically based on currency -->
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h4 class="font-semibold text-gray-800 mb-4">Any additional details about this process?</h4>
                            <textarea id="processNotes" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="e.g., Involves multiple people, seasonal variations, compliance requirements..."></textarea>
                            <p class="text-xs text-gray-500 mt-2"> This helps us understand any special considerations</p>
                        </div>
                    </div>
                </div>

                <!-- Hidden fields for calculated scores -->
                <input type="hidden" id="repetitive" value="5">
                <input type="hidden" id="dataDriven" value="5">
                <input type="hidden" id="ruleBased" value="5">
                <input type="hidden" id="highVolume" value="5">
                <input type="hidden" id="impact" value="5">
                <input type="hidden" id="feasibility" value="5">

                <!-- Navigation Buttons -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <button type="button" id="prevBtn" onclick="previousStep()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors hidden">
                         Previous
                    </button>
                    <button type="button" onclick="closeProcessModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <div class="flex space-x-3">
                        <button type="button" id="nextBtn" onclick="nextStep()" class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                            Continue 
                        </button>
                        <button type="submit" id="submitBtn" class="px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors hidden">
                            Add Process 
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- FAB Cluster with Chat Integration -->
    <div id="fabCluster" class="fab-cluster">
        <!-- FAB Options -->
        <div class="fab-options">
            <div class="fab-option" onclick="openChatModal()">
                <div class="fab-option-label">AI Assistant</div>
                <div class="fab-option-button">
                    
                    <div id="chatNotificationBadge" class="chat-notification-badge" style="display: none;">!</div>
                </div>
            </div>
            <div class="fab-option" onclick="openAddProcessModal()">
                <div class="fab-option-label">Add Process</div>
                <div class="fab-option-button"></div>
            </div>
            <div class="fab-option" onclick="openProcessWorkspace()">
                <div class="fab-option-label">Manage Processes</div>
                <div class="fab-option-button"></div>
            </div>
            <div class="fab-option" onclick="openProjectWorkspace()">
                <div class="fab-option-label">Manage Projects</div>
                <div class="fab-option-button"></div>
            </div>
        </div>
        
        <!-- Main FAB Button -->
        <button class="fab-main" onclick="toggleFabCluster()" id="fabMainBtn">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
        </button>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="chat-modal">
        <div class="chat-container">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-header-left">
                    <div class="chat-avatar"></div>
                    <div>
                        <h3 class="chat-title">AI Process Assistant</h3>
                        <p class="chat-subtitle">Helping optimize your business processes</p>
                    </div>
                </div>
                <button class="chat-close-btn" onclick="closeChatModal()">
                    
                </button>
            </div>
            
            <!-- Chat Body -->
            <div class="chat-body">
                <div class="chat-messages" id="chatMessages">
                    <!-- Welcome message -->
                    <div class="message assistant">
                        <div class="message-avatar"></div>
                        <div class="message-content">
                            <div>Hi! I'm here to help you analyze your business processes. I can ask you specific questions about your operations to better understand automation opportunities.</div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                </div>
                
                <!-- Typing Indicator -->
                <div class="message assistant" style="margin: 0 24px 16px;">
                    <div class="message-avatar"></div>
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span style="font-size: 12px; color: #6b7280; margin-left: 8px;">AI is thinking...</span>
                    </div>
                </div>
            </div>
            
            <!-- Chat Footer -->
            <div class="chat-footer">
                <div class="chat-input-container">
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Share details about your business processes..." 
                        rows="1"
                        onkeydown="handleChatKeyDown(event)"
                        oninput="autoResizeTextarea(this)"
                    ></textarea>
                    <button class="chat-send-btn" onclick="sendChatMessage()" id="chatSendBtn">
                        
                    </button>
                </div>
                
                <!-- Update Dashboard Button -->
                <button class="update-dashboard-btn" id="updateDashboardBtn" onclick="updateDashboardFromChat()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                    </svg>
                    Update Dashboard with New Insights
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== CHAT SYSTEM JAVASCRIPT =====
        
        let isChatOpen = false;
        let isFabOpen = false;
        let chatMessages = [];
        let hasUnreadChatNotification = true; // Start with notification to encourage usage
        let dashboardUpdateReady = false;
        let currentConversationContext = {};
        
        // Chat conversation templates
        const businessQuestions = [
            "What's the average hourly cost for processes in your Finance department?",
            "How many hours per week does your team spend on manual data entry?",
            "Which department has the most repetitive tasks that could be automated?",
            "What's your biggest process bottleneck during month-end operations?",
            "How much time is lost waiting for approvals in your current workflows?",
            "Which processes cause the most customer complaints or delays?",
            "What manual tasks do your employees find most frustrating?",
            "How often do errors occur in your current manual processes?"
        ];
        
        // Initialize chat system
        function initializeChatSystem() {
            updateChatNotificationBadge();
            
            // Auto-show notification after 10 seconds if not interacted with
            setTimeout(() => {
                if (!isChatOpen && hasUnreadChatNotification) {
                    showChatNotificationPulse();
                }
            }, 10000);
            
            // Initialize with a proactive question after 30 seconds
            setTimeout(() => {
                if (!isChatOpen) {
                    addProactiveQuestion();
                }
            }, 30000);
        }
        
        function toggleFabCluster() {
            isFabOpen = !isFabOpen;
            const fabCluster = document.getElementById('fabCluster');
            const fabMainBtn = document.getElementById('fabMainBtn');
            
            if (isFabOpen) {
                fabCluster.classList.add('active');
                fabMainBtn.style.transform = 'rotate(45deg)';
            } else {
                fabCluster.classList.remove('active');
                fabMainBtn.style.transform = 'rotate(0deg)';
            }
        }
        
        function showFabCluster() {
            const fabCluster = document.getElementById('fabCluster');
            if (fabCluster) {
                fabCluster.style.opacity = '1';
                fabCluster.style.visibility = 'visible';
            }
        }
        
        function openChatModal() {
            isChatOpen = true;
            hasUnreadChatNotification = false;
            updateChatNotificationBadge();
            
            const modal = document.getElementById('chatModal');
            modal.classList.add('active');
            
            // Focus on input
            setTimeout(() => {
                const input = document.getElementById('chatInput');
                input.focus();
            }, 300);
            
            // Close FAB if open
            if (isFabOpen) {
                toggleFabCluster();
            }
            
            // Ask a contextual question based on current dashboard data
            setTimeout(() => {
                askContextualQuestion();
            }, 1000);
        }
        
        function closeChatModal() {
            isChatOpen = false;
            const modal = document.getElementById('chatModal');
            modal.classList.remove('active');
        }
        
        function updateChatNotificationBadge() {
            const badge = document.getElementById('chatNotificationBadge');
            if (badge) {
                badge.style.display = hasUnreadChatNotification ? 'flex' : 'none';
            }
        }
        
        function showChatNotificationPulse() {
            const badge = document.getElementById('chatNotificationBadge');
            if (badge && hasUnreadChatNotification) {
                badge.style.animation = 'pulse 2s infinite';
                setTimeout(() => {
                    badge.style.animation = 'pulse 2s infinite';
                }, 100);
            }
        }
        
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage('user', message);
            input.value = '';
            autoResizeTextarea(input);
            
            // Show typing indicator and respond
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                processUserMessage(message);
            }, 1500 + Math.random() * 1000); // Simulate processing time
        }
        
        function addChatMessage(sender, content, timestamp = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const time = timestamp || new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${sender}`;
            messageElement.innerHTML = `
                <div class="message-avatar">${sender === 'user' ? '' : ''}</div>
                <div class="message-content">
                    <div>${content}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageElement);
            scrollChatToBottom();
            
            // Store message
            chatMessages.push({ sender, content, timestamp: time });
        }
        
        function processUserMessage(message) {
            // Simulate AI processing and provide contextual response
            const responses = [
                "That's very insightful! Based on what you've shared, I can see automation opportunities. Can you tell me more about how long these processes typically take?",
                "Excellent information! This helps me understand your workflow better. What would you estimate is the cost impact when these processes are delayed?",
                "Thanks for sharing that detail. I'm building a picture of your operations. Which of these processes would your team be most excited to see automated?",
                "This is exactly the kind of insight I need! Based on your processes, I can see potential for significant time savings. What's your current biggest pain point?"
            ];
            
            const response = responses[Math.floor(Math.random() * responses.length)];
            addChatMessage('assistant', response);
            
            // Maybe show update button after a few exchanges
            if (chatMessages.length >= 6 && !dashboardUpdateReady) {
                setTimeout(() => {
                    showUpdateDashboardButton();
                }, 2000);
            }
        }
        
        function askContextualQuestion() {
            if (processes && processes.length > 0) {
                // Ask about existing processes
                const deptCounts = {};
                processes.forEach(p => {
                    deptCounts[p.department] = (deptCounts[p.department] || 0) + 1;
                });
                
                const topDept = Object.keys(deptCounts).reduce((a, b) => 
                    deptCounts[a] > deptCounts[b] ? a : b
                );
                
                const question = `I notice you have ${processes.length} processes, with ${deptCounts[topDept]} in ${topDept}. What's the biggest challenge your ${topDept} team faces with their current processes?`;
                
                setTimeout(() => {
                    addChatMessage('assistant', question);
                }, 500);
            } else {
                // Ask general business question
                const randomQuestion = businessQuestions[Math.floor(Math.random() * businessQuestions.length)];
                setTimeout(() => {
                    addChatMessage('assistant', randomQuestion);
                }, 500);
            }
        }
        
        function addProactiveQuestion() {
            if (!isChatOpen) {
                hasUnreadChatNotification = true;
                updateChatNotificationBadge();
                showChatNotificationPulse();
            }
        }
        
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.classList.add('active');
            scrollChatToBottom();
        }
        
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.classList.remove('active');
        }
        
        function scrollChatToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showUpdateDashboardButton() {
            dashboardUpdateReady = true;
            const button = document.getElementById('updateDashboardBtn');
            button.classList.add('ready');
            
            addChatMessage('assistant', ' Great conversation! I now have enough insights to provide recommendations for your dashboard. Click the button below to update your analysis with these new insights.');
        }
        
        function updateDashboardFromChat() {
            // Simulate dashboard update with new insights
            const button = document.getElementById('updateDashboardBtn');
            const originalText = button.innerHTML;
            
            button.innerHTML = `
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
                    <path d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                </svg>
                Updating Dashboard...
            `;
            
            button.disabled = true;
            
            setTimeout(() => {
                // Keep chat open for continued conversation
                // closeChatModal(); // Removed to maintain chat context
                
                // Show success notification
                showNotification(' Dashboard updated with AI insights! Chat remains open for further refinements.', 'success', 6000);
                
                // Refresh dashboard sections to show "new" data
                updateDashboardSections();
                recreateCharts();
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                button.classList.remove('ready');
                dashboardUpdateReady = false;
                
                // Clear chat for next session
                setTimeout(() => {
                    const messagesContainer = document.getElementById('chatMessages');
                    messagesContainer.innerHTML = `
                        <div class="message assistant">
                            <div class="message-avatar"></div>
                            <div class="message-content">
                                <div>Hi! I'm here to help you analyze your business processes. I can ask you specific questions about your operations to better understand automation opportunities.</div>
                                <div class="message-time">Just now</div>
                            </div>
                        </div>
                    `;
                    chatMessages = [];
                }, 3000);
            }, 2000);
        }
        
        function handleChatKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }
        
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
        }
        
        // Close chat when clicking outside
        document.addEventListener('click', (e) => {
            const chatModal = document.getElementById('chatModal');
            const fabCluster = document.getElementById('fabCluster');
            
            if (isChatOpen && !chatModal.querySelector('.chat-container').contains(e.target)) {
                // Don't close if clicking on FAB
                if (!fabCluster.contains(e.target)) {
                    closeChatModal();
                }
            }
            
            if (isFabOpen && !fabCluster.contains(e.target)) {
                toggleFabCluster();
            }
        });
        
        // Add spin animation for loading states
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        
        // Inline Editing System for Roadmap and Actions
        let undoStack = [];
        let currentEditElement = null;
        
        // Edit phase field (title, duration, savings)
        function editPhaseField(element) {
            if (currentEditElement) cancelEdit(currentEditElement);
            
            const field = element.dataset.field;
            const phase = element.dataset.phase;
            const currentText = element.textContent.trim();
            
            // Store undo data
            undoStack.push({
                type: 'phase-field',
                element: element,
                field: field,
                phase: phase,
                oldValue: currentText,
                timestamp: Date.now()
            });
            
            // Create input
            const input = document.createElement('input');
            input.className = 'inline-input';
            input.value = currentText;
            input.dataset.field = field;
            input.dataset.phase = phase;
            
            // Replace content
            element.innerHTML = '';
            element.appendChild(input);
            element.classList.add('editing');
            currentEditElement = element;
            
            // Focus and select
            input.focus();
            input.select();
            
            // Add controls
            addEditControls(element, input);
            
            // Handle keyboard shortcuts
            input.addEventListener('keydown', handleEditKeydown);
            input.addEventListener('blur', () => handleEditBlur(element, input));
        }
        
        // Edit phase item
        function editPhaseItem(phaseItemElement) {
            if (currentEditElement) cancelEdit(currentEditElement);
            
            const contentSpan = phaseItemElement.querySelector('.phase-item-content');
            const currentText = contentSpan.textContent.trim();
            const phaseContainer = phaseItemElement.closest('[data-phase]');
            const phase = phaseContainer.dataset.phase;
            
            // Store undo data
            undoStack.push({
                type: 'phase-item',
                element: phaseItemElement,
                contentElement: contentSpan,
                phase: phase,
                oldValue: currentText,
                timestamp: Date.now()
            });
            
            // Create input
            const input = document.createElement('input');
            input.className = 'inline-input';
            input.value = currentText;
            
            // Replace content
            contentSpan.innerHTML = '';
            contentSpan.appendChild(input);
            phaseItemElement.classList.add('editing');
            currentEditElement = phaseItemElement;
            
            // Focus and select
            input.focus();
            input.select();
            
            // Add controls
            addEditControls(phaseItemElement, input);
            
            // Handle keyboard shortcuts
            input.addEventListener('keydown', handleEditKeydown);
            input.addEventListener('blur', () => handleEditBlur(phaseItemElement, input));
        }
        
        // Edit action field (title, description, meta)
        function editActionField(element) {
            if (currentEditElement) cancelEdit(currentEditElement);
            
            const field = element.dataset.field;
            const action = element.dataset.action;
            const currentText = element.textContent.trim();
            
            // Store undo data
            undoStack.push({
                type: 'action-field',
                element: element,
                field: field,
                action: action,
                oldValue: currentText,
                timestamp: Date.now()
            });
            
            // Create appropriate input
            const isDescription = field === 'description';
            const input = document.createElement(isDescription ? 'textarea' : 'input');
            input.className = isDescription ? 'inline-textarea' : 'inline-input';
            input.value = currentText;
            input.dataset.field = field;
            input.dataset.action = action;
            
            if (isDescription) {
                input.rows = 3;
            }
            
            // Replace content
            element.innerHTML = '';
            element.appendChild(input);
            element.classList.add('editing');
            currentEditElement = element;
            
            // Focus and select
            input.focus();
            input.select();
            
            // Add controls
            addEditControls(element, input);
            
            // Handle keyboard shortcuts
            input.addEventListener('keydown', handleEditKeydown);
            input.addEventListener('blur', () => handleEditBlur(element, input));
        }
        
        // Add phase item
        function addPhaseItem(phaseNumber) {
            const phaseContainer = document.querySelector(`[data-phase="${phaseNumber}"]`);
            const addButton = phaseContainer.querySelector('.add-item-btn');
            
            // Create new phase item
            const newItem = document.createElement('div');
            newItem.className = 'phase-item text-small editable';
            newItem.onclick = () => editPhaseItem(newItem);
            newItem.innerHTML = `
                <span class="phase-item-content">New Process</span>
                <div class="phase-item-actions">
                    <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    <svg class="edit-icon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="removePhaseItem(this, event)">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </div>
            `;
            
            // Insert before add button
            phaseContainer.insertBefore(newItem, addButton);
            
            // Automatically start editing
            setTimeout(() => editPhaseItem(newItem), 100);
            
            // Store undo data
            undoStack.push({
                type: 'add-phase-item',
                element: newItem,
                phase: phaseNumber,
                timestamp: Date.now()
            });
        }
        
        // Remove phase item
        function removePhaseItem(deleteIcon, event) {
            event.stopPropagation();
            
            const phaseItem = deleteIcon.closest('.phase-item');
            const contentSpan = phaseItem.querySelector('.phase-item-content');
            const phaseContainer = phaseItem.closest('[data-phase]');
            const phase = phaseContainer.dataset.phase;
            
            // Store undo data
            undoStack.push({
                type: 'remove-phase-item',
                element: phaseItem,
                parent: phaseContainer,
                nextSibling: phaseItem.nextElementSibling,
                phase: phase,
                content: contentSpan.textContent,
                timestamp: Date.now()
            });
            
            // Remove with animation
            phaseItem.style.transition = 'all 0.3s ease';
            phaseItem.style.opacity = '0';
            phaseItem.style.transform = 'translateX(-100%)';
            
            setTimeout(() => {
                if (phaseItem.parentNode) {
                    phaseItem.parentNode.removeChild(phaseItem);
                }
            }, 300);
            
            showUndoNotification('Process removed');
        }
        
        // Add edit controls (save/cancel buttons)
        function addEditControls(element, input) {
            const controls = element.querySelector('.edit-controls');
            if (controls) {
                controls.innerHTML = `
                    <button class="save-btn" onclick="saveEdit(this)">
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </button>
                    <button class="cancel-btn" onclick="cancelEdit(this.closest('.editable'))">
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
            }
        }
        
        // Handle keyboard shortcuts
        function handleEditKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                saveEdit(event.target);
            } else if (event.key === 'Escape') {
                event.preventDefault();
                cancelEdit(currentEditElement);
            } else if (event.key === 'Tab') {
                event.preventDefault();
                saveEdit(event.target);
            }
        }
        
        // Handle blur (click outside)
        function handleEditBlur(element, input) {
            // Small delay to allow save button clicks
            setTimeout(() => {
                if (element.classList.contains('editing')) {
                    saveEdit(input);
                }
            }, 150);
        }
        
        // Save edit
        function saveEdit(inputOrButton) {
            let element, input;
            
            if (inputOrButton.closest && inputOrButton.closest('.editable')) {
                element = inputOrButton.closest('.editable');
                input = element.querySelector('.inline-input, .inline-textarea');
            } else {
                input = inputOrButton;
                element = input.closest('.editable');
            }
            
            if (!element || !input) return;
            
            const newValue = input.value.trim();
            if (!newValue) {
                showEditFeedback(element, 'Value cannot be empty', 'error');
                return;
            }
            
            // Show loading state
            element.classList.add('loading-state');
            
            setTimeout(() => {
                // Restore content based on type
                if (element.classList.contains('phase-item')) {
                    const contentSpan = element.querySelector('.phase-item-content');
                    contentSpan.textContent = newValue;
                } else {
                    element.textContent = newValue;
                }
                
                // Restore edit controls
                if (!element.classList.contains('phase-item')) {
                    const controls = document.createElement('div');
                    controls.className = 'edit-controls';
                    controls.innerHTML = `
                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                    `;
                    element.appendChild(controls);
                }
                
                // Clean up
                element.classList.remove('editing', 'loading-state');
                currentEditElement = null;
                
                showEditFeedback(element, 'Saved!', 'success');
                showUndoNotification('Changes saved');
            }, 500);
        }
        
        // Cancel edit
        function cancelEdit(element) {
            if (!element) return;
            
            // Get original value from undo stack
            const lastUndo = undoStack[undoStack.length - 1];
            let originalValue = '';
            
            if (lastUndo && lastUndo.element === element) {
                originalValue = lastUndo.oldValue;
                undoStack.pop(); // Remove cancelled edit from undo stack
            }
            
            // Restore content based on type
            if (element.classList.contains('phase-item')) {
                const contentSpan = element.querySelector('.phase-item-content');
                contentSpan.textContent = originalValue;
            } else {
                element.textContent = originalValue;
                
                // Restore edit controls
                const controls = document.createElement('div');
                controls.className = 'edit-controls';
                controls.innerHTML = `
                    <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                `;
                element.appendChild(controls);
            }
            
            // Clean up
            element.classList.remove('editing');
            currentEditElement = null;
        }
        
        // Show edit feedback
        function showEditFeedback(element, message, type = 'success') {
            const feedback = document.createElement('div');
            feedback.className = `edit-feedback ${type}`;
            feedback.textContent = message;
            
            element.appendChild(feedback);
            
            setTimeout(() => feedback.classList.add('show'), 10);
            
            setTimeout(() => {
                feedback.classList.remove('show');
                setTimeout(() => {
                    if (feedback.parentNode) {
                        feedback.parentNode.removeChild(feedback);
                    }
                }, 300);
            }, 2000);
        }
        
        // Undo system
        function showUndoNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'undo-notification';
            notification.innerHTML = `
                <span>${message}</span>
                <button class="undo-btn" onclick="performUndo()">Undo</button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        function performUndo() {
            if (undoStack.length === 0) return;
            
            const action = undoStack.pop();
            
            switch (action.type) {
                case 'phase-field':
                case 'action-field':
                    action.element.textContent = action.oldValue;
                    // Restore edit controls
                    const controls = document.createElement('div');
                    controls.className = 'edit-controls';
                    controls.innerHTML = `
                        <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                    `;
                    action.element.appendChild(controls);
                    break;
                    
                case 'phase-item':
                    action.contentElement.textContent = action.oldValue;
                    break;
                    
                case 'add-phase-item':
                    if (action.element.parentNode) {
                        action.element.parentNode.removeChild(action.element);
                    }
                    break;
                    
                case 'remove-phase-item':
                    if (action.nextSibling) {
                        action.parent.insertBefore(action.element, action.nextSibling);
                    } else {
                        action.parent.appendChild(action.element);
                    }
                    action.element.style.opacity = '';
                    action.element.style.transform = '';
                    break;
            }
            
            // Hide undo notification
            const notification = document.querySelector('.undo-notification');
            if (notification) {
                notification.classList.remove('show');
            }
        }
        
        // Click outside handler
        document.addEventListener('click', (event) => {
            if (currentEditElement && !currentEditElement.contains(event.target)) {
                // Don't cancel if clicking on undo notification
                if (!event.target.closest('.undo-notification')) {
                    const input = currentEditElement.querySelector('.inline-input, .inline-textarea');
                    if (input) {
                        saveEdit(input);
                    }
                }
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            // Ctrl/Cmd + Z for undo
            if ((event.ctrlKey || event.metaKey) && event.key === 'z' && !event.shiftKey) {
                event.preventDefault();
                performUndo();
            }
        });
        
        // Initialize chat system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Delay initialization to ensure all other systems are ready
            setTimeout(() => {
                initializeChatSystem();
            }, 1000);
        });
    </script>
</body>
</html>
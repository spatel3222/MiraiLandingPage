<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Opportunity Navigator - Business Process Automation Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Workshop Database Integration -->
    <script src="../api/supabase-config.js"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        /* Header Styles */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #e2e8f0;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 4px 0;
            letter-spacing: -0.025em;
        }
        
        .header-title p {
            color: #64748b;
            margin: 0;
            font-size: 0.875rem;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .project-selector {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .project-selector span {
            color: #64748b;
            margin-right: 8px;
        }
        
        .project-selector select {
            background: transparent;
            border: none;
            color: #1e293b;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .project-selector select:hover {
            color: #3b82f6;
        }
        
        .settings-trigger {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            color: #64748b;
            transition: all 0.2s;
        }
        
        .settings-trigger:hover {
            background: #f1f5f9;
            color: #1e293b;
        }
        
        .settings-trigger svg {
            width: 20px;
            height: 20px;
        }
        
        /* Tailwind utility classes for proper icon sizing */
        .w-3 { width: 0.75rem; }
        .h-3 { height: 0.75rem; }
        .w-4 { width: 1rem; }
        .h-4 { height: 1rem; }

        /* ===== MISSING CSS FROM BACKUP - START ===== */
        
        /* CSS Variables */
        :root {
            --duration-workspace: 400ms;
            --ease-workspace: cubic-bezier(0.4, 0, 0.2, 1);
            --duration-standard: 300ms;
            --duration-quick: 150ms;
            --ease-brand: cubic-bezier(0.4, 0, 0.2, 1);
            --glass-overlay: rgba(255, 255, 255, 0.95);
            --glass-dark: rgba(0, 0, 0, 0.75);
            --blur-overlay: blur(16px);
            --blur-dark: blur(12px);
            --blur-secondary: blur(8px);
        }

        /* Contextual Workspace System */
        .contextual-workspace {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active {
            opacity: 1;
            visibility: visible;
        }
        
        .workspace-content {
            position: absolute;
            inset: 24px;
            background: var(--glass-overlay);
            backdrop-filter: var(--blur-overlay);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95) translateY(40px);
            transition: transform var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active .workspace-content {
            transform: scale(1) translateY(0);
        }
        
        /* Workspace Header */
        .workspace-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .workspace-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-back-btn {
            width: 40px;
            height: 40px;
            background: rgba(107, 114, 128, 0.1);
            backdrop-filter: var(--blur-secondary);
            border: 1px solid rgba(107, 114, 128, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            cursor: pointer;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .workspace-back-btn:hover {
            transform: translateX(-2px);
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
        }
        
        .workspace-title {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        .workspace-badge {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .workspace-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Workspace Body */
        .workspace-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }
        
        /* Button System */
        .btn-system {
            background: rgba(107, 114, 128, 0.15);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(107, 114, 128, 0.3);
            color: #374151;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn-system:hover {
            transform: translateY(-1px);
            background: rgba(107, 114, 128, 0.15);
            border-color: rgba(107, 114, 128, 0.3);
            box-shadow: 0 4px 16px rgba(107, 114, 128, 0.1);
        }

        /* Dashboard Blur Effect */
        .dashboard-blur {
            filter: blur(4px);
            transform: scale(0.98);
            transition: all var(--duration-standard) ease;
        }

        /* Mode Indicator */
        .mode-indicator {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: var(--glass-dark);
            backdrop-filter: var(--blur-dark);
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 110;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .mode-indicator.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        /* ===== MISSING CSS FROM BACKUP - END =====

        /* ===== DATABASE FUNCTIONALITY CSS - START ===== */
        
        /* Connection Status */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
            animation: pulse 2s infinite;
        }
        
        .status-indicator.offline {
            background: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
        }
        
        .status-indicator.loading {
            background: #f59e0b;
            box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
        }
        
        .status-text {
            color: #6b7280;
            font-weight: 500;
        }
        
        /* Settings Button Variants */
        
        .settings-reset-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }
        
        .settings-reset-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* Database Reset Modal */
        .reset-confirmation-modal {
            position: fixed;
            inset: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .reset-confirmation-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .reset-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .reset-modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 480px;
            margin: 20px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .reset-confirmation-modal.active .reset-modal-content {
            transform: scale(1) translateY(0);
        }
        
        .reset-modal-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .reset-modal-icon {
            width: 64px;
            height: 64px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px auto;
        }
        
        .reset-modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
            margin: 0 0 8px 0;
        }
        
        .reset-modal-description {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
            line-height: 1.5;
        }
        
        .reset-modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .reset-cancel-btn {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            background: #f3f4f6;
            color: #374151;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-cancel-btn:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        .reset-confirm-btn {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-confirm-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* Grid utility for settings buttons */
        .grid {
            display: grid;
        }
        
        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        
        .gap-2 {
            gap: 0.5rem;
        }
        
        /* Pulse animation */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }
        
        /* Prevent pointer events on status indicators to avoid blocking interactions */
        #connectionStatus {
            pointer-events: none !important;
            user-select: none;
        }
        
        /* ===== DATABASE FUNCTIONALITY CSS - END =====
        
        /* Main Content */
        .main-content {
            padding: 32px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page-header {
            margin-bottom: 32px;
            text-align: center;
        }
        
        .page-header h2 {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 8px 0;
        }
        
        .page-header p {
            color: #64748b;
            font-size: 1rem;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-top: 32px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: #fefefe;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }
        
        .chart-container:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
            max-height: 100%;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 16px;
            font-weight: 600;
            color: #374151;
            font-size: 1rem;
        }
        
        .debug-info {
            margin: 20px 0;
            padding: 16px;
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* FAB Styles */
        .fab-cluster {
            position: fixed;
            bottom: 48px;
            right: 48px;
            z-index: 90;
        }
        
        .fab-primary {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(79, 70, 229, 0.3);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
        }
        
        .fab-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(79, 70, 229, 0.4);
        }
        
        .fab-secondary-group {
            position: absolute;
            bottom: 80px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .fab-cluster.expanded .fab-secondary-group {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .fab-secondary {
            width: 48px;
            height: 48px;
            background: rgba(79, 70, 229, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4F46E5;
            cursor: pointer;
            transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
            position: relative;
        }
        
        .fab-secondary:hover {
            transform: translateX(-4px);
            background: rgba(79, 70, 229, 0.15);
            border-color: rgba(79, 70, 229, 0.3);
        }
        
        .fab-tooltip {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 200ms;
            pointer-events: none;
        }
        
        .fab-secondary:hover .fab-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(-4px);
        }
        
        .recreate-button {
            margin-top: 32px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .recreate-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        /* Header Settings Panel Styles */
        .header-settings-panel {
            position: fixed;
            top: 80px;
            right: 24px;
            width: 320px;
            max-height: 500px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 99999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            overflow-y: auto;
        }
        
        .header-settings-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .settings-header {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: #fafbfc;
            border-radius: 12px 12px 0 0;
            flex-shrink: 0;
        }
        
        .settings-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }
        
        .settings-subtitle {
            font-size: 12px;
            color: #64748b;
            margin: 2px 0 0 0;
        }
        
        .settings-body {
            padding: 0;
            flex: 1;
            overflow-y: auto;
        }
        
        .settings-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .settings-section:last-child {
            border-bottom: none;
        }
        
        .settings-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 0 0 12px 0;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }
        
        .settings-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
        }
        
        .settings-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .settings-btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .settings-btn-warning:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3);
        }
        
        .settings-btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .settings-btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        
        .settings-logout-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .settings-logout-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        .settings-reset-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .settings-reset-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        /* Project Management System Styles */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-healthy {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
        }

        .status-text {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
        }

        .participant-counter {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 8px;
        }

        .participant-icon {
            font-size: 14px;
        }

        .participant-count {
            font-size: 12px;
            font-weight: 700;
            color: #374151;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 6px;
        }

        .quick-action-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .quick-action-btn:hover {
            background: #f1f5f9;
        }

        /* Consolidated Settings Panel */
        .settings-panel {
            position: relative;
            display: inline-block;
        }

        .settings-trigger {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 500;
            color: #475569;
        }

        .settings-trigger:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            color: #334155;
        }

        .settings-trigger.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .settings-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
            min-width: 320px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .settings-header {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: #fafbfc;
            border-radius: 12px 12px 0 0;
            flex-shrink: 0;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .settings-subtitle {
            font-size: 12px;
            color: #64748b;
            margin: 2px 0 0 0;
        }

        .settings-body {
            padding: 0;
            flex: 1;
            overflow-y: auto;
        }

        .settings-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }

        .settings-item-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-item-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-toggle {
            position: relative;
            display: inline-block;
            width: 42px;
            height: 22px;
        }

        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 11px;
        }

        .settings-toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .settings-toggle input:checked + .settings-toggle-slider {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .settings-toggle input:checked + .settings-toggle-slider:before {
            transform: translateX(20px);
        }

        .settings-select {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            min-width: 140px;
        }
        
        .settings-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .settings-btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .settings-btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-color: transparent;
        }
        
        .settings-btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .settings-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .settings-status-online {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .settings-status-offline {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .settings-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-close-btn:hover {
            background: #f1f5f9;
            color: #475569;
        }

        /* Animation for settings gear icon */
        .settings-icon {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-trigger.active .settings-icon {
            transform: rotate(120deg);
        }

        /* Contextual Workspace System */
        :root {
            --glass-primary: rgba(255, 255, 255, 0.85);
            --glass-secondary: rgba(255, 255, 255, 0.75);
            --glass-overlay: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(15, 23, 42, 0.85);
            --blur-primary: blur(12px);
            --blur-secondary: blur(10px);
            --blur-overlay: blur(16px);
            --blur-dark: blur(12px);
            --ease-brand: cubic-bezier(0.4, 0.0, 0.2, 1);
            --ease-workspace: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --duration-quick: 200ms;
            --duration-standard: 300ms;
            --duration-workspace: 400ms;
        }

        /* Contextual Workspace Overlay */
        .contextual-workspace {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active {
            opacity: 1;
            visibility: visible;
        }
        
        .workspace-content {
            position: absolute;
            inset: 24px;
            background: var(--glass-overlay);
            backdrop-filter: var(--blur-overlay);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95) translateY(40px);
            transition: transform var(--duration-workspace) var(--ease-workspace);
        }
        
        .contextual-workspace.active .workspace-content {
            transform: scale(1) translateY(0);
        }

        /* Workspace Header */
        .workspace-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(248, 250, 252, 0.5);
        }
        
        .workspace-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .workspace-back-btn {
            width: 40px;
            height: 40px;
            background: rgba(107, 114, 128, 0.1);
            backdrop-filter: var(--blur-secondary);
            border: 1px solid rgba(107, 114, 128, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            cursor: pointer;
            transition: all var(--duration-quick) var(--ease-brand);
        }
        
        .workspace-back-btn:hover {
            transform: translateX(-2px);
            background: rgba(107, 114, 128, 0.15);
            color: #374151;
        }
        
        .workspace-title {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        .workspace-badge {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .workspace-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Workspace Body */
        .workspace-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        /* Admin Control Card */
        .admin-control-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
            transition: all 0.2s ease;
        }

        .admin-control-card:hover {
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }

        /* Primary Button - Brand gradient with WCAG AA compliance */
        .btn-primary {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: #ffffff;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #3730a3 0%, #5b21b6 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
        }

        .btn-system {
            background: #f8fafc;
            color: #475569;
            border: 1px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-system:hover {
            background: #e2e8f0;
            border-color: #94a3b8;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .fab-cluster {
                bottom: 32px;
                right: 32px;
            }
            
            .fab-primary {
                width: 56px;
                height: 56px;
                font-size: 20px;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>AI Opportunity Navigator</h1>
                    <p>Business Process Automation Intelligence</p>
                </div>
                <div class="header-controls">
                    <div class="project-selector">
                        <span>Active Project:</span>
                        <select id="headerProjectSelector" onchange="switchProject(this.value)">
                            <option value="">Select Project...</option>
                        </select>
                    </div>
                    <button class="settings-trigger" onclick="toggleHeaderSettings()" id="headerSettingsTrigger">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                    
                    <!-- Header Settings Panel -->
                    <div class="header-settings-panel" id="headerSettingsPanel">
                        <div class="settings-header">
                            <h3 class="settings-title">System Settings</h3>
                            <p class="settings-subtitle">Configure your workspace preferences</p>
                            <button class="settings-close-btn" onclick="closeHeaderSettings()" style="position: absolute; top: 12px; right: 12px;">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="settings-body">
                            <!-- System Status -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    System Status
                                </h4>
                                <div class="settings-item">
                                    <span class="settings-label">Database Connection</span>
                                    <span class="connection-status" id="connectionStatus">
                                        <div class="status-indicator"></div>
                                        <span class="status-text">Loading...</span>
                                    </span>
                                </div>
                            </div>

                            <!-- Data Actions -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                    </svg>
                                    Data Actions
                                </h4>
                                <div class="settings-item">
                                    <div class="grid grid-cols-1 gap-2">
                                        <button onclick="showDuplicateDetection()" class="settings-btn settings-btn-primary">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                            </svg>
                                            Find Duplicates
                                        </button>
                                        <button onclick="showBulkActions()" class="settings-btn settings-btn-warning">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                            </svg>
                                            Bulk Actions
                                        </button>
                                        <button onclick="showDepartmentLinks()" class="settings-btn settings-btn-success">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                            </svg>
                                            Generate Links
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Account -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    Account
                                </h4>
                                <button onclick="logout()" class="settings-logout-btn">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                    Sign Out
                                </button>
                            </div>

                            <!-- Database Management -->
                            <div class="settings-section">
                                <h4 class="settings-section-title">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/>
                                    </svg>
                                    Database Management
                                </h4>
                                <div class="settings-item">
                                    <button onclick="showResetConfirmation()" class="settings-reset-btn">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                        Reset Database
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
                <h2>Business Process Analytics Dashboard</h2>
                <p>Real-time insights into your automation opportunities and process optimization potential.</p>
            </div>
            
            <div id="debug-info" class="debug-info">
                <strong>Debug Information:</strong><br>
                <span id="debug-content">Initializing dashboard...</span>
            </div>
            
            <div class="chart-grid">
                <div class="chart-container">
                    <div class="chart-title">Process Priority Matrix</div>
                    <canvas id="bubbleChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Department Distribution</div>
                    <canvas id="donutChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Automation Readiness Scores</div>
                    <canvas id="radarChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Weekly Time Investment</div>
                    <canvas id="barChart"></canvas>
                </div>
            </div>
            
            <button class="recreate-button" onclick="recreateCharts()">
                 Refresh Charts
            </button>
        </div>

    </div>

    <script>
        // Enhanced project data structure matching backup
        const projectData = {
            'SunSep7': [
                {
                    id: 'proc_001',
                    name: "Invoice Processing Automation",
                    department: "Finance", 
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 15,
                    scores: { repetitive: 9, dataDriven: 8, ruleBased: 9, highVolume: 8 },
                    notes: "Manual invoice processing takes significant time and prone to errors",
                    created_at: new Date('2024-09-01').toISOString(),
                    automation_avg: 8.5,
                    priority_score: 7.8
                },
                {
                    id: 'proc_002',
                    name: "Customer Onboarding Workflow",
                    department: "Sales",
                    impact: 9,
                    feasibility: 6,
                    timeSpent: 12,
                    scores: { repetitive: 7, dataDriven: 6, ruleBased: 8, highVolume: 7 },
                    notes: "Multiple touchpoints and manual data entry required",
                    created_at: new Date('2024-09-02').toISOString(),
                    automation_avg: 7.0,
                    priority_score: 7.4
                },
                {
                    id: 'proc_003',
                    name: "Report Generation System",
                    department: "Operations",
                    impact: 6,
                    feasibility: 9,
                    timeSpent: 8,
                    scores: { repetitive: 10, dataDriven: 9, ruleBased: 7, highVolume: 6 },
                    notes: "Weekly reports compiled manually from multiple sources",
                    created_at: new Date('2024-09-03').toISOString(),
                    automation_avg: 8.0,
                    priority_score: 7.2
                }
            ],
            'Project Alpha': [
                {
                    id: 'proc_004',
                    name: "Employee Performance Reviews",
                    department: "HR",
                    impact: 7,
                    feasibility: 8,
                    timeSpent: 10,
                    scores: { repetitive: 6, dataDriven: 7, ruleBased: 6, highVolume: 5 },
                    notes: "Quarterly review process requires standardization",
                    created_at: new Date('2024-09-04').toISOString(),
                    automation_avg: 6.0,
                    priority_score: 6.8
                },
                {
                    id: 'proc_005',
                    name: "Inventory Management",
                    department: "Operations",
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 20,
                    scores: { repetitive: 8, dataDriven: 9, ruleBased: 8, highVolume: 9 },
                    notes: "Stock level monitoring and reorder process",
                    created_at: new Date('2024-09-05').toISOString(),
                    automation_avg: 8.5,
                    priority_score: 8.0
                },
                {
                    id: 'proc_006',
                    name: "Expense Report Processing",
                    department: "Finance",
                    impact: 6,
                    feasibility: 8,
                    timeSpent: 8,
                    scores: { repetitive: 9, dataDriven: 8, ruleBased: 8, highVolume: 7 },
                    notes: "Manual approval workflow causes delays",
                    created_at: new Date('2024-09-06').toISOString(),
                    automation_avg: 8.0,
                    priority_score: 7.2
                }
            ],
            'Project Beta': [
                {
                    id: 'proc_007',
                    name: "Social Media Scheduling",
                    department: "Marketing",
                    impact: 5,
                    feasibility: 9,
                    timeSpent: 6,
                    scores: { repetitive: 9, dataDriven: 5, ruleBased: 7, highVolume: 6 },
                    notes: "Content scheduling across multiple platforms",
                    created_at: new Date('2024-09-07').toISOString(),
                    automation_avg: 6.75,
                    priority_score: 6.5
                },
                {
                    id: 'proc_008',
                    name: "Customer Support Tickets",
                    department: "Support",
                    impact: 9,
                    feasibility: 6,
                    timeSpent: 25,
                    scores: { repetitive: 7, dataDriven: 6, ruleBased: 8, highVolume: 9 },
                    notes: "High volume of tickets requiring triage and routing",
                    created_at: new Date('2024-09-08').toISOString(),
                    automation_avg: 7.5,
                    priority_score: 7.8
                },
                {
                    id: 'proc_009',
                    name: "Data Backup Procedures",
                    department: "IT",
                    impact: 10,
                    feasibility: 8,
                    timeSpent: 5,
                    scores: { repetitive: 10, dataDriven: 8, ruleBased: 9, highVolume: 4 },
                    notes: "Critical system backups performed manually",
                    created_at: new Date('2024-09-09').toISOString(),
                    automation_avg: 7.75,
                    priority_score: 8.5
                },
                {
                    id: 'proc_010',
                    name: "Lead Qualification Process",
                    department: "Sales",
                    impact: 8,
                    feasibility: 7,
                    timeSpent: 15,
                    scores: { repetitive: 8, dataDriven: 9, ruleBased: 8, highVolume: 8 },
                    notes: "Manual lead scoring and assignment process",
                    created_at: new Date('2024-09-10').toISOString(),
                    automation_avg: 8.25,
                    priority_score: 7.9
                },
                {
                    id: 'proc_011',
                    name: "Document Approval Workflow",
                    department: "Legal",
                    impact: 7,
                    feasibility: 6,
                    timeSpent: 18,
                    scores: { repetitive: 6, dataDriven: 5, ruleBased: 8, highVolume: 6 },
                    notes: "Contract and document approval routing",
                    created_at: new Date('2024-09-11').toISOString(),
                    automation_avg: 6.25,
                    priority_score: 6.7
                }
            ]
        };

        // Enhanced project metadata
        const projectMetadata = {
            'SunSep7': {
                name: 'SunSep7',
                description: 'Q3 2024 Automation Assessment',
                created_at: '2024-09-07',
                facilitator: 'Workshop Admin',
                departments: ['Finance', 'Sales', 'Operations'],
                status: 'active'
            },
            'Project Alpha': {
                name: 'Project Alpha',
                description: 'HR & Operations Optimization',
                created_at: '2024-08-15',
                facilitator: 'Process Manager',
                departments: ['HR', 'Operations', 'Finance'],
                status: 'active'
            },
            'Project Beta': {
                name: 'Project Beta',
                description: 'Enterprise-wide Digital Transformation',
                created_at: '2024-08-01',
                facilitator: 'Digital Lead',
                departments: ['Marketing', 'Support', 'IT', 'Sales', 'Legal'],
                status: 'active'
            }
        };

        // Global variables for project management
        let currentProjectId = null;
        let projects = [];
        let processes = [];
        let editingProcessId = null;
        let workshopMode = false;
        let currentDepartment = '';
        let currentDepartmentFilter = null;
        let workshopReviewMode = false;
        let isAdmin = true;

        // Initialize projects with sample data if needed
        function initializeProjects() {
            const savedProjects = localStorage.getItem('businessProjects');
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
            } else {
                // Initialize with sample projects if none exist
                projects = [
                    {
                        id: 'proj_001',
                        name: 'SunSep7 Automation',
                        clientName: 'Q3 2024 Automation Assessment',
                        createdAt: new Date('2024-09-07').toISOString()
                    },
                    {
                        id: 'proj_002', 
                        name: 'Project Alpha',
                        clientName: 'Digital Transformation Initiative',
                        createdAt: new Date('2024-08-15').toISOString()
                    },
                    {
                        id: 'proj_003',
                        name: 'Project Beta', 
                        clientName: 'Enterprise-wide Process Optimization',
                        createdAt: new Date('2024-08-01').toISOString()
                    }
                ];
                saveProjects();
            }
        }
        
        // Current data based on selected project
        let sampleProcesses = projectData['SunSep7'];

        let charts = {};
        let currentProject = 'SunSep7';
        
        function debugLog(message) {
            console.log(message);
            const debugContent = document.getElementById('debug-content');
            debugContent.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }

        function createBubbleChart() {
            const element = document.getElementById('bubbleChart');
            const container = element.parentElement;
            
            debugLog(` Bubble chart - Element: ${!!element}, Container: ${!!container}`);
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                debugLog(` Container dimensions: ${containerRect.width}x${containerRect.height}`);
                
                // Force proper canvas dimensions
                const width = Math.max(containerRect.width - 40, 400); // Account for padding
                const height = Math.max(containerRect.height - 60, 300); // Account for title
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
                
                debugLog(` Set canvas dimensions: ${width}x${height}`);
            }

            const ctx = element.getContext('2d');
            
            if (charts.bubble) {
                charts.bubble.destroy();
            }

            const data = sampleProcesses.map(process => ({
                x: process.impact,
                y: process.feasibility,
                r: Math.max(process.timeSpent, 5),
                label: process.name,
                department: process.department
            }));

            charts.bubble = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Business Processes',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw.label} (${context.raw.department}): Impact ${context.raw.x}, Feasibility ${context.raw.y}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Business Impact',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            min: 0,
                            max: 10
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Technical Feasibility',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            min: 0,
                            max: 10
                        }
                    }
                }
            });
            
            debugLog(` Bubble chart created successfully`);
        }

        function createDonutChart() {
            const element = document.getElementById('donutChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.donut) {
                charts.donut.destroy();
            }

            // Calculate department hours
            const departmentHours = {};
            sampleProcesses.forEach(p => {
                departmentHours[p.department] = (departmentHours[p.department] || 0) + p.timeSpent;
            });

            charts.donut = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(departmentHours),
                    datasets: [{
                        data: Object.values(departmentHours),
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)', 
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(124, 58, 237, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed} hours/week`;
                                }
                            }
                        }
                    }
                }
            });
            
            debugLog(` Donut chart created successfully`);
        }

        function createRadarChart() {
            const element = document.getElementById('radarChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.radar) {
                charts.radar.destroy();
            }

            // Calculate average scores
            const avgScores = sampleProcesses.reduce((acc, p) => {
                acc.repetitive += p.scores.repetitive;
                acc.dataDriven += p.scores.dataDriven;
                acc.ruleBased += p.scores.ruleBased;
                acc.highVolume += p.scores.highVolume;
                return acc;
            }, { repetitive: 0, dataDriven: 0, ruleBased: 0, highVolume: 0 });

            const processCount = sampleProcesses.length;
            Object.keys(avgScores).forEach(key => {
                avgScores[key] = avgScores[key] / processCount;
            });

            charts.radar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Repetitive Tasks', 'Data-Driven', 'Rule-Based', 'High Volume'],
                    datasets: [{
                        label: 'Automation Readiness',
                        data: [
                            avgScores.repetitive,
                            avgScores.dataDriven,
                            avgScores.ruleBased,
                            avgScores.highVolume
                        ],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
            
            debugLog(` Radar chart created successfully`);
        }

        function createBarChart() {
            const element = document.getElementById('barChart');
            const container = element.parentElement;
            
            if (container) {
                const containerRect = container.getBoundingClientRect();
                const width = Math.max(containerRect.width - 40, 400);
                const height = Math.max(containerRect.height - 60, 300);
                
                element.width = width;
                element.height = height;
                element.style.width = width + 'px';
                element.style.height = height + 'px';
            }

            const ctx = element.getContext('2d');
            
            if (charts.bar) {
                charts.bar.destroy();
            }

            charts.bar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sampleProcesses.map(p => p.name),
                    datasets: [{
                        label: 'Hours per Week',
                        data: sampleProcesses.map(p => p.timeSpent),
                        backgroundColor: 'rgba(245, 158, 11, 0.7)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y} hours/week`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours per Week',
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            debugLog(` Bar chart created successfully`);
        }

        function recreateCharts() {
            debugLog(` Recreating all charts...`);
            document.getElementById('debug-content').innerHTML = 'Recreating charts...';
            
            setTimeout(() => {
                createBubbleChart();
                createDonutChart();
                createRadarChart();
                createBarChart();
                debugLog(` All charts recreation complete`);
            }, 100);
        }

        // Header functionality
        function switchProject(projectId) {
            debugLog(` Switching to project: ${projectId}`);
            currentProject = projectId;
            recreateCharts();
        }

        // Header Settings Functions (REUSED FROM BACKUP)
        let headerSettingsOpen = false;
        
        function toggleHeaderSettings() {
            if (headerSettingsOpen) {
                closeHeaderSettings();
            } else {
                openHeaderSettings();
            }
        }
        
        function openHeaderSettings() {
            const trigger = document.getElementById('headerSettingsTrigger');
            const panel = document.getElementById('headerSettingsPanel');
            
            if (!trigger || !panel) {
                console.warn('Header settings elements not found');
                return;
            }
            
            trigger.classList.add('active');
            panel.classList.add('active');
            headerSettingsOpen = true;
            
            // Sync settings with current state
            syncSettingsState();
            
            // Add click outside handler
            setTimeout(() => {
                document.addEventListener('click', handleHeaderSettingsClickOutside);
            }, 100);
        }
        
        function closeHeaderSettings() {
            const trigger = document.getElementById('headerSettingsTrigger');
            const panel = document.getElementById('headerSettingsPanel');
            
            if (trigger) trigger.classList.remove('active');
            if (panel) panel.classList.remove('active');
            headerSettingsOpen = false;
            
            // Remove click outside handler
            document.removeEventListener('click', handleHeaderSettingsClickOutside);
        }
        
        function handleHeaderSettingsClickOutside(event) {
            const panel = document.getElementById('headerSettingsPanel');
            const trigger = document.getElementById('headerSettingsTrigger');
            if (panel && !panel.contains(event.target) && !trigger.contains(event.target)) {
                closeHeaderSettings();
            }
        }
        
        function syncSettingsState() {
            // Update connection status in settings
            const connectionStatus = document.getElementById('connectionStatus');
            if (connectionStatus) {
                const statusIndicator = connectionStatus.querySelector('.status-indicator');
                const statusText = connectionStatus.querySelector('.status-text');
                
                if (statusIndicator && statusText) {
                    statusIndicator.className = 'status-indicator online';
                    statusText.textContent = 'localStorage';
                }
            }
        }

        function showFabCluster() {
            console.log(' showFabCluster called');
            const existingCluster = document.getElementById('fabCluster');
            if (existingCluster) {
                console.log(' FAB cluster already exists, skipping');
                return; // Already exists
            }
            
            const fabCluster = document.createElement('div');
            fabCluster.id = 'fabCluster';
            fabCluster.className = 'fab-cluster';
            
            // Debug: Make sure it's visible
            console.log(' Creating FAB cluster element...');
            fabCluster.style.cssText = 'position: fixed; bottom: 48px; right: 48px; z-index: 9999; pointer-events: auto;';
            
            fabCluster.innerHTML = `
                <!-- Primary FAB -->
                <button class="fab-primary" onclick="toggleFabMenu()" id="primaryFab">
                    <span id="fabIcon"></span>
                </button>
                
                <!-- Secondary FABs -->
                <div class="fab-secondary-group" id="secondaryFabs">
                    
                    <button class="fab-secondary" onclick="openProjectWorkspace()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        <div class="fab-tooltip">Manage Projects</div>
                    </button>
                    
                    <button class="fab-secondary" onclick="openProcessWorkspace()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m5 0a2 2 0 002-2V7a2 2 0 00-2-2H9m0 0v12m0-12h6m-6 0V3"/>
                        </svg>
                        <div class="fab-tooltip">Add Process</div>
                    </button>
                    
                    <button class="fab-secondary" onclick="openPresentationMode()">
                        <svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5l-1 2v1h8v-1l-1-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H3V5h18v10z"/>
                        </svg>
                        <div class="fab-tooltip">Present Mode</div>
                    </button>
                </div>
            `;
            
            document.body.appendChild(fabCluster);
            console.log(' FAB cluster added to DOM:', fabCluster);
        }

        let fabExpanded = false;
        
        function toggleFabMenu() {
            const cluster = document.getElementById('fabCluster');
            const icon = document.getElementById('fabIcon');
            
            fabExpanded = !fabExpanded;
            
            if (fabExpanded) {
                cluster.classList.add('expanded');
                icon.textContent = '';
            } else {
                cluster.classList.remove('expanded');
                icon.textContent = '';
            }
        }

        // Utility Functions
        function generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        }
        
        function saveProjects() {
            localStorage.setItem('businessProjects', JSON.stringify(projects));
        }
        
        function loadProcesses(projectId) {
            const savedProcesses = localStorage.getItem(`processes_${projectId}`);
            if (savedProcesses) {
                processes = JSON.parse(savedProcesses);
                renderProcessList();
                updateCharts();
                updateMetrics();
            } else {
                processes = [];
                renderProcessList();
                updateCharts();
                updateMetrics();
            }
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize dashboard
        // Project Management Functions
        function openProjectModal() {
            document.getElementById('projectModal').classList.remove('hidden');
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.add('hidden');
            document.getElementById('projectForm').reset();
            
            // Reset edit mode
            delete document.getElementById('projectForm').dataset.editId;
            document.querySelector('#projectModal h2').textContent = 'Create New Project';
            document.querySelector('#projectModal button[type="submit"]').textContent = 'Create Project ';
        }

        document.getElementById('projectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            const projectName = document.getElementById('projectName').value;
            const clientName = document.getElementById('clientName').value;
            const editId = form.dataset.editId;
            
            if (editId) {
                // Update existing project
                const projectIndex = projects.findIndex(p => p.id === editId);
                if (projectIndex !== -1) {
                    projects[projectIndex].name = projectName;
                    projects[projectIndex].clientName = clientName;
                    projects[projectIndex].updatedAt = new Date().toISOString();
                    showNotification('Project updated successfully', 'success');
                }
                saveProjects();
                renderProjectList();
                closeProjectModal();
            } else {
                // Create new project using backend
                const projectData = {
                    name: projectName,
                    description: clientName, // Using clientName as description
                    workshopDate: new Date().toISOString(),
                    facilitatorEmail: 'admin@example.com', // Default email
                    metadata: { clientName: clientName }
                };
                
                createProjectWithBackend(projectData).then(newProject => {
                    if (newProject) {
                        // Add to local projects array for immediate UI update
                        const localProject = {
                            id: newProject.id,
                            name: newProject.name,
                            clientName: clientName,
                            createdAt: newProject.created_at || new Date().toISOString()
                        };
                        projects.push(localProject);
                        saveProjects();
                        renderProjectList();
                        showNotification('Project created successfully', 'success');
                    }
                    closeProjectModal();
                }).catch(error => {
                    console.error('Project creation failed:', error);
                    showNotification('Project creation failed', 'error');
                    closeProjectModal();
                });
            }
        });
        
        function renderProjectList() {
            const projectList = document.getElementById('projectList');
            if (!projectList) {
                console.log('projectList element not found, skipping render');
                return;
            }
            projectList.innerHTML = projects.map(project => `
                <div class="group relative">
                    <button onclick="selectProject('${project.id}')" class="w-full text-left p-4 bg-white/90 hover:bg-white text-gray-900 rounded-lg transition-all duration-200 border ${currentProjectId === project.id ? 'border-primary bg-primary/5 ring-2 ring-primary/20' : 'border-gray-200 hover:border-primary/30'}">
                        <div class="font-semibold">${project.name}</div>
                        <div class="text-sm text-gray-600 mt-1">${project.clientName}</div>
                    </button>
                    <div class="absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="editProject('${project.id}'); event.stopPropagation();" class="text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50" title="Edit project">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </button>
                        <button onclick="deleteProject('${project.id}'); event.stopPropagation();" class="text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50" title="Delete project">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function selectProject(projectId) {
            currentProjectId = projectId;
            const project = projects.find(p => p.id === projectId);
            if (project) {
                document.getElementById('currentProject').textContent = project.name + ' ';
                loadProcesses(projectId);
                renderProjectList(); // Re-render to show selection
            }
        }
        
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            // Fill form with existing data
            document.getElementById('projectName').value = project.name;
            document.getElementById('clientName').value = project.clientName;
            
            // Update form to edit mode
            const form = document.getElementById('projectForm');
            form.dataset.editId = projectId;
            
            // Update modal title and button
            document.querySelector('#projectModal h2').textContent = 'Edit Project';
            document.querySelector('#projectModal button[type="submit"]').textContent = 'Save Changes';
            
            // Show modal
            document.getElementById('projectModal').classList.remove('hidden');
        }
        
        function deleteProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            if (confirm(`Are you sure you want to delete "${project.name}"? This will also delete all associated processes.`)) {
                // Remove project
                projects = projects.filter(p => p.id !== projectId);
                saveProjects();
                
                // Remove associated processes
                localStorage.removeItem(`processes_${projectId}`);
                
                // Clear current selection if deleted
                if (currentProjectId === projectId) {
                    currentProjectId = null;
                    processes = [];
                    document.getElementById('currentProject').textContent = 'Select Project ';
                    updateDashboard();
                }
                
                renderProjectList();
                showNotification('Project deleted successfully', 'success');
            }
        }
        
        async function createProjectWithBackend(projectData) {
            try {
                if (window.workshopDB && window.workshopDB.isConnected()) {
                    const newProject = await window.workshopDB.createProject(projectData);
                    
                    // Generate department tokens
                    const departments = ['Finance', 'Operations', 'HR', 'IT', 'Marketing', 'Sales'];
                    await window.workshopDB.generateDepartmentTokens(newProject.id, departments);
                    
                    console.log(' Project created with backend:', newProject.id);
                    return newProject;
                } else {
                    // Fallback to localStorage
                    const localProject = {
                        id: generateId(),
                        name: projectData.name,
                        clientName: projectData.description,
                        createdAt: new Date().toISOString()
                    };
                    return localProject;
                }
            } catch (error) {
                console.error(' Backend project creation error:', error);
                // Fallback to localStorage
                const localProject = {
                    id: generateId(),
                    name: projectData.name,
                    clientName: projectData.description,
                    createdAt: new Date().toISOString()
                };
                return localProject;
            }
        }
        

        // Process Management Functions
        function renderProcessList() {
            const processList = document.getElementById('processList');
            if (!processList) {
                console.log('processList element not found, skipping render');
                return;
            }
            
            // Filter processes by department if in workshop mode or if filter is applied
            let filteredProcesses = processes;
            if (currentDepartmentFilter && currentDepartmentFilter !== 'all') {
                filteredProcesses = processes.filter(process => 
                    process.department === currentDepartmentFilter
                );
            }
            
            if (filteredProcesses.length === 0) {
                const message = currentDepartmentFilter && currentDepartmentFilter !== 'all' 
                    ? `No processes found for ${currentDepartmentFilter}` 
                    : 'No processes added yet';
                processList.innerHTML = `<div class="text-white/60 text-center py-4">${message}</div>`;
                return;
            }
            
            processList.innerHTML = filteredProcesses.map(process => {
                const avgScore = (process.scores.repetitive + process.scores.dataDriven + process.scores.ruleBased + process.scores.highVolume) / 4;
                const scoreColor = avgScore >= 7 ? 'bg-success' : avgScore >= 5 ? 'bg-warning' : 'bg-danger';
                
                // Department color coding for workshop mode
                const departmentColors = {
                    'Finance': 'bg-green-100 text-green-800 border-green-300',
                    'HR': 'bg-orange-100 text-orange-800 border-orange-300',
                    'Operations': 'bg-blue-100 text-blue-800 border-blue-300',
                    'IT': 'bg-purple-100 text-purple-800 border-purple-300',
                    'Marketing': 'bg-pink-100 text-pink-800 border-pink-300',
                    'Sales': 'bg-indigo-100 text-indigo-800 border-indigo-300',
                    'Customer Service': 'bg-teal-100 text-teal-800 border-teal-300',
                    'Legal': 'bg-gray-100 text-gray-800 border-gray-300',
                    'Administration': 'bg-slate-100 text-slate-800 border-slate-300',
                    'R&D': 'bg-cyan-100 text-cyan-800 border-cyan-300',
                    'Quality Assurance': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                    'Procurement': 'bg-emerald-100 text-emerald-800 border-emerald-300',
                    'Facilities': 'bg-stone-100 text-stone-800 border-stone-300',
                    'Other': 'bg-neutral-100 text-neutral-800 border-neutral-300'
                };
                
                const departmentStyle = workshopReviewMode && departmentColors[process.department] 
                    ? departmentColors[process.department] 
                    : '';
                
                const borderClass = workshopReviewMode && departmentColors[process.department] 
                    ? `border-2 ${departmentColors[process.department].split(' ')[2]}` 
                    : 'border border-gray-200';
                
                return `
                    <div class="process-card group relative rounded-lg p-4 fade-in bg-white/95 ${borderClass} hover:shadow-md transition-all duration-200">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 pr-4">${process.name}</h4>
                                <div class="flex items-center space-x-2 mt-1">
                                    ${workshopReviewMode && departmentStyle ? 
                                        `<span class="text-xs px-2 py-1 rounded-full ${departmentStyle}">${process.department}</span>` : 
                                        `<p class="text-sm text-gray-600">${process.department}</p>`
                                    }
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="${scoreColor} text-white text-xs px-3 py-1 rounded-full font-semibold">${avgScore.toFixed(1)}/10</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-700 space-y-1 mb-3">
                            <div class="flex justify-between">
                                <span>Impact:</span>
                                <span class="font-medium">${process.impact}/10</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Feasibility:</span>
                                <span class="font-medium">${process.feasibility}/10</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Weekly Time:</span>
                                <span class="font-medium">${process.timeSpent} hrs</span>
                            </div>
                        </div>
                        ${!workshopMode || isAdmin ? `
                        <div class="flex justify-end space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <button onclick="editProcess('${process.id}')" class="text-blue-600 hover:text-blue-800 p-2 rounded hover:bg-blue-50 transition-colors" title="Edit process">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button onclick="deleteProcess('${process.id}')" class="text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50 transition-colors" title="Delete process">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function editProcess(processId) {
            const process = processes.find(p => p.id === processId);
            if (!process) return;
            
            editingProcessId = processId;
            
            // Fill form with existing data - Step 1
            document.getElementById('processName').value = process.name;
            document.getElementById('processDepartment').value = process.department === 'Custom' ? 'Custom' : process.department;
            if (process.department === 'Custom') {
                document.getElementById('customDepartment').value = process.customDepartment || '';
                toggleCustomDepartment();
            }
            document.getElementById('timeSpent').value = process.timeSpent;
            
            // Fill slider values - Step 2
            if (process.scores) {
                document.getElementById('repetitive').value = process.scores.repetitive || 5;
                document.getElementById('dataDriven').value = process.scores.dataDriven || 5;
                document.getElementById('ruleBased').value = process.scores.ruleBased || 5;
                document.getElementById('highVolume').value = process.scores.highVolume || 5;
                
                // Update slider displays
                updateSliderValue('repetitive', process.scores.repetitive || 5);
                updateSliderValue('dataDriven', process.scores.dataDriven || 5);
                updateSliderValue('ruleBased', process.scores.ruleBased || 5);
                updateSliderValue('highVolume', process.scores.highVolume || 5);
            }
            
            // Fill impact and feasibility values - Step 3
            document.getElementById('impact').value = process.impact || 5;
            document.getElementById('feasibility').value = process.feasibility || 5;
            updateSliderValue('impact', process.impact || 5);
            updateSliderValue('feasibility', process.feasibility || 5);
            
            // Fill notes - Step 4
            document.getElementById('notes').value = process.notes || '';
            
            // Show the modal in edit mode
            document.getElementById('addProcessModal').classList.remove('hidden');
            currentStep = 1;
            showStep(1);
            updateStepIndicator();
        }

        function deleteProcess(processId) {
            const process = processes.find(p => p.id === processId);
            if (!process) return;
            
            if (confirm(`Are you sure you want to delete "${process.name}"?`)) {
                processes = processes.filter(p => p.id !== processId);
                saveProcesses();
                renderProcessList();
                updateCharts();
                updateMetrics();
                showNotification('Process deleted successfully', 'success');
            }
        }

        function saveProcesses() {
            if (currentProjectId) {
                localStorage.setItem(`processes_${currentProjectId}`, JSON.stringify(processes));
            }
        }

        function initializeDashboard() {
            debugLog(` Initializing dashboard...`);
            
            // Initialize projects data
            initializeProjects();
            
            // Populate project selector
            const selector = document.getElementById('headerProjectSelector');
            const projects = ['SunSep7', 'Project Alpha', 'Project Beta'];
            
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project;
                option.textContent = project;
                if (project === currentProject) option.selected = true;
                selector.appendChild(option);
            });
            
            // Initialize charts
            setTimeout(() => {
                recreateCharts();
                showFabCluster();
            }, 200);
            
            // Enhance with database functionality
            enhanceInitializeDashboard();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog(` Page loaded, initializing dashboard...`);
            initializeDashboard();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            debugLog(` Window resized, recreating charts...`);
            setTimeout(recreateCharts, 100);
        });

        // ===== MISSING FUNCTIONS FROM BACKUP - START =====
        
        // Settings Panel Functions
        function logout() {
            // For this dashboard, logout just shows a confirmation message
            // since there's no login screen in this standalone version
            if (confirm('Are you sure you want to reset the session?')) {
                // Clear any temporary data
                localStorage.removeItem('currentProject');
                
                // Show notification
                showNotification('Session cleared successfully', 'success');
                
                // Reset to default project
                currentProject = 'SunSep7';
                document.getElementById('headerProjectSelector').value = currentProject;
                
                // Recreate charts with default data
                recreateCharts();
                
                // Close settings panel
                closeHeaderSettings();
            }
        }

        function showBulkActions() {
            // Create bulk actions modal
            const modalHtml = `
                <div id="bulkModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl p-8 w-full max-w-2xl shadow-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900"> Bulk Actions</h2>
                            <button onclick="closeBulkModal()" class="text-gray-400 hover:text-gray-600 text-2xl"></button>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold mb-2">Department Actions</h3>
                                <div class="space-y-2">
                                    <button onclick="bulkDeleteByDepartment()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-red-50 hover:border-red-300">
                                         Delete all processes from a specific department
                                    </button>
                                    <button onclick="bulkMoveToProject()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300">
                                         Move processes to different project
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-semibold mb-2">Score Actions</h3>
                                <div class="space-y-2">
                                    <button onclick="bulkAdjustScores()" class="w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-yellow-50 hover:border-yellow-300">
                                         Adjust scores for low-quality submissions
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function closeBulkModal() {
            const modal = document.getElementById('bulkModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function bulkDeleteByDepartment() {
            const dept = prompt('Enter department name to delete all processes (this cannot be undone):');
            if (!dept) return;
            
            // Since we're using projectData instead of processes array
            const currentData = projectData[currentProject] || [];
            const matchingProcesses = currentData.filter(p => p.department && p.department.toLowerCase() === dept.toLowerCase());
            
            if (matchingProcesses.length === 0) {
                showNotification('No processes found for that department', 'error');
                return;
            }
            
            if (confirm(`Delete ${matchingProcesses.length} processes from ${dept}?`)) {
                projectData[currentProject] = currentData.filter(p => !p.department || p.department.toLowerCase() !== dept.toLowerCase());
                recreateCharts();
                showNotification(`Deleted ${matchingProcesses.length} processes from ${dept}`, 'success');
                closeBulkModal();
            }
        }
        
        function bulkMoveToProject() {
            showNotification('Bulk move feature coming soon', 'info');
            closeBulkModal();
        }
        
        function bulkAdjustScores() {
            showNotification('Bulk score adjustment feature coming soon', 'info');
            closeBulkModal();
        }

        function showDepartmentLinks() {
            const baseUrl = window.location.origin + window.location.pathname;
            const departmentTokens = {
                'Finance': 'fin_2024',
                'HR': 'hr_2024', 
                'Operations': 'ops_2024',
                'Sales': 'sales_2024',
                'Marketing': 'mkt_2024',
                'IT': 'it_2024',
                'Customer Service': 'cs_2024',
                'Legal': 'legal_2024',
                'Administration': 'admin_2024',
                'R&D': 'rd_2024',
                'Quality Assurance': 'qa_2024',
                'Procurement': 'proc_2024',
                'Facilities': 'fac_2024',
                'Other': 'other_2024'
            };
            
            const modalHtml = `
                <div id="linksModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900"> Department Workshop Links</h2>
                            <button onclick="closeLinksModal()" class="text-gray-400 hover:text-gray-600 text-2xl"></button>
                        </div>
                        <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <h3 class="font-semibold text-blue-800 mb-2"> Instructions:</h3>
                            <ol class="text-sm text-blue-700 space-y-1">
                                <li>1. Copy the link for each department</li>
                                <li>2. Send to department leads via email/chat</li>
                                <li>3. Department leads click their unique link to submit processes</li>
                                <li>4. Return here to review all submissions in Workshop Mode</li>
                            </ol>
                        </div>
                        <div class="space-y-3">
                            ${Object.keys(departmentTokens).map(dept => {
                                const deptKey = dept.toLowerCase().replace(/\s+/g, '');
                                const url = `${baseUrl}?dept=${deptKey}&token=${departmentTokens[dept]}`;
                                return `
                                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                                        <div class="flex-1">
                                            <div class="font-semibold text-gray-900">${dept}</div>
                                            <div class="text-sm text-gray-500 font-mono break-all">${url}</div>
                                        </div>
                                        <button onclick="copyToClipboard('${url}', '${dept}')" class="ml-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium">
                                             Copy
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="mt-6 text-center">
                            <button onclick="copyAllLinks()" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium">
                                 Copy All Links
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function copyToClipboard(text, department) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`${department} link copied to clipboard!`, 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`${department} link copied to clipboard!`, 'success');
            });
        }
        
        function copyAllLinks() {
            const baseUrl = window.location.origin + window.location.pathname;
            const departmentTokens = {
                'Finance': 'fin_2024',
                'HR': 'hr_2024', 
                'Operations': 'ops_2024',
                'Sales': 'sales_2024',
                'Marketing': 'mkt_2024',
                'IT': 'it_2024',
                'Customer Service': 'cs_2024',
                'Legal': 'legal_2024',
                'Administration': 'admin_2024',
                'R&D': 'rd_2024',
                'Quality Assurance': 'qa_2024',
                'Procurement': 'proc_2024',
                'Facilities': 'fac_2024',
                'Other': 'other_2024'
            };
            
            const allLinks = Object.keys(departmentTokens).map(dept => {
                const deptKey = dept.toLowerCase().replace(/\s+/g, '');
                const url = `${baseUrl}?dept=${deptKey}&token=${departmentTokens[dept]}`;
                return `${dept}: ${url}`;
            }).join('\n\n');
            
            const fullMessage = ` Department Workshop Links - Business Automation Tool\n\n` +
                `Instructions:\n` +
                `- Click your department's link below\n` +
                `- Fill out the business process form\n` +
                `- Submit processes your team wants to automate\n` +
                `- Workshop review will happen after all submissions\n\n` +
                `${allLinks}`;
            
            navigator.clipboard.writeText(fullMessage).then(() => {
                showNotification('All department links copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = fullMessage;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('All department links copied to clipboard!', 'success');
            });
        }
        
        function closeLinksModal() {
            const modal = document.getElementById('linksModal');
            if (modal) {
                modal.remove();
            }
        }

        function showDuplicateDetection() {
            // For demo purposes, show a simple notification
            showNotification(' Duplicate detection feature - coming soon!', 'info');
        }

        // Workspace Functions
        let currentWorkspace = null;
        
        function openProjectWorkspace() {
            closeFabMenu();
            showWorkspace('project', 'Project Overview', createProjectWorkspace());
        }
        
        function openProcessWorkspace() {
            closeFabMenu();
            showWorkspace('process', 'Process Entry', createProcessWorkspace());
        }

        function openPresentationMode() {
            closeFabMenu();
            showWorkspace('presentation', 'Workshop Presentation', createPresentationWorkspace());
        }
        
        function showWorkspace(type, title, content) {
            currentWorkspace = type;
            
            // Create workspace overlay if it doesn't exist
            let workspace = document.getElementById('contextualWorkspace');
            if (!workspace) {
                workspace = document.createElement('div');
                workspace.id = 'contextualWorkspace';
                workspace.className = 'contextual-workspace';
                workspace.onclick = (e) => {
                    if (e.target === workspace) closeWorkspace();
                };
                document.body.appendChild(workspace);
            }
            
            workspace.innerHTML = `
                <div class="workspace-content">
                    <header class="workspace-header">
                        <div class="workspace-header-left">
                            <button class="workspace-back-btn" onclick="closeWorkspace()">
                                <svg fill="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
                                </svg>
                            </button>
                            <h1 class="workspace-title">${title}</h1>
                            <span class="workspace-badge">Full View</span>
                        </div>
                        <div class="workspace-actions">
                            <button class="btn-system" onclick="closeWorkspace()">Close</button>
                        </div>
                    </header>
                    <div class="workspace-body">
                        ${content}
                    </div>
                </div>
            `;
            
            // Blur dashboard background
            const dashboard = document.querySelector('.container');
            if (dashboard) {
                dashboard.classList.add('dashboard-blur');
            }
            
            // Activate workspace with animation
            setTimeout(() => {
                workspace.classList.add('active');
            }, 10);
        }
        
        function closeWorkspace() {
            const workspace = document.getElementById('contextualWorkspace');
            const dashboard = document.querySelector('.container');
            
            if (workspace) {
                workspace.classList.remove('active');
                setTimeout(() => {
                    workspace.remove();
                }, 400);
            }
            
            // Remove dashboard blur
            if (dashboard) {
                dashboard.classList.remove('dashboard-blur');
            }
            
            currentWorkspace = null;
        }

        function closeFabMenu() {
            const cluster = document.getElementById('fabCluster');
            const icon = document.getElementById('fabIcon');
            
            if (cluster && cluster.classList.contains('expanded')) {
                cluster.classList.remove('expanded');
                icon.textContent = '';
                fabExpanded = false;
            }
        }

        // Workspace Content Creators
        function createProjectWorkspace() {
            return `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-semibold text-gray-900">Project Overview</h2>
                            <button class="btn-primary" onclick="openProjectModal(); closeWorkspace();">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                New Project
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Active Projects</h3>
                                <p class="text-3xl font-bold text-blue-600">${projects.length}</p>
                            </div>
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Total Processes</h3>
                                <p class="text-3xl font-bold text-green-600">${processes.length}</p>
                            </div>
                            <div class="admin-control-card">
                                <h3 class="font-semibold text-gray-700 mb-2">Departments</h3>
                                <p class="text-3xl font-bold text-purple-600">${new Set(processes.map(p => p.department)).size}</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-900">All Projects</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="workspaceProjectList">
                            ${projects.map(project => `
                                <div class="admin-control-card hover:shadow-lg transition-all duration-200 cursor-pointer" onclick="selectProject('${project.id}'); closeWorkspace();">
                                    <div class="flex justify-between items-start mb-3">
                                        <h4 class="font-semibold text-gray-900">${project.name}</h4>
                                        <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">Active</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">${project.clientName || 'No description'}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-500">
                                            ${processes.filter(p => p.projectId === project.id).length} processes
                                        </span>
                                        <div class="flex space-x-2">
                                            <button onclick="editProject('${project.id}'); event.stopPropagation();" class="text-blue-600 hover:text-blue-800 text-sm">
                                                Edit
                                            </button>
                                            <button onclick="deleteProject('${project.id}'); event.stopPropagation();" class="text-red-600 hover:text-red-800 text-sm">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function createProcessWorkspace() {
            return `
                <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                    <div class="bg-white p-8 rounded-xl border border-gray-200">
                        <h2 class="text-2xl font-semibold text-gray-900 mb-6">Add New Process</h2>
                        <form class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Process Name</label>
                                <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter process name...">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                                <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select department...</option>
                                    <option value="Finance">Finance</option>
                                    <option value="HR">HR</option>
                                    <option value="Operations">Operations</option>
                                    <option value="Sales">Sales</option>
                                    <option value="Marketing">Marketing</option>
                                    <option value="IT">IT</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Time Spent (hours/week)</label>
                                <input type="number" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 5">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Business Impact (1-10)</label>
                                    <input type="range" min="1" max="10" class="w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Technical Feasibility (1-10)</label>
                                    <input type="range" min="1" max="10" class="w-full">
                                </div>
                            </div>
                            
                            <div class="flex space-x-4">
                                <button type="button" class="flex-1 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors">
                                    Add Process
                                </button>
                                <button type="button" onclick="closeWorkspace()" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function createPresentationWorkspace() {
            return `
                <div style="max-width: 1400px; margin: 0 auto; padding: 20px;">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4">Workshop Presentation Mode</h2>
                        <p class="text-gray-600">Full-screen view optimized for workshop presentations and stakeholder reviews.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <canvas id="presentationBubbleChart" class="w-full h-96"></canvas>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <canvas id="presentationDonutChart" class="w-full h-96"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-8 rounded-xl border border-gray-200">
                        <h3 class="text-xl font-semibold mb-4">Key Insights</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center p-6 bg-blue-50 rounded-xl">
                                <div class="text-3xl font-bold text-blue-600">${(projectData[currentProject] || []).length}</div>
                                <div class="text-sm text-blue-800">Total Processes</div>
                            </div>
                            <div class="text-center p-6 bg-green-50 rounded-xl">
                                <div class="text-3xl font-bold text-green-600">${(projectData[currentProject] || []).filter(p => p.impact >= 8).length}</div>
                                <div class="text-sm text-green-800">High Impact</div>
                            </div>
                            <div class="text-center p-6 bg-purple-50 rounded-xl">
                                <div class="text-3xl font-bold text-purple-600">${Math.round((projectData[currentProject] || []).reduce((sum, p) => sum + p.timeSpent, 0))}</div>
                                <div class="text-sm text-purple-800">Total Hours/Week</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }


        // ===== MISSING FUNCTIONS FROM BACKUP - END =====

        // ===== DATABASE FUNCTIONALITY FUNCTIONS - START =====
        
        // Database Reset Functions
        function showResetConfirmation() {
            const modal = document.getElementById('resetConfirmationModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Close any open settings panels
                closeHeaderSettings();
            }
        }
        
        function hideResetConfirmation() {
            const modal = document.getElementById('resetConfirmationModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        function confirmResetDatabase() {
            // Hide the modal first
            hideResetConfirmation();
            
            // Add a small delay then proceed with reset
            setTimeout(() => {
                performDatabaseReset();
            }, 300);
        }
        
        async function performDatabaseReset() {
            try {
                showNotification(' Resetting database...', 'info');
                
                // Call the reset function if workshopDB is available
                if (window.workshopDB) {
                    const result = await window.workshopDB.resetDatabase();
                    
                    if (result.success) {
                        showNotification(
                            ` ${result.message}`, 
                            'success'
                        );
                        
                        // Clear current project state
                        currentProject = 'SunSep7';
                        
                        // Close settings panel
                        closeHeaderSettings();
                        
                        // Reset to default data
                        recreateCharts();
                        
                    } else {
                        throw new Error(result.message || 'Reset failed');
                    }
                } else {
                    // Fallback to local reset
                    localStorage.clear();
                    currentProject = 'SunSep7';
                    document.getElementById('headerProjectSelector').value = currentProject;
                    recreateCharts();
                    showNotification(' Local data reset successfully', 'success');
                    closeHeaderSettings();
                }
            } catch (error) {
                console.error(' Database reset failed:', error);
                showNotification(
                    ` Database reset failed: ${error.message}`, 
                    'error'
                );
            }
        }

        // Connection Status Functions
        function updateSettingsConnectionStatus() {
            const statusBadge = document.getElementById('connectionStatus');
            if (!statusBadge) {
                console.warn(' Connection status element not found');
                return;
            }
            
            const indicator = statusBadge.querySelector('.status-indicator');
            const text = statusBadge.querySelector('.status-text');
            
            if (!indicator || !text) {
                console.warn(' Status indicator elements not found');
                return;
            }
            
            // Check if database is available and connected
            let isOnline = false;
            let statusText = 'Offline';
            
            try {
                if (window.workshopDB && typeof window.workshopDB.isConnected === 'function') {
                    isOnline = window.workshopDB.isConnected();
                    const status = window.workshopDB.getConnectionStatus();
                    statusText = isOnline ? `${status.database} Connected` : 'localStorage Only';
                } else {
                    statusText = 'localStorage Only';
                }
            } catch (error) {
                console.log('Database not available, running in offline mode');
                statusText = 'localStorage Only';
            }
            
            // Update UI
            indicator.className = 'status-indicator';
            if (isOnline) {
                indicator.classList.add('online');
            } else {
                indicator.classList.add('offline');
            }
            
            text.textContent = statusText;
            
            console.log(` Connection Status: ${statusText}`);
        }

        // Enhanced Project Data Management
        function loadProjectsList() {
            // This would load projects from database if available
            // For now, we'll use the existing project data structure
            console.log(' Projects loaded from local data');
        }

        // Initialize Database Connection
        function initializeDatabaseConnection() {
            console.log(' Initializing database connection...');
            
            try {
                // Check if workshopDB is available
                if (window.workshopDB) {
                    const status = window.workshopDB.getConnectionStatus();
                    console.log(' Database Status:', status);
                }
            } catch (error) {
                console.log('Database not available, running in offline mode');
            }
            
            // Update connection status in settings
            updateSettingsConnectionStatus();
            
            // Load projects list
            loadProjectsList();
        }

        // Enhanced Settings Panel Initialization
        function initializeSettingsPanel() {
            console.log(' Initializing settings panel with database functionality...');
            
            // Initialize connection status
            updateSettingsConnectionStatus();
            
            // Update connection status periodically
            setInterval(updateSettingsConnectionStatus, 30000); // Every 30 seconds
            
            console.log(' Settings panel initialized with database features');
        }

        // Enhanced initialization with database features
        function enhanceInitializeDashboard() {
            debugLog(` Enhancing dashboard with database functionality...`);
            
            // Initialize database connection
            initializeDatabaseConnection();
            
            // Initialize settings panel
            initializeSettingsPanel();
        }

        // ===== DATABASE FUNCTIONALITY FUNCTIONS - END =====
    </script>

    <!-- Database Reset Confirmation Modal -->
    <div id="resetConfirmationModal" class="reset-confirmation-modal">
        <div class="reset-modal-backdrop" onclick="hideResetConfirmation()"></div>
        <div class="reset-modal-content">
            <div class="reset-modal-header">
                <div class="reset-modal-icon">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-2.694-.833-3.464 0L3.349 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                </div>
                <h3 class="reset-modal-title">Reset Database?</h3>
                <p class="reset-modal-description">
                    This will permanently delete all projects, processes, and workshop data. This action cannot be undone.
                </p>
            </div>
            <div class="reset-modal-actions">
                <button onclick="hideResetConfirmation()" class="reset-cancel-btn">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    Cancel
                </button>
                <button onclick="confirmResetDatabase()" class="reset-confirm-btn">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Yes, Delete Everything
                </button>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div id="projectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden" style="z-index: 150;">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Create New Project</h2>
                <button onclick="closeProjectModal()" class="text-gray-500 hover:text-gray-700 text-xl"></button>
            </div>
            <form id="projectForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                    <input type="text" id="projectName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-energy-blue focus:border-energy-blue" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                    <input type="text" id="clientName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-energy-blue focus:border-energy-blue" required>
                </div>
                <div class="flex justify-between space-x-4">
                    <button type="button" onclick="closeProjectModal()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium">
                        Create Project 
                    </button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
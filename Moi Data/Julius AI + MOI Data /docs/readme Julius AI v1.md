# Data flow

## Input
- Meta Ads daily exports (ad/ad set/campaign level performance)
- Google Ads daily exports (campaign/ad group/ad level performance)
- Shopify daily orders and lead events (used for attribution)

## Output
- unified_attr (intrim pivot)
- leaderboard (dervied for unified_attr and add ad_score)

## Basic flow
1. injest input data
2. clean and standardize (hours to date)
3. Link Shopify to Meta and Google traffic (combine similar to pivot)
4. Compute dervied metric
5. Compute ad_score
6. Color code


<details>
	<b> 1) Inputs we ingest </b>
	Meta Ads daily exports (ad/ad set/campaign level performance)
	Google Ads daily exports (campaign/ad group/ad level performance)
	Shopify daily orders and lead events (used for attribution)  
	<b> 2) Clean and standardize </b>
	Normalize column names, parse dates, and coerce numeric fields (spend, clicks, visitors).
	Align naming across platforms so fields like Campaign name, Ad set name, Ad name, and Source are consistent.
	<b>3) Attribute outcomes from Shopify back to ads</b>
	Aggregate Shopify conversions/leads by day and match back to ad entities using campaign/ad set/ad name and date logic.
	Compute attributed metrics per row:
		visitors_attributed
		good_lead_attributed
		checkouts_attributed
	Result: a unified attributed dataset (“unified_attr”) across Meta and Google, row-per-entity-per-day.
	<b> 4) Compute core efficiency metrics</b>
	On unified_attr we calculate:
		CPC = Spend / Visitors
		Cost per Good Lead = Spend / Good Leads (guarding for zeros)
		Cost per Checkout = Spend / Checkouts (guarding for zeros)
	We also compute rates and apply Empirical Bayes shrinkage to stabilize small-sample noise:
	Good lead rate and checkout rate get “shrunk” toward global averages so low-volume ads don’t look artificially great or terrible.
	<b> 5) Aggregate to ad-level and score </b>
	We roll daily rows up to each unique ad (Campaign name + Ad set name + Ad name):
	Sum spend, visitors, good leads, checkouts.
	Recompute CPC, CPL, conversion rates at the ad level.
	Combine stabilized quality metrics (shrunk rates), efficiency (CPL vs benchmark), and volume (spend/visitors) into a single ad_score.
	High-quality, low-cost, and sufficient volume = higher score.
	<b> 6) Classify and color-code </b>
	Based on ad_score and thresholds:
	Assign a Color:
		Green = strong, scalable
		Light Green = promising
		Purple = average/needs optimization
		Red = underperforming
	Assign a Recommendation:
		Examples: Scale aggressively, Scale, Optimize cost, Pause/Test new creative
	Include a confidence indicator (higher when volume is sufficient).
	<b> 7) Output artifacts </b>
	Ad-level leaderboard table with columns like Campaign name, Ad set name, Ad name, ad_score, Color, Recommendation, and supporting metrics.
	KPIs for the period (total spend, visitors, good leads, checkouts, avg CPC).
	Visuals for portfolio health (color mix), efficiency (scatter Spend vs Good Leads), and winners (Top 10 ads).
</details>	


# Data Dictionary

## 1) julius_leaderboard_2025-oct-13-08-45-19.csv (15 columns)

---

### Source
**Definition:** Marketing platform the ad belongs to.

**Values:** Meta, Google.

**Formula/Origin:** Direct categorical from upstream joins; for aggregated rows it's inherited from the underlying ad records (single-source per ad).

---

### Campaign name
**Definition:** Name of the campaign that the ad belongs to.

**Formula/Origin:** Direct text field from ad metadata.

---

### Ad set name
**Definition:** Name of the ad set (Meta) or equivalent ad group (Google) that the ad belongs to.

**Formula/Origin:** Direct text field from ad metadata.

---

### Ad name
**Definition:** Name of the ad creative/unit.

**Formula/Origin:** Direct text field from ad metadata.

---

### spend_sum
**Definition:** Total spend attributed to this ad across the period.

**Formula:** Sum over rows for this ad of Amount spent (INR).
```
spend_sum = sum(Amount spent (INR))
```

---

### visitors_sum
**Definition:** Total attributed visitors (sessions/visits) generated by this ad.

**Formula:** Sum of visitors_attributed across the period.
```
visitors_sum = sum(visitors_attributed)
```

---

### good_leads_sum
**Definition:** Total attributed good leads generated by this ad (qualified leads post-filtering).

**Formula:** Sum of good_lead_attributed across the period.
```
good_leads_sum = sum(good_lead_attributed)
```

---

### checkouts_sum
**Definition:** Total attributed checkouts/orders generated by this ad.

**Formula:** Sum of checkouts_attributed across the period.
```
checkouts_sum = sum(checkouts_attributed)
```

---

### days_active
**Definition:** Number of distinct days this ad recorded any attributed activity (spend or visitors or conversions) within the period.

**Formula:** Count distinct Day where this ad has activity.
```
days_active = count_distinct(Day with spend > 0 or visitors_attributed > 0 or conversions > 0)
```

---

### shrunk_good_lead_rate_agg
**Definition:** Aggregated "shrunk" good lead rate for the ad (a conservative conversion rate after shrinkage/regularization).

**Formula (conceptual):** Weighted average of daily shrunk_good_lead_rate by visitors or impressions proxy, or computed as total good leads divided by a shrunk/regularized exposure base. Typical approach:
```
shrunk_good_lead_rate_agg ≈ sum(good_lead_attributed) / (sum(visitors_attributed) + shrinkage_term)
```
Exact shrinkage term is defined upstream; here it is the already aggregated, stable rate metric.

---

### cpl_gl_shrunk
**Definition:** Cost per good lead using the shrunk (regularized) good lead rate basis to stabilize small samples.

**Formula (practical for reporting):**
```
cpl_gl_shrunk = spend_sum / max(good_leads_sum_adjusted, 1)
```
If good_leads_sum_adjusted is not separately present, it often equals good_leads_sum (post shrink). In many pipelines this is just:
```
cpl_gl_shrunk = spend_sum / max(good_leads_sum, 1)
```

---

### ad_score
**Definition:** Composite performance score used for ranking the ads.

**Formula:** Weighted function of cost efficiency and scaled rates (example schematic):
```
ad_score = f(cpl_gl_shrunk, shrunk_good_lead_rate_agg, volume signals like visitors_sum/days_active)
```

**Plain-English formula**
```
Compute inverse CPL from your shrunk CPL. Higher inverse CPL means cheaper good leads.
Standardize shrunk_good_lead_rate_agg, inverse CPL, and log(visitors+1) to be comparable.
Combine them as: composite = 0.4 × z(shrunk_good_lead_rate_agg) + 0.4 × z(1/cpl_gl_shrunk) + 0.2 × z(log(visitors+1))
Normalize composite to 0–1 across all ads to get ad_score.
```

---

### Color
**Definition:** Performance bucket color coding based on ad_score thresholds and/or guardrails.

**Values:** Green, Light Green, Purple, Red.

**Formula:** Deterministic mapping from ad_score (and possibly confidence) to discrete bins, e.g.:
- **Green** = top tier ≥0.90 = scale
- **Light Green** = above average 0.80–0.90 = test-to-scale
- **Purple** = below average 0.70–0.80 = optimize
- **Red** = underperforming <0.70 = pause/fix


---

### Recommendation
**Definition:** Actionable recommendation for the ad based on its performance tier (Color) and score.

**Examples:** Scale, Test new creative, Pause, Monitor, etc.

**Formula:** Rule-based text derived from Color and possibly volume/confidence (decision tree upstream).

---

### Confidence
**Definition:** Confidence level in the performance assessment (often driven by data volume/variance).

**Formula:** Function of sample size (visitors_sum, days_active) and signal stability; reported as a numeric or categorical confidence score from the upstream model.

---

## 2) julius_unified_attr_2025-oct-11-15-41-35.csv (18 columns)

---

### Day
**Definition:** Date of activity (daily granularity).

**Format:** YYYY-MM-DD.

**Formula/Origin:** Direct from source date per row (post-attribution alignment).

---

### Campaign name
**Definition:** Name of the campaign for this row's activity day.

**Formula/Origin:** Direct text from ad metadata.

---

### Ad set name
**Definition:** Name of the ad set/ad group for this row's activity day.

**Formula/Origin:** Direct text from ad metadata.

---

### Ad name
**Definition:** Name of the ad creative/unit for this row's activity day.

**Formula/Origin:** Direct text from ad metadata.

---

### Amount spent (INR)
**Definition:** Spend for the ad on this day in INR.

**Formula/Origin:** Daily spend from platform reporting (after any currency normalization).

---

### visitors_attributed
**Definition:** Number of attributed visitors/sessions linked to this ad on this day (per the attribution logic to Shopify).

**Formula/Origin:** Count from attribution pipeline; daily.

---

### checkouts_attributed
**Definition:** Number of attributed checkouts/orders linked to this ad on this day.

**Formula/Origin:** Count from attribution pipeline; daily.

---

### good_lead_attributed
**Definition:** Number of attributed qualified leads linked to this ad on this day.

**Formula/Origin:** Count from attribution pipeline; daily.

---

### CTR
**Definition:** Click-through rate.

**Formula:** clicks / impressions
```
CTR = clicks / impressions
```
**Note:** clicks and impressions originate from platform data; CTR is provided or computed upstream.

---

### CPM
**Definition:** Cost per mille (cost per 1000 impressions).

**Formula:**
```
CPM = (Amount spent (INR) / impressions) × 1000
```

---

### Source
**Definition:** Marketing platform source for this row.

**Values:** Meta, Google.

**Formula/Origin:** Direct categorical.

---

### CPC
**Definition:** Cost per click.

**Formula:**
```
CPC = Amount spent (INR) / max(clicks, 1)
```

---

### cost_per_good_lead
**Definition:** Cost per qualified (good) lead.

**Formula:**
```
cost_per_good_lead = Amount spent (INR) / max(good_lead_attributed, 1)
```

---

### cost_per_checkout
**Definition:** Cost per checkout/order.

**Formula:**
```
cost_per_checkout = Amount spent (INR) / max(checkouts_attributed, 1)
```

---

### good_lead_rate
**Definition:** Share of visitors converting to good leads (unshrunk).

**Formula:**
```
good_lead_rate = good_lead_attributed / max(visitors_attributed, 1)
```

---

### checkout_rate
**Definition:** Share of visitors converting to checkouts (unshrunk).

**Formula:**
```
checkout_rate = checkouts_attributed / max(visitors_attributed, 1)
```

---

### shrunk_good_lead_rate
**Definition:** Regularized/shrunk version of good_lead_rate to stabilize low-volume variance.

**Formula (conceptual Bayes/empirical):**
```
shrunk_good_lead_rate = (good_lead_attributed + alpha) / (visitors_attributed + beta)
```
alpha, beta are prior parameters defined upstream.

---

### shrunk_checkout_rate
**Definition:** Regularized/shrunk version of checkout_rate.

**Formula (conceptual):**
```
shrunk_checkout_rate = (checkouts_attributed + alpha_c) / (visitors_attributed + beta_c)


## Basic defination: 

---
### What is shrunk_rate
	* Raw rates (like good_lead_rate = good_leads / visitors) can be very noisy for low-traffic ads.
	* Shrunk rate is a stabilized version that blends each ad’s own rate with the overall average, weighted by how much traffic the ad had.
	* If an ad has little data, its shrunk rate leans more toward the global average. If it has lots of data, it stays close to its own raw rate.
	* **Why it matters:** prevents overreacting to random spikes/drops from tiny samples, so your rankings and budget decisions are more reliable.


```